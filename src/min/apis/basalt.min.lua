local a={}local b=true;local c=require;local d=function(e)for f,g in pairs(a)do if type(g)=="table"then for h,i in pairs(g)do if h==e then return i()end end else if f==e then return g()end end end;return c(e)end;local j=function(e)if e~=nil then return a[e]end;return a end;a["plugin"]=function(...)local e={...}local f={}local g={}local h=fs.getDir(e[2]or"Basalt")local i=fs.combine(h,"plugins")if b then for k,l in pairs(j("plugins"))do table.insert(g,k)local m=l()if type(m)=="table"then for n,o in pairs(m)do if type(n)=="string"then if f[n]==nil then f[n]={}end;table.insert(f[n],o)end end end end else if fs.exists(i)then for k,l in pairs(fs.list(i))do local m;if fs.isDir(fs.combine(i,l))then table.insert(g,fs.combine(i,l))m=d(l.."/init")else table.insert(g,l)m=d(l:gsub(".lua",""))end;if type(m)=="table"then for n,o in pairs(m)do if type(n)=="string"then if f[n]==nil then f[n]={}end;table.insert(f[n],o)end end end end end end;local function p(k)return f[k]end;return{get=p,getAvailablePlugins=function()return g end,addPlugin=function(k)if fs.exists(k)then if fs.isDir(k)then for l,m in pairs(fs.list(k))do table.insert(g,m)if not fs.isDir(fs.combine(k,m))then local n=m:gsub(".lua","")local o=d(fs.combine(k,n))if type(o)=="table"then for q,r in pairs(o)do if type(q)=="string"then if f[q]==nil then f[q]={}end;table.insert(f[q],r)end end end end end else local l=d(k:gsub(".lua",""))table.insert(g,k:match("[\\/]?([^\\/]-([^%.]+))$"))if type(l)=="table"then for m,n in pairs(l)do if type(m)=="string"then if f[m]==nil then f[m]={}end;table.insert(f[m],n)end end end end end end,loadPlugins=function(k,l)for m,n in pairs(k)do local o=f[m]if o~=nil then k[m]=function(...)local q=n(...)for r,s in pairs(o)do local t=s(q,l,...)t.__index=t;q=setmetatable(t,q)end;return q end end end;return k end}end;a["main"]=function(...)local e=d("basaltEvent")()local f=d("loadObjects")local g;local h=d("plugin")local i=d("utils")local p=d("basaltLogs")local k=i.uuid;local l=i.wrapText;local m=i.tableCount;local n=300;local o=0;local q=0;local r={}local s=term.current()local t="1.7.0"local u=fs.getDir(table.pack(...)[2]or"")local v,w,z,A,B={},{},{},{},{}local C,D,E,F;local G={}if not term.isColor or not term.isColor()then error('Basalt requires an advanced (golden) computer to run.',0)end;local H={}for I,J in pairs(colors)do if type(J)=="number"then H[I]={s.getPaletteColor(J)}end end;local function K()F=false;s.clear()s.setCursorPos(1,1)for I,J in pairs(colors)do if type(J)=="number"then s.setPaletteColor(J,colors.packRGB(table.unpack(H[I])))end end end;local function L(I)assert(I~="function","Schedule needs a function in order to work!")return function(...)local J=coroutine.create(I)local M,N=coroutine.resume(J,...)if M then table.insert(B,J)else G.basaltError(N)end end end;G.log=function(...)p(...)end;local O=function(I,J)A[I]=J end;local P=function(I)return A[I]end;local Q=function()return g end;local R=function(I)return Q()[I]end;local S=function(I,J,M)return R(J)(M,I)end;local T={getDynamicValueEventSetting=function()return G.dynamicValueEvents end,getMainFrame=function()return C end,setVariable=O,getVariable=P,setMainFrame=function(I)C=I end,getActiveFrame=function()return D end,setActiveFrame=function(I)D=I end,getFocusedObject=function()return E end,setFocusedObject=function(I)E=I end,getMonitorFrame=function(I)return z[I]or monGroups[I][1]end,setMonitorFrame=function(I,J,M)if C==J then C=nil end;if M then monGroups[I]={J,sides}else z[I]=J end;if J==nil then monGroups[I]=nil end end,getTerm=function()return s end,schedule=L,stop=K,debug=G.debug,log=G.log,getObjects=Q,getObject=R,createObject=S,getDirectory=function()return u end}local function U(I)s.clear()s.setBackgroundColor(colors.black)s.setTextColor(colors.red)local J,M=s.getSize()if G.logging then p(I,"Error")end;local N=l("Basalt error: "..I,J)local V=1;for W,X in pairs(N)do s.setCursorPos(1,V)s.write(X)V=V+1 end;s.setCursorPos(1,V+1)F=false end;local function Y(I,J,M,N,V)if#B>0 then local W={}for Z=1,#B do if B[Z]~=nil then if coroutine.status(B[Z])=="suspended"then local X,_=coroutine.resume(B[Z],I,J,M,N,V)if not X then G.basaltError(_)end else table.insert(W,Z)end end end;for Z=1,#W do table.remove(B,W[Z]-(Z-1))end end end;local function a0()if F==false then return end;if C~=nil then C:render()C:updateTerm()end;for I,J in pairs(z)do J:render()J:updateTerm()end end;local a1,a2,a3=nil,nil,nil;local a4=nil;local function a5(I,J,M,N)a1,a2,a3=J,M,N;if a4==nil then a4=os.startTimer(n/1000)end end;local function a6()a4=nil;C:hoverHandler(a2,a3,a1)D=C end;local a7,a8,a9=nil,nil,nil;local aa=nil;local function ab()aa=nil;C:dragHandler(a7,a8,a9)D=C end;local function ac(I,J,M,N)a7,a8,a9=J,M,N;if o<50 then ab()else if aa==nil then aa=os.startTimer(o/1000)end end end;local ad=nil;local function ae()ad=nil;a0()end;local function af(I)if q<50 then a0()else if ad==nil then ad=os.startTimer(q/1000)end end end;local function ag(I,...)local J={...}if e:sendEvent("basaltEventCycle",I,...)==false then return end;if I=="terminate"then G.stop()end;if C~=nil then local M={mouse_click=C.mouseHandler,mouse_up=C.mouseUpHandler,mouse_scroll=C.scrollHandler,mouse_drag=ac,mouse_move=a5}local N=M[I]if N~=nil then N(C,...)Y(I,...)af()return end end;if I=="monitor_touch"then for M,N in pairs(z)do if N:mouseHandler(1,J[2],J[3],true,J[1])then D=N end end;Y(I,...)af()return end;if D~=nil then local M={char=D.charHandler,key=D.keyHandler,key_up=D.keyUpHandler}local N=M[I]if N~=nil then if I=="key"then v[J[1]]=true elseif I=="key_up"then v[J[1]]=false end;N(D,...)Y(I,...)af()return end end;if I=="timer"and J[1]==a4 then a6()elseif I=="timer"and J[1]==aa then ab()elseif I=="timer"and J[1]==ad then ae()else for M,N in pairs(w)do N:eventHandler(I,...)end;for M,N in pairs(z)do N:eventHandler(I,...)end;Y(I,...)af()end end;local ah=false;local ai=false;local function aj()if not ah then for I,J in pairs(r)do if fs.exists(J)then if fs.isDir(J)then local M=fs.list(J)for N,V in pairs(M)do if not fs.isDir(J.."/"..V)then local W=V:gsub(".lua","")if W~="example.lua"and not W:find(".disabled")then if f[W]==nil then f[W]=d(J.."."..V:gsub(".lua",""))else error("Duplicate object name: "..W)end end end end else local M=J:gsub(".lua","")if f[M]==nil then f[M]=d(M)else error("Duplicate object name: "..M)end end end end;ah=true end;if not ai then g=h.loadPlugins(f,T)local I=h.get("basalt")if I~=nil then for M,N in pairs(I)do for V,W in pairs(N(G))do G[V]=W;T[V]=W end end end;local J=h.get("basaltInternal")if J~=nil then for M,N in pairs(J)do for V,W in pairs(N(G))do T[V]=W end end end;ai=true end end;local function ak(I)aj()for M,N in pairs(w)do if N:getName()==I then return nil end end;local J=g["BaseFrame"](I,T)J:init()J:load()J:draw()table.insert(w,J)if C==nil and J:getName()~="basaltDebuggingFrame"then J:show()end;return J end;G={basaltError=U,logging=false,dynamicValueEvents=false,drawFrames=a0,log=p,getVersion=function()return t end,memory=function()return math.floor(collectgarbage("count")+0.5).."KB"end,addObject=function(I)if fs.exists(I)then table.insert(r,I)end end,addPlugin=function(I)h.addPlugin(I)end,getAvailablePlugins=function()return h.getAvailablePlugins()end,getAvailableObjects=function()local I={}for J,M in pairs(f)do table.insert(I,J)end;return I end,setVariable=O,getVariable=P,getObjects=Q,getObject=R,createObject=S,setBaseTerm=function(I)s=I end,resetPalette=function()for I,J in pairs(colors)do if type(J)=="number"then end end end,setMouseMoveThrottle=function(I)if _HOST:find("CraftOS%-PC")then if config.get("mouse_move_throttle")~=10 then config.set("mouse_move_throttle",10)end;if I<100 then n=100 else n=I end;return true end;return false end,setRenderingThrottle=function(I)if I<=0 then q=0 else ad=nil;q=I end end,setMouseDragThrottle=function(I)if I<=0 then o=0 else aa=nil;o=I end end,autoUpdate=function(I)F=I;if I==nil then F=true end;local function J()a0()while F do ag(os.pullEventRaw())end end;while F do local M,N=xpcall(J,debug.traceback)if not M then G.basaltError(N)end end end,update=function(I,...)if I~=nil then local J={...}local M,N=xpcall(function()ag(I,table.unpack(J))end,debug.traceback)if not M then G.basaltError(N)return end end end,stop=K,stopUpdate=K,isKeyDown=function(I)if v[I]==nil then return false end;return v[I]end,getFrame=function(I)for J,M in pairs(w)do if M.name==I then return M end end end,getActiveFrame=function()return D end,setActiveFrame=function(I)if I:getType()=="Container"then D=I;return true end;return false end,getMainFrame=function()return C end,onEvent=function(...)for I,J in pairs(table.pack(...))do if type(J)=="function"then e:registerEvent("basaltEventCycle",J)end end end,schedule=L,addFrame=ak,createFrame=ak,addMonitor=function(I)aj()for M,N in pairs(w)do if N:getName()==I then return nil end end;local J=g["MonitorFrame"](I,T)J:init()J:load()J:draw()table.insert(z,J)return J end,removeFrame=function(I)w[I]=nil end,setProjectDir=function(I)u=I end}local al=h.get("basalt")if al~=nil then for I,J in pairs(al)do for M,N in pairs(J(G))do G[M]=N;T[M]=N end end end;local am=h.get("basaltInternal")if am~=nil then for I,J in pairs(am)do for M,N in pairs(J(G))do T[M]=N end end end;return G end;a["plugins"]={}a["plugins"]["advancedBackground"]=function(...)local e=d("xmlParser")return{VisualObject=function(f)local g=false;local h=colors.black;local i={setBackground=function(p,k,l,m)f.setBackground(p,k)g=l or g;h=m or h;return p end,setBackgroundSymbol=function(p,k,l)g=k;h=l or h;p:updateDraw()return p end,getBackgroundSymbol=function(p)return g end,getBackgroundSymbolColor=function(p)return h end,draw=function(p)f.draw(p)p:addDraw("advanced-bg",function()local k,l=p:getSize()if g~=false then p:addTextBox(1,1,k,l,g:sub(1,1))if g~=" "then p:addForegroundBox(1,1,k,l,h)end end end,2)end}return i end}end;a["plugins"]["bigfonts"]=function(...)local e=d("tHex")local f={{"\32\32\32\137\156\148\158\159\148\135\135\144\159\139\32\136\157\32\159\139\32\32\143\32\32\143\32\32\32\32\32\32\32\32\147\148\150\131\148\32\32\32\151\140\148\151\140\147","\32\32\32\149\132\149\136\156\149\144\32\133\139\159\129\143\159\133\143\159\133\138\32\133\138\32\133\32\32\32\32\32\32\150\150\129\137\156\129\32\32\32\133\131\129\133\131\132","\32\32\32\130\131\32\130\131\32\32\129\32\32\32\32\130\131\32\130\131\32\32\32\32\143\143\143\32\32\32\32\32\32\130\129\32\130\135\32\32\32\32\131\32\32\131\32\131","\139\144\32\32\143\148\135\130\144\149\32\149\150\151\149\158\140\129\32\32\32\135\130\144\135\130\144\32\149\32\32\139\32\159\148\32\32\32\32\159\32\144\32\148\32\147\131\132","\159\135\129\131\143\149\143\138\144\138\32\133\130\149\149\137\155\149\159\143\144\147\130\132\32\149\32\147\130\132\131\159\129\139\151\129\148\32\32\139\131\135\133\32\144\130\151\32","\32\32\32\32\32\32\130\135\32\130\32\129\32\129\129\131\131\32\130\131\129\140\141\132\32\129\32\32\129\32\32\32\32\32\32\32\131\131\129\32\32\32\32\32\32\32\32\32","\32\32\32\32\149\32\159\154\133\133\133\144\152\141\132\133\151\129\136\153\32\32\154\32\159\134\129\130\137\144\159\32\144\32\148\32\32\32\32\32\32\32\32\32\32\32\151\129","\32\32\32\32\133\32\32\32\32\145\145\132\141\140\132\151\129\144\150\146\129\32\32\32\138\144\32\32\159\133\136\131\132\131\151\129\32\144\32\131\131\129\32\144\32\151\129\32","\32\32\32\32\129\32\32\32\32\130\130\32\32\129\32\129\32\129\130\129\129\32\32\32\32\130\129\130\129\32\32\32\32\32\32\32\32\133\32\32\32\32\32\129\32\129\32\32","\150\156\148\136\149\32\134\131\148\134\131\148\159\134\149\136\140\129\152\131\32\135\131\149\150\131\148\150\131\148\32\148\32\32\148\32\32\152\129\143\143\144\130\155\32\134\131\148","\157\129\149\32\149\32\152\131\144\144\131\148\141\140\149\144\32\149\151\131\148\32\150\32\150\131\148\130\156\133\32\144\32\32\144\32\130\155\32\143\143\144\32\152\129\32\134\32","\130\131\32\131\131\129\131\131\129\130\131\32\32\32\129\130\131\32\130\131\32\32\129\32\130\131\32\130\129\32\32\129\32\32\133\32\32\32\129\32\32\32\130\32\32\32\129\32","\150\140\150\137\140\148\136\140\132\150\131\132\151\131\148\136\147\129\136\147\129\150\156\145\138\143\149\130\151\32\32\32\149\138\152\129\149\32\32\157\152\149\157\144\149\150\131\148","\149\143\142\149\32\149\149\32\149\149\32\144\149\32\149\149\32\32\149\32\32\149\32\149\149\32\149\32\149\32\144\32\149\149\130\148\149\32\32\149\32\149\149\130\149\149\32\149","\130\131\129\129\32\129\131\131\32\130\131\32\131\131\32\131\131\129\129\32\32\130\131\32\129\32\129\130\131\32\130\131\32\129\32\129\131\131\129\129\32\129\129\32\129\130\131\32","\136\140\132\150\131\148\136\140\132\153\140\129\131\151\129\149\32\149\149\32\149\149\32\149\137\152\129\137\152\129\131\156\133\149\131\32\150\32\32\130\148\32\152\137\144\32\32\32","\149\32\32\149\159\133\149\32\149\144\32\149\32\149\32\149\32\149\150\151\129\138\155\149\150\130\148\32\149\32\152\129\32\149\32\32\32\150\32\32\149\32\32\32\32\32\32\32","\129\32\32\130\129\129\129\32\129\130\131\32\32\129\32\130\131\32\32\129\32\129\32\129\129\32\129\32\129\32\131\131\129\130\131\32\32\32\129\130\131\32\32\32\32\140\140\132","\32\154\32\159\143\32\149\143\32\159\143\32\159\144\149\159\143\32\159\137\145\159\143\144\149\143\32\32\145\32\32\32\145\149\32\144\32\149\32\143\159\32\143\143\32\159\143\32","\32\32\32\152\140\149\151\32\149\149\32\145\149\130\149\157\140\133\32\149\32\154\143\149\151\32\149\32\149\32\144\32\149\149\153\32\32\149\32\149\133\149\149\32\149\149\32\149","\32\32\32\130\131\129\131\131\32\130\131\32\130\131\129\130\131\129\32\129\32\140\140\129\129\32\129\32\129\32\137\140\129\130\32\129\32\130\32\129\32\129\129\32\129\130\131\32","\144\143\32\159\144\144\144\143\32\159\143\144\159\138\32\144\32\144\144\32\144\144\32\144\144\32\144\144\32\144\143\143\144\32\150\129\32\149\32\130\150\32\134\137\134\134\131\148","\136\143\133\154\141\149\151\32\129\137\140\144\32\149\32\149\32\149\154\159\133\149\148\149\157\153\32\154\143\149\159\134\32\130\148\32\32\149\32\32\151\129\32\32\32\32\134\32","\133\32\32\32\32\133\129\32\32\131\131\32\32\130\32\130\131\129\32\129\32\130\131\129\129\32\129\140\140\129\131\131\129\32\130\129\32\129\32\130\129\32\32\32\32\32\129\32","\32\32\32\32\149\32\32\149\32\32\32\32\32\32\32\32\149\32\32\149\32\32\32\32\32\32\32\32\149\32\32\149\32\32\32\32\32\32\32\32\149\32\32\149\32\32\32\32","\32\32\32\32\32\32\32\32\32\32\32\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\32\32\32\32\32\32\32\32\32\32\32","\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32\32","\32\32\32\32\149\32\32\149\32\32\32\32\32\32\32\32\149\32\32\149\32\32\32\32\32\32\32\32\149\32\32\149\32\32\32\32\32\32\32\32\149\32\32\149\32\32\32\32","\32\32\32\32\32\32\32\32\32\32\32\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\32\32\32\32\32\32\32\32\32\32\32","\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32\32\149\32","\32\32\32\32\145\32\159\139\32\151\131\132\155\143\132\134\135\145\32\149\32\158\140\129\130\130\32\152\147\155\157\134\32\32\144\144\32\32\32\32\32\32\152\131\155\131\131\129","\32\32\32\32\149\32\149\32\145\148\131\32\149\32\149\140\157\132\32\148\32\137\155\149\32\32\32\149\154\149\137\142\32\153\153\32\131\131\149\131\131\129\149\135\145\32\32\32","\32\32\32\32\129\32\130\135\32\131\131\129\134\131\132\32\129\32\32\129\32\131\131\32\32\32\32\130\131\129\32\32\32\32\129\129\32\32\32\32\32\32\130\131\129\32\32\32","\150\150\32\32\148\32\134\32\32\132\32\32\134\32\32\144\32\144\150\151\149\32\32\32\32\32\32\145\32\32\152\140\144\144\144\32\133\151\129\133\151\129\132\151\129\32\145\32","\130\129\32\131\151\129\141\32\32\142\32\32\32\32\32\149\32\149\130\149\149\32\143\32\32\32\32\142\132\32\154\143\133\157\153\132\151\150\148\151\158\132\151\150\148\144\130\148","\32\32\32\140\140\132\32\32\32\32\32\32\32\32\32\151\131\32\32\129\129\32\32\32\32\134\32\32\32\32\32\32\32\129\129\32\129\32\129\129\130\129\129\32\129\130\131\32","\156\143\32\159\141\129\153\140\132\153\137\32\157\141\32\159\142\32\150\151\129\150\131\132\140\143\144\143\141\145\137\140\148\141\141\144\157\142\32\159\140\32\151\134\32\157\141\32","\157\140\149\157\140\149\157\140\149\157\140\149\157\140\149\157\140\149\151\151\32\154\143\132\157\140\32\157\140\32\157\140\32\157\140\32\32\149\32\32\149\32\32\149\32\32\149\32","\129\32\129\129\32\129\129\32\129\129\32\129\129\32\129\129\32\129\129\131\129\32\134\32\131\131\129\131\131\129\131\131\129\131\131\129\130\131\32\130\131\32\130\131\32\130\131\32","\151\131\148\152\137\145\155\140\144\152\142\145\153\140\132\153\137\32\154\142\144\155\159\132\150\156\148\147\32\144\144\130\145\136\137\32\146\130\144\144\130\145\130\136\32\151\140\132","\151\32\149\151\155\149\149\32\149\149\32\149\149\32\149\149\32\149\149\32\149\152\137\144\157\129\149\149\32\149\149\32\149\149\32\149\149\32\149\130\150\32\32\157\129\149\32\149","\131\131\32\129\32\129\130\131\32\130\131\32\130\131\32\130\131\32\130\131\32\32\32\32\130\131\32\130\131\32\130\131\32\130\131\32\130\131\32\32\129\32\130\131\32\133\131\32","\156\143\32\159\141\129\153\140\132\153\137\32\157\141\32\159\142\32\159\159\144\152\140\144\156\143\32\159\141\129\153\140\132\157\141\32\130\145\32\32\147\32\136\153\32\130\146\32","\152\140\149\152\140\149\152\140\149\152\140\149\152\140\149\152\140\149\149\157\134\154\143\132\157\140\133\157\140\133\157\140\133\157\140\133\32\149\32\32\149\32\32\149\32\32\149\32","\130\131\129\130\131\129\130\131\129\130\131\129\130\131\129\130\131\129\130\130\131\32\134\32\130\131\129\130\131\129\130\131\129\130\131\129\32\129\32\32\129\32\32\129\32\32\129\32","\159\134\144\137\137\32\156\143\32\159\141\129\153\140\132\153\137\32\157\141\32\32\132\32\159\143\32\147\32\144\144\130\145\136\137\32\146\130\144\144\130\145\130\138\32\146\130\144","\149\32\149\149\32\149\149\32\149\149\32\149\149\32\149\149\32\149\149\32\149\131\147\129\138\134\149\149\32\149\149\32\149\149\32\149\149\32\149\154\143\149\32\157\129\154\143\149","\130\131\32\129\32\129\130\131\32\130\131\32\130\131\32\130\131\32\130\131\32\32\32\32\130\131\32\130\131\129\130\131\129\130\131\129\130\131\129\140\140\129\130\131\32\140\140\129"},{"000110000110110000110010101000000010000000100101","000000110110000000000010101000000010000000100101","000000000000000000000000000000000000000000000000","100010110100000010000110110000010100000100000110","000000110000000010110110000110000000000000110000","000000000000000000000000000000000000000000000000","000000110110000010000000100000100000000000000010","000000000110110100010000000010000000000000000100","000000000000000000000000000000000000000000000000","010000000000100110000000000000000000000110010000","000000000000000000000000000010000000010110000000","000000000000000000000000000000000000000000000000","011110110000000100100010110000000100000000000000","000000000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","110000110110000000000000000000010100100010000000","000010000000000000110110000000000100010010000000","000000000000000000000000000000000000000000000000","010110010110100110110110010000000100000110110110","000000000000000000000110000000000110000000000000","000000000000000000000000000000000000000000000000","010100010110110000000000000000110000000010000000","110110000000000000110000110110100000000010000000","000000000000000000000000000000000000000000000000","000100011111000100011111000100011111000100011111","000000000000100100100100011011011011111111111111","000000000000000000000000000000000000000000000000","000100011111000100011111000100011111000100011111","000000000000100100100100011011011011111111111111","100100100100100100100100100100100100100100100100","000000110100110110000010000011110000000000011000","000000000100000000000010000011000110000000001000","000000000000000000000000000000000000000000000000","010000100100000000000000000100000000010010110000","000000000000000000000000000000110110110110110000","000000000000000000000000000000000000000000000000","110110110110110110000000110110110110110110110110","000000000000000000000110000000000000000000000000","000000000000000000000000000000000000000000000000","000000000000110110000110010000000000000000010010","000010000000000000000000000000000000000000000000","000000000000000000000000000000000000000000000000","110110110110110110110000110110110110000000000000","000000000000000000000110000000000000000000000000","000000000000000000000000000000000000000000000000","110110110110110110110000110000000000000000010000","000000000000000000000000100000000000000110000110","000000000000000000000000000000000000000000000000"}}local g={}local h={}do local l=0;local m=#f[1]local n=#f[1][1]for an=1,m,3 do for ao=1,n,3 do local o=string.char(l)local q={}q[1]=f[1][an]:sub(ao,ao+2)q[2]=f[1][an+1]:sub(ao,ao+2)q[3]=f[1][an+2]:sub(ao,ao+2)local r={}r[1]=f[2][an]:sub(ao,ao+2)r[2]=f[2][an+1]:sub(ao,ao+2)r[3]=f[2][an+2]:sub(ao,ao+2)h[o]={q,r}l=l+1 end end;g[1]=h end;local function i(l,m)local n={["0"]="1",["1"]="0"}if l<=#g then return true end;for ap=#g+1,l do local o={}local q=g[ap-1]for aq=0,255 do local r=string.char(aq)local s={}local t={}local u=q[r][1]local v=q[r][2]for an=1,#u do local w,z,A,B,C,D={},{},{},{},{},{}for ao=1,#u[1]do local E=h[u[an]:sub(ao,ao)][1]table.insert(w,E[1])table.insert(z,E[2])table.insert(A,E[3])local F=h[u[an]:sub(ao,ao)][2]if v[an]:sub(ao,ao)=="1"then table.insert(B,F[1]:gsub("[01]",n))table.insert(C,F[2]:gsub("[01]",n))table.insert(D,F[3]:gsub("[01]",n))else table.insert(B,F[1])table.insert(C,F[2])table.insert(D,F[3])end end;table.insert(s,table.concat(w))table.insert(s,table.concat(z))table.insert(s,table.concat(A))table.insert(t,table.concat(B))table.insert(t,table.concat(C))table.insert(t,table.concat(D))end;o[r]={s,t}if m then m="Font"..ap.."Yeld"..aq;os.queueEvent(m)os.pullEvent(m)end end;g[ap]=o end;return true end;local function p(l,m,n,o,q)if not type(m)=="string"then error("Not a String",3)end;local r=type(n)=="string"and n:sub(1,1)or e[n]or error("Wrong Front Color",3)local s=type(o)=="string"and o:sub(1,1)or e[o]or error("Wrong Back Color",3)if g[l]==nil then i(3,false)end;local t=g[l]or error("Wrong font size selected",3)if m==""then return{{""},{""},{""}}end;local u={}for D in m:gmatch('.')do table.insert(u,D)end;local v={}local w=#t[u[1]][1]for ar=1,w do local D={}for an=1,#u do D[an]=t[u[an]]and t[u[an]][1][ar]or""end;v[ar]=table.concat(D)end;local z={}local A={}local B={["0"]=r,["1"]=s}local C={["0"]=s,["1"]=r}for ar=1,w do local D={}local E={}for an=1,#u do local F=t[u[an]]and t[u[an]][2][ar]or""D[an]=F:gsub("[01]",q and{["0"]=n:sub(an,an),["1"]=o:sub(an,an)}or B)E[an]=F:gsub("[01]",q and{["0"]=o:sub(an,an),["1"]=n:sub(an,an)}or C)end;z[ar]=table.concat(D)A[ar]=table.concat(E)end;return{v,z,A}end;local k=d("xmlParser")return{Label=function(l)local m=1;local n;local o={setFontSize=function(q,r)if type(r)=="number"then m=r;if m>1 then q:setDrawState("label",false)n=p(m-1,q:getText(),q:getForeground(),q:getBackground()or colors.lightGray)if q:getAutoSize()then q:getBase():setSize(#n[1][1],#n[1]-1)end else q:setDrawState("label",true)end;q:updateDraw()end;return q end,getFontSize=function(q)return m end,getSize=function(q)local r,s=l.getSize(q)if m>1 and q:getAutoSize()then return m==2 and q:getText():len()*3 or math.floor(q:getText():len()*8.5),m==2 and s*2 or math.floor(s)else return r,s end end,getWidth=function(q)local r=l.getWidth(q)if m>1 and q:getAutoSize()then return m==2 and q:getText():len()*3 or math.floor(q:getText():len()*8.5)else return r end end,getHeight=function(q)local r=l.getHeight(q)if m>1 and q:getAutoSize()then return m==2 and r*2 or math.floor(r)else return r end end,draw=function(q)l.draw(q)q:addDraw("bigfonts",function()if m>1 then local r,s=q:getPosition()local t=q:getParent()local u,v=t:getSize()local w,z=#n[1][1],#n[1]r=r or math.floor((u-w)/2)+1;s=s or math.floor((v-z)/2)+1;for an=1,z do q:addFG(1,an,n[2][an])q:addBG(1,an,n[3][an])q:addText(1,an,n[1][an])end end end)end}return o end}end;a["plugins"]["border"]=function(...)local e=d("xmlParser")return{VisualObject=function(f)local g=true;local h={top=false,bottom=false,left=false,right=false}local i={setBorder=function(p,...)local k={...}if k~=nil then for l,m in pairs(k)do if m=="left"or#k==1 then h["left"]=k[1]end;if m=="top"or#k==1 then h["top"]=k[1]end;if m=="right"or#k==1 then h["right"]=k[1]end;if m=="bottom"or#k==1 then h["bottom"]=k[1]end end end;p:updateDraw()return p end,draw=function(p)f.draw(p)p:addDraw("border",function()local k,l=p:getPosition()local m,n=p:getSize()local o=p:getBackground()if g then if h["left"]~=false then p:addTextBox(1,1,1,n,"\149")if o~=false then p:addBackgroundBox(1,1,1,n,o)end;p:addForegroundBox(1,1,1,n,h["left"])end;if h["top"]~=false then p:addTextBox(1,1,m,1,"\131")if o~=false then p:addBackgroundBox(1,1,m,1,o)end;p:addForegroundBox(1,1,m,1,h["top"])end;if h["left"]~=false and h["top"]~=false then p:addTextBox(1,1,1,1,"\151")if o~=false then p:addBackgroundBox(1,1,1,1,o)end;p:addForegroundBox(1,1,1,1,h["left"])end;if h["right"]~=false then p:addTextBox(m,1,1,n,"\149")if o~=false then p:addForegroundBox(m,1,1,n,o)end;p:addBackgroundBox(m,1,1,n,h["right"])end;if h["bottom"]~=false then p:addTextBox(1,n,m,1,"\143")if o~=false then p:addForegroundBox(1,n,m,1,o)end;p:addBackgroundBox(1,n,m,1,h["bottom"])end;if h["top"]~=false and h["right"]~=false then p:addTextBox(m,1,1,1,"\148")if o~=false then p:addForegroundBox(m,1,1,1,o)end;p:addBackgroundBox(m,1,1,1,h["right"])end;if h["right"]~=false and h["bottom"]~=false then p:addTextBox(m,n,1,1,"\133")if o~=false then p:addForegroundBox(m,n,1,1,o)end;p:addBackgroundBox(m,n,1,1,h["right"])end;if h["bottom"]~=false and h["left"]~=false then p:addTextBox(1,n,1,1,"\138")if o~=false then p:addForegroundBox(0,n,1,1,o)end;p:addBackgroundBox(1,n,1,1,h["left"])end end end)end}return i end}end;a["plugins"]["debug"]=function(...)local e=d("utils")local f=e.wrapText;return{basalt=function(g)local h=g.getMainFrame()local i;local p;local k;local l;local function m()local n=16;local o=6;local q=99;local r=99;local s,t=h:getSize()i=h:addMovableFrame("basaltDebuggingFrame"):setSize(s-20,t-10):setBackground(colors.gray):setForeground(colors.white):setZIndex(100):hide()i:addPane():setSize("parent.w",1):setPosition(1,1):setBackground(colors.black):setForeground(colors.white)i:setPosition(-s,t/2-i:getHeight()/2):setBorder(colors.black)local u=i:addButton():setPosition("parent.w","parent.h"):setSize(1,1):setText("\133"):setForeground(colors.gray):setBackground(colors.black):onClick(function()end):onDrag(function(v,w,z,A,B)local C,D=i:getSize()local E,F=C,D;if C+A-1>=n and C+A-1<=q then E=C+A-1 end;if D+B-1>=o and D+B-1<=r then F=D+B-1 end;i:setSize(E,F)end)l=i:addButton():setText("Close"):setPosition("parent.w - 6",1):setSize(7,1):setBackground(colors.red):setForeground(colors.white):onClick(function()i:animatePosition(-s,t/2-i:getHeight()/2,0.5)end)p=i:addList():setSize("parent.w - 2","parent.h - 3"):setPosition(2,3):setBackground(colors.gray):setForeground(colors.white):setSelectionColor(colors.gray,colors.white)if k==nil then k=h:addLabel():setPosition(1,"parent.h"):setBackground(colors.black):setForeground(colors.white):setZIndex(100):onClick(function()i:show()i:animatePosition(s/2-i:getWidth()/2,t/2-i:getHeight()/2,0.5)end)end end;return{debug=function(...)local n={...}if h==nil then h=g.getMainFrame()if h~=nil then m()else print(...)return end end;if h:getName()~="basaltDebuggingFrame"then if h~=i then k:setParent(h)end end;local o=""for q,r in pairs(n)do o=o..tostring(r)..(#n~=q and", "or"")end;k:setText("[Debug] "..o)for q,r in pairs(f(o,p:getWidth()))do p:addItem(r)end;if p:getItemCount()>50 then p:removeItem(1)end;p:setValue(p:getItem(p:getItemCount()))if p.getItemCount()>p:getHeight()then p:setOffset(p:getItemCount()-p:getHeight())end;k:show()end}end}end;a["plugins"]["animations"]=function(...)local e,f,g,h,i,p=math.floor,math.sin,math.cos,math.pi,math.sqrt,math.pow;local function k(a8,a9,aa)return a8+(a9-a8)*aa end;local function l(a8)return a8 end;local function m(a8)return 1-a8 end;local function n(a8)return a8*a8*a8 end;local function o(a8)return m(n(m(a8)))end;local function q(a8)return k(n(a8),o(a8),a8)end;local function r(a8)return f(a8*h/2)end;local function s(a8)return m(g(a8*h/2))end;local function t(a8)return-(g(h*x)-1)/2 end;local function u(a8)local a9=1.70158;local aa=a9+1;return aa*a8^3-a9*a8^2 end;local function v(a8)return a8^3 end;local function w(a8)local a9=2*h/3;return a8==0 and 0 or(a8==1 and 1 or-2^(10*a8-10)*f((a8*10-10.75)*a9))end;local function z(a8)return a8==0 and 0 or 2^(10*a8-10)end;local function A(a8)return a8==0 and 0 or 2^(10*a8-10)end;local function B(a8)local a9=1.70158;local aa=a9*1.525;return a8<0.5 and(2*a8)^2*((aa+1)*2*a8-aa)/2 or((2*a8-2)^2*((aa+1)*(a8*2-2)+aa)+2)/2 end;local function C(a8)return a8<0.5 and 4*a8^3 or 1-(-2*a8+2)^3/2 end;local function D(a8)local a9=2*h/4.5;return a8==0 and 0 or(a8==1 and 1 or(a8<0.5 and-(2^(20*a8-10)*f((20*a8-11.125)*a9))/2 or 2^(-20*a8+10)*f((20*a8-11.125)*a9)/2+1))end;local function E(a8)return a8==0 and 0 or(a8==1 and 1 or(a8<0.5 and 2^(20*a8-10)/2 or(2-2^(-20*a8+10))/2))end;local function F(a8)return a8<0.5 and 2*a8^2 or 1-(-2*a8+2)^2/2 end;local function G(a8)return a8<0.5 and 8*a8^4 or 1-(-2*a8+2)^4/2 end;local function H(a8)return a8<0.5 and 16*a8^5 or 1-(-2*a8+2)^5/2 end;local function K(a8)return a8^2 end;local function L(a8)return a8^4 end;local function O(a8)return a8^5 end;local function P(a8)local a9=1.70158;local aa=a9+1;return 1+aa*(a8-1)^3+a9*(a8-1)^2 end;local function Q(a8)return 1-(1-a8)^3 end;local function R(a8)local a9=2*h/3;return a8==0 and 0 or(a8==1 and 1 or 2^(-10*a8)*f((a8*10-0.75)*a9)+1)end;local function S(a8)return a8==1 and 1 or 1-2^(-10*a8)end;local function T(a8)return 1-(1-a8)*(1-a8)end;local function U(a8)return 1-(1-a8)^4 end;local function Y(a8)return 1-(1-a8)^5 end;local function a0(a8)return 1-i(1-p(a8,2))end;local function a1(a8)return i(1-p(a8-1,2))end;local function a2(a8)return a8<0.5 and(1-i(1-p(2*a8,2)))/2 or(i(1-p(-2*a8+2,2))+1)/2 end;local function a3(a8)local a9=7.5625;local aa=2.75;if a8<1/aa then return a9*a8*a8 elseif a8<2/aa then local ab=a8-1.5/aa;return a9*ab*ab+0.75 elseif a8<2.5/aa then local ab=a8-2.25/aa;return a9*ab*ab+0.9375 else local ab=a8-2.625/aa;return a9*ab*ab+0.984375 end end;local function a4(a8)return 1-a3(1-a8)end;local function a5(a8)return x<0.5 and(1-a3(1-2*a8))/2 or(1+a3(2*a8-1))/2 end;local a6={linear=l,lerp=k,flip=m,easeIn=n,easeInSine=s,easeInBack=u,easeInCubic=v,easeInElastic=w,easeInExpo=A,easeInQuad=K,easeInQuart=L,easeInQuint=O,easeInCirc=a0,easeInBounce=a4,easeOut=o,easeOutSine=r,easeOutBack=P,easeOutCubic=Q,easeOutElastic=R,easeOutExpo=S,easeOutQuad=T,easeOutQuart=U,easeOutQuint=Y,easeOutCirc=a1,easeOutBounce=a3,easeInOut=q,easeInOutSine=t,easeInOutBack=B,easeInOutCubic=C,easeInOutElastic=D,easeInOutExpo=E,easeInOutQuad=F,easeInOutQuart=G,easeInOutQuint=H,easeInOutCirc=a2,easeInOutBounce=a5}local a7=d("xmlParser")return{VisualObject=function(a8,a9)local aa={}local ab="linear"local function ac(ag,ah)for ai,aj in pairs(aa)do if aj.timerId==ah then return aj end end end;local function ad(ag,ah,ai,aj,ak,al,am,I,J,M)local N,V=J(ag)if aa[am]~=nil then os.cancelTimer(aa[am].timerId)end;aa[am]={}aa[am].call=function()local W=aa[am].progress;local X=math.floor(a6.lerp(N,ah,a6[al](W/aj))+0.5)local _=math.floor(a6.lerp(V,ai,a6[al](W/aj))+0.5)M(ag,X,_)end;aa[am].finished=function()M(ag,ah,ai)if I~=nil then I(ag)end end;aa[am].timerId=os.startTimer(0.05+ak)aa[am].progress=0;aa[am].duration=aj;aa[am].mode=al;ag:listenEvent("other_event")end;local function ae(ag,ah,ai,aj,ak,...)local al={...}if aa[aj]~=nil then os.cancelTimer(aa[aj].timerId)end;aa[aj]={}local am=1;aa[aj].call=function()local I=al[am]ak(ag,I)end end;local af={animatePosition=function(ag,ah,ai,aj,ak,al,am)al=al or ab;aj=aj or 1;ak=ak or 0;ah=math.floor(ah+0.5)ai=math.floor(ai+0.5)ad(ag,ah,ai,aj,ak,al,"position",am,ag.getPosition,ag.setPosition)return ag end,animateSize=function(ag,ah,ai,aj,ak,al,am)al=al or ab;aj=aj or 1;ak=ak or 0;ad(ag,ah,ai,aj,ak,al,"size",am,ag.getSize,ag.setSize)return ag end,animateOffset=function(ag,ah,ai,aj,ak,al,am)al=al or ab;aj=aj or 1;ak=ak or 0;ad(ag,ah,ai,aj,ak,al,"offset",am,ag.getOffset,ag.setOffset)return ag end,animateBackground=function(ag,ah,ai,aj,ak,al)ak=ak or ab;ai=ai or 1;aj=aj or 0;ae(ag,ah,nil,ai,aj,ak,"background",al,ag.getBackground,ag.setBackground)return ag end,doneHandler=function(ag,ah,...)for ai,aj in pairs(aa)do if aj.timerId==ah then aa[ai]=nil;ag:sendEvent("animation_done",ag,"animation_done",ai)end end end,onAnimationDone=function(ag,...)for ah,ai in pairs(table.pack(...))do if type(ai)=="function"then ag:registerEvent("animation_done",ai)end end;return ag end,eventHandler=function(ag,ah,ai,...)a8.eventHandler(ag,ah,ai,...)if ah=="timer"then local aj=ac(ag,ai)if aj~=nil then if aj.progress<aj.duration then aj.call()aj.progress=aj.progress+0.05;aj.timerId=os.startTimer(0.05)else aj.finished()ag:doneHandler(ai)end end end end}return af end}end;a["plugins"]["basaltAdditions"]=function(...)return{basalt=function()return{cool=function()print("ello")sleep(2)end}end}end;a["plugins"]["dynamicValues"]=function(...)local e=d("utils")local f=e.tableCount;return{VisualObject=function(g,h)local i={}local p={}local k={x="getX",y="getY",w="getWidth",h="getHeight"}local function l(q)local r,s=pcall(load("return "..q,"",nil,{math=math}))if not r then error(q.." - is not a valid dynamic value string")end;return s end;local function m(q,r,s)local t={}local u=k;for z,A in pairs(u)do for B in s:gmatch("%a+%."..z)do local C=B:gsub("%."..z,"")if C~="self"and C~="parent"then table.insert(t,C)end end end;local v=q:getParent()local w={}for z,A in pairs(t)do w[A]=v:getChild(A)if w[A]==nil then error("Dynamic Values - unable to find object: "..A)end end;w["self"]=q;w["parent"]=v;i[r]=function()local z=s;for A,B in pairs(u)do for C in s:gmatch("%w+%."..A)do local D=w[C:gsub("%."..A,"")]if D~=nil then z=z:gsub(C,D[B](D))else error("Dynamic Values - unable to find object: "..C)end end end;p[r]=math.floor(l(z)+0.5)end;i[r]()end;local function n(q)if f(i)>0 then for s,t in pairs(i)do t()end;local r={x="getX",y="getY",w="getWidth",h="getHeight"}for s,t in pairs(r)do if i[s]~=nil then if p[s]~=q[t](q)then if s=="x"or s=="y"then g.setPosition(q,p["x"]or q:getX(),p["y"]or q:getY())end;if s=="w"or s=="h"then g.setSize(q,p["w"]or q:getWidth(),p["h"]or q:getHeight())end end end end end end;local o={updatePositions=n,createDynamicValue=m,setPosition=function(q,r,s,t)p.x=r;p.y=s;if type(r)=="string"then m(q,"x",r)else i["x"]=nil end;if type(s)=="string"then m(q,"y",s)else i["y"]=nil end;g.setPosition(q,p.x,p.y,t)return q end,setSize=function(q,r,s,t)p.w=r;p.h=s;if type(r)=="string"then m(q,"w",r)else i["w"]=nil end;if type(s)=="string"then m(q,"h",s)else i["h"]=nil end;g.setSize(q,p.w,p.h,t)return q end,customEventHandler=function(q,r,...)g.customEventHandler(q,r,...)if r=="basalt_FrameReposition"or r=="basalt_FrameResize"then n(q)end end}return o end}end;a["plugins"]["shadow"]=function(...)local e=d("xmlParser")return{VisualObject=function(f)local g=false;local h={setShadow=function(i,p)g=p;i:updateDraw()return i end,getShadow=function(i)return g end,draw=function(i)f.draw(i)i:addDraw("shadow",function()if g~=false then local p,k=i:getSize()if g then i:addBackgroundBox(p+1,2,1,k,g)i:addBackgroundBox(2,k+1,p,1,g)i:addForegroundBox(p+1,2,1,k,g)i:addForegroundBox(2,k+1,p,1,g)end end end)end}return h end}end;a["plugins"]["textures"]=function(...)local e=d("images")local f=d("utils")local g=d("xmlParser")return{VisualObject=function(h)local i,p=1,true;local k,l,m;local n="default"local o={addTexture=function(q,r,s)k=e.loadImageAsBimg(r)l=k[1]if s then if k.animated then q:listenEvent("other_event")local t=k[i].duration or k.secondsPerFrame or 0.2;m=os.startTimer(t)end end;q:setBackground(false)q:setForeground(false)q:setDrawState("texture-base",true)q:updateDraw()return q end,setTextureMode=function(q,r)n=r or n;q:updateDraw()return q end,setInfinitePlay=function(q,r)p=r;return q end,eventHandler=function(q,r,s,...)h.eventHandler(q,r,s,...)if r=="timer"then if s==m then if k[i+1]~=nil then i=i+1;l=k[i]local t=k[i].duration or k.secondsPerFrame or 0.2;m=os.startTimer(t)q:updateDraw()else if p then i=1;l=k[1]local t=k[i].duration or k.secondsPerFrame or 0.2;m=os.startTimer(t)q:updateDraw()end end end end end,draw=function(q)h.draw(q)q:addDraw("texture-base",function()local r=q:getParent()or q;local s,t=q:getPosition()local u,v=q:getSize()local w,z=r:getSize()local A=k.width or#k[i][1][1]local B=k.height or#k[i]local C,D=0,0;if n=="center"then C=s+math.floor((u-A)/2+0.5)-1;D=t+math.floor((v-B)/2+0.5)-1 elseif n=="default"then C,D=s,t elseif n=="right"then C,D=s+u-A,t+v-B end;local E=s-C;local F=t-D;if C<s then C=s;A=A-E end;if D<t then D=t;B=B-F end;if C+A>s+u then A=s+u-C end;if D+B>t+v then B=t+v-D end;for as=1,B do if l[as+F]~=nil then local G,H,K=table.unpack(l[as+F])q:addBlit(1,as,G:sub(E,E+A),H:sub(E,E+A),K:sub(E,E+A))end end end,1)q:setDrawState("texture-base",false)end}return o end}end;a["plugins"]["pixelbox"]=function(...)local e,f,g=table.sort,table.concat,string.char;local function h(m,n)return m[2]>n[2]end;local i={{5,256,16,8,64,32},{4,16,16384,256,128},[4]={4,64,1024,256,128},[8]={4,512,2048,256,1},[16]={4,2,16384,256,1},[32]={4,8192,4096,256,1},[64]={4,4,1024,256,1},[128]={6,32768,256,1024,2048,4096,16384},[256]={6,1,128,2,512,4,8192},[512]={4,8,2048,256,128},[1024]={4,4,64,128,32768},[2048]={4,512,8,128,32768},[4096]={4,8192,32,128,32768},[8192]={3,32,4096,256128},[16384]={4,2,16,128,32768},[32768]={5,128,1024,2048,4096,16384}}local p={}for an=0,15 do p[("%x"):format(an)]=2^an end;local k={}for an=0,15 do k[2^an]=("%x"):format(an)end;local function l(m,n)n=n or"f"local o,q=#m[1],#m;local r={}local s={}local t=false;local function u()for y=1,q*3 do for x=1,o*2 do if not s[y]then s[y]={}end;s[y][x]=n end end;for A,B in ipairs(m)do for x=1,#B do local C=B:sub(x,x)s[A][x]=p[C]end end end;u()local function v(A,B)o,q=A,B;s={}t=false;u()end;local function w(A,B,C,D,E,F)local G={A,B,C,D,E,F}local H={}local K={}local L=0;for an=1,6 do local R=G[an]if not H[R]then L=L+1;H[R]={0,L}end;local S=H[R]local T=S[1]+1;S[1]=T;K[S[2]]={R,T}end;local O=#K;while O>2 do e(K,h)local R=i[K[O][1]]local S,T=1,false;local U=O-1;for an=2,R[1]do if T then break end;local a1=R[an]for ao=1,U do if K[ao][1]==a1 then S=ao;T=true;break end end end;local Y,a0=K[O][1],K[S][1]for an=1,6 do if G[an]==Y then G[an]=a0;local a1=K[S]a1[2]=a1[2]+1 end end;K[O]=nil;O=O-1 end;local P=128;local Q=G[6]if G[1]~=Q then P=P+1 end;if G[2]~=Q then P=P+2 end;if G[3]~=Q then P=P+4 end;if G[4]~=Q then P=P+8 end;if G[5]~=Q then P=P+16 end;if K[1][1]==G[6]then return g(P),K[2][1],G[6]else return g(P),K[1][1],G[6]end end;local function z()local A=o*2;local B=0;for y=1,q*3,3 do B=B+1;local C=s[y]local D=s[y+1]local E=s[y+2]local F,G,H={},{},{}local K=0;for x=1,A,2 do local L=x+1;local O,P,Q,R,S,T=C[x],C[L],D[x],D[L],E[x],E[L]local U,Y,a0=" ",1,O;if not(P==O and Q==O and R==O and S==O and T==O)then U,Y,a0=w(O,P,Q,R,S,T)end;K=K+1;F[K]=U;G[K]=k[Y]H[K]=k[a0]end;r[B]={f(F),f(G),f(H)}end;t=true end;return{convert=z,generateCanvas=u,setSize=v,getSize=function()return o,q end,set=function(A,B)m=A;n=B or n;s={}t=false;u()end,get=function(A)if not t then z()end;return A~=nil and r[A]or r end}end;return{Image=function(m,n)return{shrink=function(o)local q=o:getImageFrame(1)local r={}for t,u in pairs(q)do if type(t)=="number"then table.insert(r,u[3])end end;local s=l(r,o:getBackground()).get()o:setImage(s)return o end,getShrinkedImage=function(o)local q=o:getImageFrame(1)local r={}for s,t in pairs(q)do if type(s)=="number"then table.insert(r,t[3])end end;return l(r,o:getBackground()).get()end}end}end;a["plugins"]["reactive"]=function(...)local e=d("xmlParser")local f={}f.currentEffect=nil;f.observable=function(p)local k=p;local l={}local m=function()if f.currentEffect~=nil then table.insert(l,f.currentEffect)table.insert(f.currentEffect.dependencies,l)end;return k end;local n=function(o)k=o;local q={}for r,s in ipairs(l)do q[r]=s end;for r,s in ipairs(q)do s.execute()end end;return m,n end;f.untracked=function(p)local k=f.currentEffect;f.currentEffect=nil;local l=p()f.currentEffect=k;return l end;f.effect=function(p)local k={dependencies={}}local l=function()f.clearEffectDependencies(k)local m=f.currentEffect;f.currentEffect=k;p()f.currentEffect=m end;k.execute=l;k.execute()end;f.derived=function(p)local k,l=f.observable()f.effect(function()l(p())end)return k end;f.clearEffectDependencies=function(p)for k,l in ipairs(p.dependencies)do for m,n in ipairs(l)do if n==p then table.remove(l,m)end end end;p.dependencies={}end;local g={fromXML=function(p)local k=e.parseText(p)local l=nil;for m,n in ipairs(k)do if n.tag=="script"then l=n.value;table.remove(k,m)break end end;return{nodes=k,script=l}end}local h=function(p,k)return load(p,nil,"t",k)()end;local i=function(p,k,l,m)k(p,function(...)local n,o=pcall(load(l,nil,"t",m))if not n then error("XML Error: "..o)end end)end;return{basalt=function(p)local k=function(m,n)local o=n[m.tag]if o~=nil then local s={}for t,u in pairs(m.attributes)do s[t]=load("return "..u,nil,"t",n)end;return p.createObjectsFromLayout(o,s)end;local q=m.tag:gsub("^%l",string.upper)local r=p:createObject(q,m.attributes["id"])for s,t in pairs(m.attributes)do if s:sub(1,2)=="on"then i(r,r[s],t.."()",n)else local u=function()local v=load("return "..t,nil,"t",n)()r:setProperty(s,v)end;p.effect(u)end end;for s,t in ipairs(m.children)do local u=p.createObjectsFromXMLNode(t,n)for v,w in ipairs(u)do r:addChild(w)end end;return{r}end;local l={observable=f.observable,untracked=f.untracked,effect=f.effect,derived=f.derived,layout=function(m)if not fs.exists(m)then error("Can't open file "..m)end;local n=fs.open(m,"r")local o=n.readAll()n.close()return g.fromXML(o)end,createObjectsFromLayout=function(m,n)local o=_ENV;o.props={}local q={}for s,t in pairs(n)do q[s]=p.derived(function()return t()end)end;setmetatable(o.props,{__index=function(s,t)return q[t]()end})if m.script~=nil then h(m.script,o)end;local r={}for s,t in ipairs(m.nodes)do local u=k(t,o)for v,w in ipairs(u)do table.insert(r,w)end end;return r end}return l end,Container=function(p,k)local l={loadLayout=function(m,n,o)local q={}if o==nil then o={}end;for t,u in pairs(o)do q[t]=function()return u end end;local r=k.layout(n)local s=k.createObjectsFromLayout(r,q)for t,u in ipairs(s)do m:addChild(u)end;return m end}return l end}end;a["plugins"]["themes"]=function(...)local e={BaseFrameBG=colors.lightGray,BaseFrameText=colors.black,FrameBG=colors.gray,FrameText=colors.black,ButtonBG=colors.gray,ButtonText=colors.black,CheckboxBG=colors.lightGray,CheckboxText=colors.black,InputBG=colors.black,InputText=colors.lightGray,TextfieldBG=colors.black,TextfieldText=colors.white,ListBG=colors.gray,ListText=colors.black,MenubarBG=colors.gray,MenubarText=colors.black,DropdownBG=colors.gray,DropdownText=colors.black,RadioBG=colors.gray,RadioText=colors.black,SelectionBG=colors.black,SelectionText=colors.lightGray,GraphicBG=colors.black,ImageBG=colors.black,PaneBG=colors.black,ProgramBG=colors.black,ProgressbarBG=colors.gray,ProgressbarText=colors.black,ProgressbarActiveBG=colors.black,ScrollbarBG=colors.lightGray,ScrollbarText=colors.gray,ScrollbarSymbolColor=colors.black,SliderBG=false,SliderText=colors.gray,SliderSymbolColor=colors.black,SwitchBG=colors.lightGray,SwitchText=colors.gray,LabelBG=false,LabelText=colors.black,GraphBG=colors.gray,GraphText=colors.black}local f={Container=function(g,h,i)local p={}local k={getTheme=function(l,m)local n=l:getParent()return p[m]or(n~=nil and n:getTheme(m)or e[m])end,setTheme=function(l,m,n)if type(m)=="table"then p=m elseif type(m)=="string"then p[m]=n end;l:updateDraw()return l end}return k end,basalt=function()return{getTheme=function(g)return e[g]end,setTheme=function(g,h)if type(g)=="table"then e=g elseif type(g)=="string"then e[g]=h end end}end}for g,h in pairs({"BaseFrame","Frame","ScrollableFrame","MovableFrame","Button","Checkbox","Dropdown","Graph","Graphic","Input","Label","List","Menubar","Pane","Program","Progressbar","Radio","Scrollbar","Slider","Switch","Textfield"})do f[h]=function(i,p,k)local l={init=function(m)if i.init(m)then local n=m:getParent()or m;m:setBackground(n:getTheme(h.."BG"))m:setForeground(n:getTheme(h.."Text"))end end}return l end end;return f end;a["libraries"]={}a["libraries"]["basaltDraw"]=function(...)local e=d("tHex")local f=d("utils")local g=f.splitString;local h,i=string.sub,string.rep;return function(p)local k=p or term.current()local l;local m,n=k.getSize()local o={}local q={}local r={}local s;local t={}local function u()s=i(" ",m)for Z=0,15 do local D=2^Z;local E=e[D]t[D]=i(E,m)end end;u()local function v()u()local D=s;local E=t[colors.white]local F=t[colors.black]for at=1,n do o[at]=h(o[at]==nil and D or o[at]..D:sub(1,m-o[at]:len()),1,m)r[at]=h(r[at]==nil and E or r[at]..E:sub(1,m-r[at]:len()),1,m)q[at]=h(q[at]==nil and F or q[at]..F:sub(1,m-q[at]:len()),1,m)end end;v()local function w(D,E,F,G,H)if#F==#G and#F==#H then if E>=1 and E<=n then if D+#F>0 and D<=m then local K,L,O;local P,Q,R=o[E],r[E],q[E]local S,T=1,#F;if D<1 then S=1-D+1;T=m-D+1 elseif D+#F>m then T=m-D+1 end;K=h(P,1,D-1)..h(F,S,T)L=h(Q,1,D-1)..h(G,S,T)O=h(R,1,D-1)..h(H,S,T)if D+#F<=m then K=K..h(P,D+#F,m)L=L..h(Q,D+#F,m)O=O..h(R,D+#F,m)end;o[E],r[E],q[E]=K,L,O end end end end;local function z(D,E,F)if E>=1 and E<=n then if D+#F>0 and D<=m then local G;local H=o[E]local K,L=1,#F;if D<1 then K=1-D+1;L=m-D+1 elseif D+#F>m then L=m-D+1 end;G=h(H,1,D-1)..h(F,K,L)if D+#F<=m then G=G..h(H,D+#F,m)end;o[E]=G end end end;local function A(D,E,F)if E>=1 and E<=n then if D+#F>0 and D<=m then local G;local H=q[E]local K,L=1,#F;if D<1 then K=1-D+1;L=m-D+1 elseif D+#F>m then L=m-D+1 end;G=h(H,1,D-1)..h(F,K,L)if D+#F<=m then G=G..h(H,D+#F,m)end;q[E]=G end end end;local function B(D,E,F)if E>=1 and E<=n then if D+#F>0 and D<=m then local G;local H=r[E]local K,L=1,#F;if D<1 then K=1-D+1;L=m-D+1 elseif D+#F>m then L=m-D+1 end;G=h(H,1,D-1)..h(F,K,L)if D+#F<=m then G=G..h(H,D+#F,m)end;r[E]=G end end end;local C={setSize=function(D,E)m,n=D,E;v()end,setMirror=function(D)l=D end,setBG=function(D,E,F)A(D,E,F)end,setText=function(D,E,F)z(D,E,F)end,setFG=function(D,E,F)B(D,E,F)end,blit=function(D,E,F,G,H)w(D,E,F,G,H)end,drawBackgroundBox=function(D,E,F,G,H)local K=i(e[H],F)for Z=1,G do A(D,E+Z-1,K)end end,drawForegroundBox=function(D,E,F,G,H)local K=i(e[H],F)for Z=1,G do B(D,E+Z-1,K)end end,drawTextBox=function(D,E,F,G,H)local K=i(H,F)for Z=1,G do z(D,E+Z-1,K)end end,update=function()local D,E=k.getCursorPos()local F=false;if k.getCursorBlink~=nil then F=k.getCursorBlink()end;k.setCursorBlink(false)if l~=nil then l.setCursorBlink(false)end;for Z=1,n do k.setCursorPos(1,Z)k.blit(o[Z],r[Z],q[Z])if l~=nil then l.setCursorPos(1,Z)l.blit(o[Z],r[Z],q[Z])end end;k.setBackgroundColor(colors.black)k.setCursorBlink(F)k.setCursorPos(D,E)if l~=nil then l.setBackgroundColor(colors.black)l.setCursorBlink(F)l.setCursorPos(D,E)end end,setTerm=function(D)k=D end}return C end end;a["libraries"]["basaltEvent"]=function(...)return function()local e={}local f={registerEvent=function(g,h,i)if e[h]==nil then e[h]={}end;table.insert(e[h],i)end,removeEvent=function(g,h,i)e[h][i[h]]=nil end,hasEvent=function(g,h)return e[h]~=nil end,getEventCount=function(g,h)return e[h]~=nil and#e[h]or 0 end,getEvents=function(g)local h={}for i,p in pairs(e)do table.insert(h,i)end;return h end,clearEvent=function(g,h)e[h]=nil end,clear=function(g,h)e={}end,sendEvent=function(g,h,...)local i;if e[h]~=nil then for p,k in pairs(e[h])do local l=k(...)if l==false then i=l end end end;return i end}f.__index=f;return f end end;a["libraries"]["bimg"]=function(...)local e,f=string.sub,string.rep;local function g(h,i)local p,k=0,0;local l,m,n={},{},{}local o,q=1,1;local r={}local function s()for y=1,k do if l[y]==nil then l[y]=f(" ",p)else l[y]=l[y]..f(" ",p-#l[y])end;if m[y]==nil then m[y]=f("0",p)else m[y]=m[y]..f("0",p-#m[y])end;if n[y]==nil then n[y]=f("f",p)else n[y]=n[y]..f("f",p-#n[y])end end end;local t=function(z,A,B)o=A or o;q=B or q;if l[q]==nil then l[q]=f(" ",o-1)..z..f(" ",p-(#z+o))else l[q]=e(l[q],1,o-1)..f(" ",o-#l[q])..z..e(l[q],o+#z,p)end;if#l[q]>p then p=#l[q]end;if q>k then k=q end;i.updateSize(p,k)end;local u=function(z,A,B)o=A or o;q=B or q;if n[q]==nil then n[q]=f("f",o-1)..z..f("f",p-(#z+o))else n[q]=e(n[q],1,o-1)..f("f",o-#n[q])..z..e(n[q],o+#z,p)end;if#n[q]>p then p=#n[q]end;if q>k then k=q end;i.updateSize(p,k)end;local v=function(z,A,B)o=A or o;q=B or q;if m[q]==nil then m[q]=f("0",o-1)..z..f("0",p-(#z+o))else m[q]=e(m[q],1,o-1)..f("0",o-#m[q])..z..e(m[q],o+#z,p)end;if#m[q]>p then p=#m[q]end;if q>k then k=q end;i.updateSize(p,k)end;local function w(z)r={}l,m,n={},{},{}for A,B in pairs(h)do if type(A)=="string"then r[A]=B else l[A],m[A],n[A]=B[1],B[2],B[3]end end;i.updateSize(p,k)end;if h~=nil then if#h>0 then p=#h[1][1]k=#h;w(h)end end;return{recalculateSize=s,setFrame=w,getFrame=function()local z={}for A,B in pairs(l)do table.insert(z,{B,m[A],n[A]})end;for A,B in pairs(r)do z[A]=B end;return z,p,k end,getImage=function()local z={}for A,B in pairs(l)do table.insert(z,{B,m[A],n[A]})end;return z end,setFrameData=function(z,A)if A~=nil then r[z]=A else if type(z)=="table"then r=z end end end,setFrameImage=function(z)for A,B in pairs(z.t)do l[A]=z.t[A]m[A]=z.fg[A]n[A]=z.bg[A]end end,getFrameImage=function()return{t=l,fg=m,bg=n}end,getFrameData=function(z)if z~=nil then return r[z]else return r end end,blit=function(z,A,B,C,D)t(z,C,D)v(A,C,D)u(B,C,D)end,text=t,fg=v,bg=u,getSize=function()return p,k end,setSize=function(z,A)local B,C,D={},{},{}for au=1,A do if l[au]~=nil then B[au]=e(l[au],1,z)..f(" ",z-p)else B[au]=f(" ",z)end;if m[au]~=nil then C[au]=e(m[au],1,z)..f("0",z-p)else C[au]=f("0",z)end;if n[au]~=nil then D[au]=e(n[au],1,z)..f("f",z-p)else D[au]=f("f",z)end end;l,m,n=B,C,D;p,k=z,A end}end;return function(h)local i={}local p={creator="Bimg Library by NyoriE",date=os.date("!%Y-%m-%dT%TZ")}local k,l=0,0;if h~=nil then if h[1][1][1]~=nil then k,l=p.width or#h[1][1][1],p.height or#h[1]end end;local m={}local function n(r,s)r=r or#i+1;local t=g(s,m)table.insert(i,r,t)if s==nil then i[r].setSize(k,l)end;return t end;local function o(r)table.remove(i,r or#i)end;local function q(r,s)local t=i[r]if t~=nil then local u=r+s;if u>=1 and u<=#i then table.remove(i,r)table.insert(i,u,t)end end end;m={updateSize=function(r,s,t)local u=t==true and true or false;if r>k then u=true;k=r end;if s>l then u=true;l=s end;if u then for v,w in pairs(i)do w.setSize(k,l)w.recalculateSize()end end end,text=function(r,s,t,u)local v=i[r]if v==nil then v=n(r)end;v.text(s,t,u)end,fg=function(r,s,t,u)local v=i[r]if v==nil then v=n(r)end;v.fg(s,t,u)end,bg=function(r,s,t,u)local v=i[r]if v==nil then v=n(r)end;v.bg(s,t,u)end,blit=function(r,s,t,u,v,w)local z=i[r]if z==nil then z=n(r)end;z.blit(s,t,u,v,w)end,setSize=function(r,s)k=r;l=s;for t,u in pairs(i)do u.setSize(r,s)end end,getFrame=function(r)if i[r]~=nil then return i[r].getFrame()end end,getFrameObjects=function()return i end,getFrames=function()local r={}for s,t in pairs(i)do local u=t.getFrame()table.insert(r,u)end;return r end,getFrameObject=function(r)return i[r]end,addFrame=function(r)if#i<=1 then if p.animated==nil then p.animated=true end;if p.secondsPerFrame==nil then p.secondsPerFrame=0.2 end end;return n(r)end,removeFrame=o,moveFrame=q,setFrameData=function(r,s,t)if i[r]~=nil then i[r].setFrameData(s,t)end end,getFrameData=function(r,s)if i[r]~=nil then return i[r].getFrameData(s)end end,getSize=function()return k,l end,setAnimation=function(r)p.animation=r end,setMetadata=function(r,s)if s~=nil then p[r]=s else if type(r)=="table"then p=r end end end,getMetadata=function(r)if r~=nil then return p[r]else return p end end,createBimg=function()local r={}for s,t in pairs(i)do local u=t.getFrame()table.insert(r,u)end;for s,t in pairs(p)do r[s]=t end;r.width=k;r.height=l;return r end}if h~=nil then for r,s in pairs(h)do if type(r)=="string"then p[r]=s end end;if p.width==nil or p.height==nil then k=p.width or#h[1][1][1]l=p.height or#h[1]m.updateSize(k,l,true)end;for r,s in pairs(h)do if type(r)=="number"then n(r,s)end end else n(1)end;return m end end;a["libraries"]["basaltMon"]=function(...)local e={[colors.white]="0",[colors.orange]="1",[colors.magenta]="2",[colors.lightBlue]="3",[colors.yellow]="4",[colors.lime]="5",[colors.pink]="6",[colors.gray]="7",[colors.lightGray]="8",[colors.cyan]="9",[colors.purple]="a",[colors.blue]="b",[colors.brown]="c",[colors.green]="d",[colors.red]="e",[colors.black]="f"}local f,g,h,i=type,string.len,string.rep,string.sub;return function(p)local k={}for F,G in pairs(p)do k[F]={}for H,K in pairs(G)do local L=peripheral.wrap(K)if L==nil then error("Unable to find monitor "..K)end;k[F][H]=L;k[F][H].name=K end end;local l,m,n,o,q,r,s,t=1,1,1,1,0,0,0,0;local u,v=false,1;local w,z=colors.white,colors.black;local function A()local F,G=0,0;for H,K in pairs(k)do local L,O=0,0;for P,Q in pairs(K)do local R,S=Q.getSize()L=L+R;O=S>O and S or O end;F=F>L and F or L;G=G+O end;s,t=F,G end;A()local function B()local F=0;local G,H=0,0;for K,L in pairs(k)do local O=0;local P=0;for Q,R in pairs(L)do local S,T=R.getSize()if l-O>=1 and l-O<=S then G=Q end;R.setCursorPos(l-O,m-F)O=O+S;if P<T then P=T end end;if m-F>=1 and m-F<=P then H=K end;F=F+P end;n,o=G,H end;B()local function C(F,...)local G={...}return function()for H,K in pairs(k)do for L,O in pairs(K)do O[F](table.unpack(G))end end end end;local function D()C("setCursorBlink",false)()if not u then return end;if k[o]==nil then return end;local F=k[o][n]if F==nil then return end;F.setCursorBlink(u)end;local function E(F,G,H)if k[o]==nil then return end;local K=k[o][n]if K==nil then return end;K.blit(F,G,H)local L,O=K.getSize()if g(F)+l>L then local P=k[o][n+1]if P~=nil then P.blit(F,G,H)n=n+1;l=l+g(F)end end;B()end;return{clear=C("clear"),setCursorBlink=function(F)u=F;D()end,getCursorBlink=function()return u end,getCursorPos=function()return l,m end,setCursorPos=function(F,G)l,m=F,G;B()D()end,setTextScale=function(F)C("setTextScale",F)()A()B()v=F end,getTextScale=function()return v end,blit=function(F,G,H)E(F,G,H)end,write=function(F)F=tostring(F)local G=g(F)E(F,h(e[w],G),h(e[z],G))end,getSize=function()return s,t end,setBackgroundColor=function(F)C("setBackgroundColor",F)()z=F end,setTextColor=function(F)C("setTextColor",F)()w=F end,calculateClick=function(F,G,H)local K=0;for L,O in pairs(k)do local P=0;local Q=0;for R,S in pairs(O)do local T,U=S.getSize()if S.name==F then return G+P,H+K end;P=P+T;if U>Q then Q=U end end;K=K+Q end;return G,H end}end end;a["libraries"]["basaltLogs"]=function(...)local e=""local f="basaltLog.txt"local g="Debug"fs.delete(e~=""and e.."/"..f or f)local h={__call=function(i,p,k)if p==nil then return end;local l=e~=""and e.."/"..f or f;local m=fs.open(l,fs.exists(l)and"a"or"w")m.writeLine("[Basalt]["..os.date("%Y-%m-%d %H:%M:%S").."]["..(k and k or g).."]: "..tostring(p))m.close()end}return setmetatable({},h)end;a["libraries"]["xmlParser"]=function(...)local e={new=function(h)return{tag=h,value=nil,attributes={},children={},addChild=function(i,p)table.insert(i.children,p)end,addAttribute=function(i,p,k)i.attributes[p]=k end}end}local f=function(h,i)local p,k=string.gsub(i,"(%w+)=([\"'])(.-)%2",function(n,o,q)h:addAttribute(n,"\""..q.."\"")end)local l,m=string.gsub(i,"(%w+)={(.-)}",function(n,o)h:addAttribute(n,o)end)end;local g={parseText=function(h)local i={}local p=e.new()table.insert(i,p)local k,l,m,n,o;local q,r=1,1;while true do k,r,l,m,n,o=string.find(h,"<(%/?)([%w_:]+)(.-)(%/?)>",q)if not k then break end;local t=string.sub(h,q,k-1)if not string.find(t,"^%s*$")then local u=(p.value or"")..t;i[#i].value=u end;if o=="/"then local u=e.new(m)f(u,n)p:addChild(u)elseif l==""then local u=e.new(m)f(u,n)table.insert(i,u)p=u else local u=table.remove(i)p=i[#i]if#i<1 then error("XMLParser: nothing to close with "..m)end;if u.tag~=m then error("XMLParser: trying to close "..u.tag.." with "..m)end;p:addChild(u)end;q=r+1 end;local s=string.sub(h,q)if#i>1 then error("XMLParser: unclosed "..i[#i].tag)end;return p.children end}return g end;a["libraries"]["images"]=function(...)local e,f=string.sub,math.floor;local function g(o)return{[1]={{},{},paintutils.loadImage(o)}},"bimg"end;local function h(o)return paintutils.loadImage(o),"nfp"end;local function i(o,q)local r=fs.open(o,q and"rb"or"r")if r==nil then error("Path - "..o.." doesn't exist!")end;local s=textutils.unserialize(r.readAll())r.close()if s~=nil then return s,"bimg"end end;local function p(o)end;local function k(o)end;local function l(o,q,r)if e(o,-4)==".bimg"then return i(o,r)elseif e(o,-3)==".bbf"then return p(o,r)else return h(o,r)end end;local function m(o)if o:find(".bimg")then return i(o)elseif o:find(".bbf")then return k(o)else return g(o)end end;local function n(o,q,r)local s,t=o.width or#o[1][1][1],o.height or#o[1]local u={}for v,w in pairs(o)do if type(v)=="number"then local z={}for y=1,r do local A,B,C="","",""local D=f(y/r*t+0.5)if w[D]~=nil then for x=1,q do local E=f(x/q*s+0.5)A=A..e(w[D][1],E,E)B=B..e(w[D][2],E,E)C=C..e(w[D][3],E,E)end;table.insert(z,{A,B,C})end end;table.insert(u,v,z)else u[v]=w end end;u.width=q;u.height=r;return u end;return{loadNFP=h,loadBIMG=i,loadImage=l,resizeBIMG=n,loadImageAsBimg=m}end;a["libraries"]["utils"]=function(...)local e=d("tHex")local f,g,h,i,p,k=string.sub,string.find,string.reverse,string.rep,table.insert,string.len;local function l(r,s)local t={}if r==""or s==""then return t end;local u=1;local v,w=g(r,s,u)while v do p(t,f(r,u,v-1))u=w+1;v,w=g(r,s,u)end;p(t,f(r,u))return t end;local function m(r)return r:gsub("{[^}]+}","")end;local function n(r,s)r=m(r)if r==""or s==0 then return{""}end;local t=l(r,"\n")local u={}for v,w in pairs(t)do if#w==0 then table.insert(u,"")else while#w>s do local z=s;for an=s,1,-1 do if f(w,an,an)==" "then z=an;break end end;if z==s then local A=f(w,1,z-1).."-"table.insert(u,A)w=f(w,z)else local A=f(w,1,z-1)table.insert(u,A)w=f(w,z+1)end;if#w<=s then break end end;if#w>0 then table.insert(u,w)end end end;return u end;local function o(r)local s={}local t=1;local u=1;while t<=#r do local v,w;local z,A;local B,C;for F,G in pairs(colors)do local H="{fg:"..F.."}"local K="{bg:"..F.."}"local L,O=r:find(H,t)local P,Q=r:find(K,t)if L and(not v or L<v)then v=L;z=F;B=O end;if P and(not w or P<w)then w=P;A=F;C=Q end end;local D;if v and(not w or v<w)then D=v elseif w then D=w else D=#r+1 end;local E=r:sub(t,D-1)if#E>0 then table.insert(s,{color=nil,bgColor=nil,text=E,position=u})u=u+#E;t=t+#E end;if v and(not w or v<w)then table.insert(s,{color=z,bgColor=nil,text="",position=u})t=B+1 elseif w then table.insert(s,{color=nil,bgColor=A,text="",position=u})t=C+1 else break end end;return s end;local function q(r,s)local t=o(r)local u={}local v,w=1,1;local z,A;local function B(C)table.insert(u,{x=v,y=w,text=C.text,color=C.color or z,bgColor=C.bgColor or A})end;for C,D in ipairs(t)do if D.color then z=D.color elseif D.bgColor then A=D.bgColor else local E=l(D.text," ")for F,G in ipairs(E)do local H=#G;if F>1 then if v+1+H<=s then B({text=" "})v=v+1 else v=1;w=w+1 end end;while H>0 do local K=G:sub(1,s-v+1)G=G:sub(s-v+2)H=#G;B({text=K})if H>0 then v=1;w=w+1 else v=v+#K end end end end;if v>s then v=1;w=w+1 end end;return u end;return{getTextHorizontalAlign=function(r,s,t,u)r=f(r,1,s)local v=s-k(r)if t=="right"then r=i(u or" ",v)..r elseif t=="center"then r=i(u or" ",math.floor(v/2))..r..i(u or" ",math.floor(v/2))r=r..(k(r)<s and(u or" ")or"")else r=r..i(u or" ",v)end;return r end,getTextVerticalAlign=function(r,s)local t=0;if s=="center"then t=math.ceil(r/2)if t<1 then t=1 end end;if s=="bottom"then t=r end;if t<1 then t=1 end;return t end,orderedTable=function(r)local s={}for t,u in pairs(r)do s[#s+1]=u end;return s end,rpairs=function(r)return function(s,t)t=t-1;if t~=0 then return t,s[t]end end,r,#r+1 end,tableCount=function(r)local s=0;if r~=nil then for t,u in pairs(r)do s=s+1 end end;return s end,splitString=l,removeTags=m,wrapText=n,convertRichText=o,writeRichText=function(r,s,t,u)local v=o(u)if#v==0 then r:addText(s,t,u)return end;local w,z=r:getForeground(),r:getBackground()for A,B in pairs(v)do r:addText(s+B.position-1,t,B.text)if B.color~=nil then r:addFG(s+B.position-1,t,e[colors[B.color]]:rep(#B.text))w=colors[B.color]else r:addFG(s+B.position-1,t,e[w]:rep(#B.text))end;if B.bgColor~=nil then r:addBG(s+B.position-1,t,e[colors[B.bgColor]]:rep(#B.text))z=colors[B.bgColor]else if z~=false then r:addBG(s+B.position-1,t,e[z]:rep(#B.text))end end end end,wrapRichText=q,writeWrappedText=function(r,s,t,u,v,w)local z=q(u,v)for A,B in pairs(z)do if B.y>w then break end;if B.text~=nil then r:addText(s+B.x-1,t+B.y-1,B.text)end;if B.color~=nil then r:addFG(s+B.x-1,t+B.y-1,e[colors[B.color]]:rep(#B.text))end;if B.bgColor~=nil then r:addBG(s+B.x-1,t+B.y-1,e[colors[B.bgColor]]:rep(#B.text))end end end,uuid=function()return string.gsub(string.format('%x-%x-%x-%x-%x',math.random(0,0xffff),math.random(0,0xffff),math.random(0,0xffff),math.random(0,0x0fff)+0x4000,math.random(0,0x3fff)+0x8000),' ','0')end}end;a["libraries"]["process"]=function(...)local e={}local f={}local g=0;local h=dofile("rom/modules/main/cc/require.lua").make;function f:new(i,p,k,...)local l={...}local m=setmetatable({path=i},{__index=self})m.window=p;p.current=term.current;p.redirect=term.redirect;m.processId=g;if type(i)=="string"then m.coroutine=coroutine.create(function()local n=shell.resolveProgram(i)local o=setmetatable(k,{__index=_ENV})o.shell=shell;o.basaltProgram=true;o.arg={[0]=i,table.unpack(l)}if n==nil then error("The path "..i.." does not exist!")end;o.require,o.package=h(o,fs.getDir(n))if fs.exists(n)then local q=fs.open(n,"r")local r=q.readAll()q.close()local s=load(r,i,"bt",o)if s~=nil then return s()end end end)elseif type(i)=="function"then m.coroutine=coroutine.create(function()i(table.unpack(l))end)else return end;e[g]=m;g=g+1;return m end;function f:resume(i,...)local p=term.current()term.redirect(self.window)if self.filter~=nil then if i~=self.filter then return end;self.filter=nil end;local k,l=coroutine.resume(self.coroutine,i,...)if k then self.filter=l else printError(l)end;term.redirect(p)return k,l end;function f:isDead()if self.coroutine~=nil then if coroutine.status(self.coroutine)=="dead"then table.remove(e,self.processId)return true end else return true end;return false end;function f:getStatus()if self.coroutine~=nil then return coroutine.status(self.coroutine)end;return nil end;function f:start()coroutine.resume(self.coroutine)end;return f end;a["libraries"]["tHex"]=function(...)local e={}for an=0,15 do e[2^an]=("%x"):format(an)end;return e end;a["libraries"]["reactivePrimitives"]=function(...)local e={CURRENT=0,STALE=1,MAYBE_STALE=2}local f={}f.new=function()return{fn=nil,value=nil,status=e.STALE,parents={},children={},cleanup=function(i)for p,k in ipairs(i.parents)do for l,m in ipairs(k.children)do if m==i then table.remove(k.children,l)break end end end;i.parents={}end}end;local g={listeningNode=nil,sourceNodes={},effectNodes={},transaction=false}local h={}h.pushUpdates=function()for i,p in ipairs(g.sourceNodes)do h.pushSourceNodeUpdate(p)end;h.pullUpdates()end;h.pushSourceNodeUpdate=function(i)if i.status==e.CURRENT then return end;h.pushNodeUpdate(i)for p,k in ipairs(i.children)do k.status=e.STALE end;i.status=e.CURRENT end;h.pushNodeUpdate=function(i)if i==nil then return end;i.status=e.MAYBE_STALE;for p,k in ipairs(i.children)do h.pushNodeUpdate(k)end end;h.pullUpdates=function()for i,p in ipairs(g.effectNodes)do h.pullNodeUpdates(p)end end;h.pullNodeUpdates=function(i)if i.status==e.CURRENT then return end;if i.status==e.MAYBE_STALE then for p,k in ipairs(i.parents)do h.pullNodeUpdates(k)end end;if i.status==e.STALE then i:cleanup()local p=g.listeningNode;g.listeningNode=i;local k=i.value;i.value=i.fn()g.listeningNode=p;for l,m in ipairs(i.children)do if k==i.value then m.status=e.CURRENT else m.status=e.STALE end end end;i.status=e.CURRENT end;h.subscribe=function(i)local p=g.listeningNode;if p~=nil then table.insert(i.children,p)table.insert(p.parents,i)end end;h.observable=function(i)local p=f.new()p.value=i;p.status=e.CURRENT;local k=function()h.subscribe(p)return p.value end;local l=function(m)if p.value==m then return end;p.value=m;p.status=g.STALE;if not g.transaction then h.pushUpdates()end end;table.insert(g.sourceNodes,p)return k,l end;h.derived=function(i)local p=f.new()p.fn=i;return function()if p.status~=e.CURRENT then h.pullNodeUpdates(p)end;h.subscribe(p)return p.value end end;h.effect=function(i)local p=f.new()p.fn=i;table.insert(g.effectNodes,p)h.pushUpdates()end;h.transaction=function(i)g.transaction=true;i()g.transaction=false;h.pushUpdates()end;h.untracked=function(i)local p=g.listeningNode;g.listeningNode=nil;local k=i()g.listeningNode=p;return k end;return h end;a["loadObjects"]=function(...)local e={}if b then for h,i in pairs(j("objects"))do e[h]=i()end;return e end;local f=table.pack(...)local g=fs.getDir(f[2]or"Basalt")if g==nil then error("Unable to find directory "..f[2].." please report this bug to our discord.")end;for h,i in pairs(fs.list(fs.combine(g,"objects")))do if i~="example.lua"and not i:find(".disabled")then local p=i:gsub(".lua","")e[p]=d(p)end end;return e end;a["objects"]={}a["objects"]["Graph"]=function(...)return function(e,f)local g=f.getObject("ChangeableObject")(e,f)local h="Graph"g:setZIndex(5)g:setSize(30,10)local i={}local p=colors.gray;local k="\7"local l=colors.black;local m=100;local n=0;local o="line"local q=10;local r={getType=function(s)return h end,setGraphColor=function(s,t)p=t or p;s:updateDraw()return s end,setGraphSymbol=function(s,t,u)k=t or k;l=u or l;s:updateDraw()return s end,setGraphSymbolColor=function(s,t)return s:setGraphSymbolColor(nil,t)end,getGraphSymbol=function(s)return k,l end,getGraphSymbolColor=function(s)return l end,addDataPoint=function(s,t)if t>=n and t<=m then table.insert(i,t)s:updateDraw()end;if#i>100 then table.remove(i,1)end;return s end,setMaxValue=function(s,t)m=t;s:updateDraw()return s end,getMaxValue=function(s)return m end,setMinValue=function(s,t)n=t;s:updateDraw()return s end,getMinValue=function(s)return n end,setGraphType=function(s,t)if t=="scatter"or t=="line"or t=="bar"then o=t;s:updateDraw()end;return s end,getGraphType=function(s)return o end,setMaxEntries=function(s,t)q=t;s:updateDraw()return s end,getMaxEntries=function(s)return q end,clear=function(s)i={}s:updateDraw()return s end,draw=function(s)g.draw(s)s:addDraw("graph",function()local t,u=s:getPosition()local v,w=s:getSize()local z,A=s:getBackground(),s:getForeground()local B=m-n;local C,D;local E=#i-q+1;if E<1 then E=1 end;for an=E,#i do local F=i[an]local G=math.floor((v-1)/(q-1)*(an-E)+1.5)local H=math.floor(w-1-(w-1)/B*(F-n)+1.5)if o=="scatter"then s:addBackgroundBox(G,H,1,1,p)s:addForegroundBox(G,H,1,1,l)s:addTextBox(G,H,1,1,k)elseif o=="line"then if C and D then local K=math.abs(G-C)local L=math.abs(H-D)local O=C<G and 1 or-1;local P=D<H and 1 or-1;local Q=K-L;while true do s:addBackgroundBox(C,D,1,1,p)s:addForegroundBox(C,D,1,1,l)s:addTextBox(C,D,1,1,k)if C==G and D==H then break end;local R=2*Q;if R>-L then Q=Q-L;C=C+O end;if R<K then Q=Q+K;D=D+P end end end;C,D=G,H elseif o=="bar"then s:addBackgroundBox(G-1,H,1,w-H,p)end end end)end}r.__index=r;return setmetatable(r,g)end end;a["objects"]["Image"]=function(...)local e=d("images")local f=d("bimg")local g,h,i,p=table.unpack,string.sub,math.max,math.min;return function(k,l)local m=l.getObject("VisualObject")(k,l)local n="Image"local o=f()local q=o.getFrameObject(1)local r;local s;local t=1;local u=false;local v;local w=false;local z=true;local A,B=0,0;m:setSize(24,8)m:setZIndex(2)local function C(F)local G={}for L,O in pairs(colors)do if type(O)=="number"then G[L]={term.nativePaletteColor(O)}end end;local H=o.getMetadata("palette")if H~=nil then for L,O in pairs(H)do G[L]=tonumber(O)end end;local K=o.getFrameData("palette")l.log(K)if K~=nil then for L,O in pairs(K)do G[L]=tonumber(O)end end;return G end;local function D()if z then if o~=nil then m:setSize(o.getSize())end end end;local E={getType=function(F)return n end,isType=function(F,G)return n==G or m.isType~=nil and m.isType(G)or false end,setOffset=function(F,G,H,K)if K then A=A+G or 0;B=B+H or 0 else A=G or A;B=H or B end;F:updateDraw()return F end,setXOffset=function(F,G)return F:setOffset(F,G,nil)end,setYOffset=function(F,G)return F:setOffset(F,nil,G)end,setSize=function(F,G,H)m:setSize(G,H)z=false;return F end,getOffset=function(F)return A,B end,getXOffset=function(F)return A end,getYOffset=function(F)return B end,selectFrame=function(F,G)if o.getFrameObject(G)==nil then o.addFrame(G)end;q=o.getFrameObject(G)s=q.getImage(G)t=G;F:updateDraw()end,addFrame=function(F,G)o.addFrame(G)return F end,getFrame=function(F,G)return o.getFrame(G)end,getFrameObject=function(F,G)return o.getFrameObject(G)end,removeFrame=function(F,G)o.removeFrame(G)return F end,moveFrame=function(F,G,H)o.moveFrame(G,H)return F end,getFrames=function(F)return o.getFrames()end,getFrameCount=function(F)return#o.getFrames()end,getActiveFrame=function(F)return t end,loadImage=function(F,G)if fs.exists(G)then local H=e.loadBIMG(G)o=f(H)t=1;q=o.getFrameObject(1)r=o.createBimg()s=q.getImage()D()F:updateDraw()end;return F end,setPath=function(F,G)return F:loadImage(G)end,setImage=function(F,G)if type(G)=="table"then o=f(G)t=1;q=o.getFrameObject(1)r=o.createBimg()s=q.getImage()D()F:updateDraw()end;return F end,clear=function(F)o=f()q=o.getFrameObject(1)s=nil;F:updateDraw()return F end,getImage=function(F)return o.createBimg()end,getImageFrame=function(F,G)return q.getImage(G)end,usePalette=function(F,G)w=G~=nil and G or true;return F end,getUsePalette=function(F)return w end,setUsePalette=function(F,G)return F:usePalette(G)end,play=function(F,G)if o.getMetadata("animated")then local H=o.getMetadata("duration")or o.getMetadata("secondsPerFrame")or 0.2;F:listenEvent("other_event")v=os.startTimer(H)u=G or false end;return F end,setPlay=function(F,G)return F:play(G)end,stop=function(F)os.cancelTimer(v)v=nil;u=false;return F end,eventHandler=function(F,G,H,...)m.eventHandler(F,G,H,...)if G=="timer"then if H==v then if o.getFrame(t+1)~=nil then t=t+1;F:selectFrame(t)local K=o.getFrameData(t,"duration")or o.getMetadata("secondsPerFrame")or 0.2;v=os.startTimer(K)else if u then t=1;F:selectFrame(t)local K=o.getFrameData(t,"duration")or o.getMetadata("secondsPerFrame")or 0.2;v=os.startTimer(K)end end;F:updateDraw()end end end,setMetadata=function(F,G,H)o.setMetadata(G,H)return F end,getMetadata=function(F,G)return o.getMetadata(G)end,getFrameMetadata=function(F,G,H)return o.getFrameData(G,H)end,setFrameMetadata=function(F,G,H,K)o.setFrameData(G,H,K)return F end,blit=function(F,G,H,K,L,O)x=L or x;y=O or y;q.blit(G,H,K,x,y)s=q.getImage()F:updateDraw()return F end,setText=function(F,G,H,K)x=H or x;y=K or y;q.text(G,x,y)s=q.getImage()F:updateDraw()return F end,setBg=function(F,G,H,K)x=H or x;y=K or y;q.bg(G,x,y)s=q.getImage()F:updateDraw()return F end,setFg=function(F,G,H,K)x=H or x;y=K or y;q.fg(G,x,y)s=q.getImage()F:updateDraw()return F end,getImageSize=function(F)return o.getSize()end,setImageSize=function(F,G,H)o.setSize(G,H)s=q.getImage()F:updateDraw()return F end,resizeImage=function(F,G,H)local K=e.resizeBIMG(r,G,H)o=f(K)t=1;q=o.getFrameObject(1)s=q.getImage()F:updateDraw()return F end,draw=function(F)m.draw(F)F:addDraw("image",function()local G,H=F:getSize()local K,L=F:getPosition()local O,P=F:getParent():getSize()local Q,R=F:getParent():getOffset()if K-Q>O or L-R>P or K-Q+G<1 or L-R+H<1 then return end;if w then F:getParent():setPalette(C(t))end;if s~=nil then for S,T in pairs(s)do if S+B<=H and S+B>=1 then local U,Y,a0=T[1],T[2],T[3]local a1=i(1-A,1)local a2=p(G-A,#U)U=h(U,a1,a2)Y=h(Y,a1,a2)a0=h(a0,a1,a2)F:addBlit(i(1+A,1),S+B,U,Y,a0)end end end end)end}E.__index=E;return setmetatable(E,m)end end;a["objects"]["List"]=function(...)local e=d("utils")local f=d("tHex")return function(g,h)local i=h.getObject("ChangeableObject")(g,h)local p="List"local k={}local l=colors.black;local m=colors.lightGray;local n=true;local o="left"local q=0;local r=true;i:setSize(16,8)i:setZIndex(5)local s={init=function(t)local u=t:getParent()t:listenEvent("mouse_click")t:listenEvent("mouse_drag")t:listenEvent("mouse_scroll")return i.init(t)end,getBase=function(t)return i end,setTextAlign=function(t,u)o=u;return t end,getTextAlign=function(t)return o end,getBase=function(t)return i end,getType=function(t)return p end,isType=function(t,u)return p==u or i.isType~=nil and i.isType(u)or false end,addItem=function(t,u,v,w,...)table.insert(k,{text=u,bgCol=v or t:getBackground(),fgCol=w or t:getForeground(),args={...}})if#k<=1 then t:setValue(k[1],false)end;t:updateDraw()return t end,setOptions=function(t,...)k={}for u,v in pairs(...)do if type(v)=="string"then table.insert(k,{text=v,bgCol=t:getBackground(),fgCol=t:getForeground(),args={}})else table.insert(k,{text=v[1],bgCol=v[2]or t:getBackground(),fgCol=v[3]or t:getForeground(),args=v[4]or{}})end end;t:setValue(k[1],false)t:updateDraw()return t end,setOffset=function(t,u)q=u;t:updateDraw()return t end,getOffset=function(t)return q end,removeItem=function(t,u)if type(u)=="number"then table.remove(k,u)elseif type(u)=="table"then for v,w in pairs(k)do if w==u then table.remove(k,v)break end end end;t:updateDraw()return t end,getItem=function(t,u)return k[u]end,getAll=function(t)return k end,getOptions=function(t)return k end,getItemIndex=function(t)local u=t:getValue()for v,w in pairs(k)do if w==u then return v end end end,clear=function(t)k={}t:setValue({},false)t:updateDraw()return t end,getItemCount=function(t)return#k end,editItem=function(t,u,v,w,z,...)table.remove(k,u)table.insert(k,u,{text=v,bgCol=w or t:getBackground(),fgCol=z or t:getForeground(),args={...}})t:updateDraw()return t end,selectItem=function(t,u)t:setValue(k[u]or{},false)t:updateDraw()return t end,setSelectionColor=function(t,u,v,w)l=u or t:getBackground()m=v or t:getForeground()n=w~=nil and w or true;t:updateDraw()return t end,setSelectionBG=function(t,u)return t:setSelectionColor(u,nil,n)end,setSelectionFG=function(t,u)return t:setSelectionColor(nil,u,n)end,getSelectionColor=function(t)return l,m end,getSelectionBG=function(t)return l end,getSelectionFG=function(t)return m end,isSelectionColorActive=function(t)return n end,setScrollable=function(t,u)r=u;if u==nil then r=true end;t:updateDraw()return t end,getScrollable=function(t)return r end,scrollHandler=function(t,u,v,w)if i.scrollHandler(t,u,v,w)then if r then local z,A=t:getSize()q=q+u;if q<0 then q=0 end;if u>=1 then if#k>A then if q>#k-A then q=#k-A end;if q>=#k then q=#k-1 end else q=q-1 end end;t:updateDraw()end;return true end;return false end,mouseHandler=function(t,u,v,w)if i.mouseHandler(t,u,v,w)then local z,A=t:getAbsolutePosition()local B,C=t:getSize()if#k>0 then for Z=1,C do if k[Z+q]~=nil then if z<=v and z+B>v and A+Z-1==w then t:setValue(k[Z+q])t:selectHandler()t:updateDraw()end end end end;return true end;return false end,dragHandler=function(t,u,v,w)return t:mouseHandler(u,v,w)end,touchHandler=function(t,u,v)return t:mouseHandler(1,u,v)end,onSelect=function(t,...)for u,v in pairs(table.pack(...))do if type(v)=="function"then t:registerEvent("select_item",v)end end;return t end,selectHandler=function(t)t:sendEvent("select_item",t:getValue())end,draw=function(t)i.draw(t)t:addDraw("list",function()local u,v=t:getSize()for Z=1,v do if k[Z+q]then local w=k[Z+q].text;local z,A=k[Z+q].fgCol,k[Z+q].bgCol;if k[Z+q]==t:getValue()and n then z,A=m,l end;t:addText(1,Z,w:sub(1,u))t:addBG(1,Z,f[A]:rep(u))t:addFG(1,Z,f[z]:rep(u))end end end)end}s.__index=s;return setmetatable(s,i)end end;a["objects"]["ChangeableObject"]=function(...)return function(e,f)local g=f.getObject("VisualObject")(e,f)local h="ChangeableObject"local i;local p={setValue=function(k,l,m)if i~=l then i=l;k:updateDraw()if m~=false then k:valueChangedHandler()end end;return k end,getValue=function(k)return i end,onChange=function(k,...)for l,m in pairs(table.pack(...))do if type(m)=="function"then k:registerEvent("value_changed",m)end end;return k end,valueChangedHandler=function(k)k:sendEvent("value_changed",i)end}p.__index=p;return setmetatable(p,g)end end;a["objects"]["Frame"]=function(...)local e=d("utils")local f,g,h,i,p=math.max,math.min,string.sub,string.rep,string.len;return function(k,l)local m=l.getObject("Container")(k,l)local n="Frame"local o;local q=true;local r,s=0,0;m:setSize(30,10)m:setZIndex(10)local t={getType=function()return n end,isType=function(u,v)return n==v or m.isType~=nil and m.isType(v)or false end,getBase=function(u)return m end,getOffset=function(u)return r,s end,setOffset=function(u,v,w)r=v or r;s=w or s;u:updateDraw()return u end,getXOffset=function(u)return r end,setXOffset=function(u,v)return u:setOffset(v,nil)end,getYOffset=function(u)return s end,setYOffset=function(u,v)return u:setOffset(nil,v)end,setParent=function(u,v,...)m.setParent(u,v,...)o=v;return u end,render=function(u)if m.render~=nil then if u:isVisible()then m.render(u)local v=u:getChildren()for w,z in ipairs(v)do if z.element.render~=nil then z.element:render()end end end end end,updateDraw=function(u)if o~=nil then o:updateDraw()end;return u end,blit=function(u,v,w,z,A,B)local C,D=u:getPosition()local E,F=o:getOffset()C=C-E;D=D-F;local G,H=u:getSize()if w>=1 and w<=H then local K=h(z,f(1-v+1,1),f(G-v+1,1))local L=h(A,f(1-v+1,1),f(G-v+1,1))local O=h(B,f(1-v+1,1),f(G-v+1,1))o:blit(f(v+C-1,C),D+w-1,K,L,O)end end,setCursor=function(u,v,w,z,A)local B,C=u:getPosition()local D,E=u:getOffset()o:setCursor(v or false,(w or 0)+B-1-D,(z or 0)+C-1-E,A or colors.white)return u end}for u,v in pairs({"drawBackgroundBox","drawForegroundBox","drawTextBox"})do t[v]=function(w,z,A,B,C,D)local E,F=w:getPosition()local G,H=o:getOffset()E=E-G;F=F-H;C=A<1 and(C+A>w:getHeight()and w:getHeight()or C+A-1)or(C+A>w:getHeight()and w:getHeight()-A+1 or C)B=z<1 and(B+z>w:getWidth()and w:getWidth()or B+z-1)or(B+z>w:getWidth()and w:getWidth()-z+1 or B)o[v](o,f(z+E-1,E),f(A+F-1,F),B,C,D)end end;for u,v in pairs({"setBG","setFG","setText"})do t[v]=function(w,z,A,B)local C,D=w:getPosition()local E,F=o:getOffset()C=C-E;D=D-F;local G,H=w:getSize()if A>=1 and A<=H then o[v](o,f(z+C-1,C),D+A-1,h(B,f(1-z+1,1),f(G-z+1,1)))end end end;t.__index=t;return setmetatable(t,m)end end;a["objects"]["BaseFrame"]=function(...)local e=d("basaltDraw")local f=d("utils")local g,h,i,p=math.max,math.min,string.sub,string.rep;return function(k,l)local m=l.getObject("Container")(k,l)local n="BaseFrame"local o,q=0,0;local r={}local s=true;local t=l.getTerm()local u=e(t)local v,w,z,A=1,1,false,colors.white;local B={getType=function()return n end,isType=function(C,D)return n==D or m.isType~=nil and m.isType(D)or false end,getBase=function(C)return m end,getOffset=function(C)return o,q end,setOffset=function(C,D,E)o=D or o;q=E or q;C:updateDraw()return C end,getXOffset=function(C)return o end,setXOffset=function(C,D)return C:setOffset(D,nil)end,getYOffset=function(C)return q end,setYOffset=function(C,D)return C:setOffset(nil,D)end,setPalette=function(C,D,...)if C==l.getActiveFrame()then if type(D)=="string"then r[D]=...t.setPaletteColor(type(D)=="number"and D or colors[D],...)elseif type(D)=="table"then for E,F in pairs(D)do r[E]=F;if type(F)=="number"then t.setPaletteColor(type(E)=="number"and E or colors[E],F)else local G,H,K=table.unpack(F)t.setPaletteColor(type(E)=="number"and E or colors[E],G,H,K)end end end end;return C end,setSize=function(C,...)m.setSize(C,...)u=e(t)return C end,getSize=function()return t.getSize()end,getWidth=function(C)return({t.getSize()})[1]end,getHeight=function(C)return({t.getSize()})[2]end,show=function(C)m.show(C)l.setActiveFrame(C)for D,E in pairs(colors)do if type(E)=="number"then t.setPaletteColor(E,colors.packRGB(term.nativePaletteColor(E)))end end;for D,E in pairs(r)do if type(E)=="number"then t.setPaletteColor(type(D)=="number"and D or colors[D],E)else local F,G,H=table.unpack(E)t.setPaletteColor(type(D)=="number"and D or colors[D],F,G,H)end end;l.setMainFrame(C)return C end,render=function(C)if m.render~=nil then if C:isVisible()then if s then m.render(C)local D=C:getChildren()for E,F in ipairs(D)do if F.element.render~=nil then F.element:render()end end;s=false end end end end,updateDraw=function(C)s=true;return C end,eventHandler=function(C,D,...)m.eventHandler(C,D,...)if D=="term_resize"then C:setSize(t.getSize())end end,updateTerm=function(C)if u~=nil then u.update()end end,setTerm=function(C,D)t=D;if D==nil then u=nil else u=e(t)end;return C end,getTerm=function()return t end,blit=function(C,D,E,F,G,H)local K,L=C:getPosition()local O,P=C:getSize()if E>=1 and E<=P then local Q=i(F,g(1-D+1,1),g(O-D+1,1))local R=i(G,g(1-D+1,1),g(O-D+1,1))local S=i(H,g(1-D+1,1),g(O-D+1,1))u.blit(g(D+K-1,K),L+E-1,Q,R,S)end end,setCursor=function(C,D,E,F,G)local H,K=C:getAbsolutePosition()local L,O=C:getOffset()z=D or false;if E~=nil then v=H+E-1-L end;if F~=nil then w=K+F-1-O end;A=G or A;if z then t.setTextColor(A)t.setCursorPos(v,w)t.setCursorBlink(z)else t.setCursorBlink(false)end;return C end}for C,D in pairs({mouse_click={"mouseHandler",true},mouse_up={"mouseUpHandler",false},mouse_drag={"dragHandler",false},mouse_scroll={"scrollHandler",true},mouse_hover={"hoverHandler",false}})do B[D[1]]=function(E,F,G,H,...)if m[D[1]](E,F,G,H,...)then l.setActiveFrame(E)end end end;for C,D in pairs({"drawBackgroundBox","drawForegroundBox","drawTextBox"})do B[D]=function(E,F,G,H,K,L)local O,P=E:getPosition()local Q,R=E:getSize()K=G<1 and(K+G>E:getHeight()and E:getHeight()or K+G-1)or(K+G>E:getHeight()and E:getHeight()-G+1 or K)H=F<1 and(H+F>E:getWidth()and E:getWidth()or H+F-1)or(H+F>E:getWidth()and E:getWidth()-F+1 or H)u[D](g(F+O-1,O),g(G+P-1,P),H,K,L)end end;for C,D in pairs({"setBG","setFG","setText"})do B[D]=function(E,F,G,H)local K,L=E:getPosition()local O,P=E:getSize()if G>=1 and G<=P then u[D](g(F+K-1,K),L+G-1,i(H,g(1-F+1,1),g(O-F+1,1)))end end end;B.__index=B;return setmetatable(B,m)end end;a["objects"]["Container"]=function(...)local e=d("utils")local f=e.tableCount;return function(g,h)local i=h.getObject("VisualObject")(g,h)local p="Container"local k={}local l={}local m={}local n;local o=true;local q,r=0,0;local s=function(K,L)if K.zIndex==L.zIndex then return K.objId<L.objId else return K.zIndex<L.zIndex end end;local t=function(K,L)if K.zIndex==L.zIndex then return K.evId>L.evId else return K.zIndex>L.zIndex end end;local function u(K)K:sortChildren()return k end;local function v(K,L)if type(L)=="table"then L=L:getName()end;for O,P in ipairs(k)do if P.element:getName()==L then return P.element end end end;local function w(K,L)local O=v(L)if O~=nil then return O end;for P,Q in ipairs(k)do if Q:getType()=="Container"then local R=Q:getDeepChild(L)if R~=nil then return R end end end end;local function z(K,L)if v(L:getName())~=nil then return end;q=q+1;local O=L:getZIndex()table.insert(k,{element=L,zIndex=O,objId=q})o=false;L:setParent(K,true)for P,Q in pairs(L:getRegisteredEvents())do K:addEvent(P,L)end;if L.init~=nil then L:init()end;if L.load~=nil then L:load()end;if L.draw~=nil then L:draw()end;return L end;local function A(K,L)if type(L)=="string"then L=v(L:getName())end;if L==nil then return end;for O,P in ipairs(k)do if P.element==L then table.remove(k,O)return true end end;K:removeEvents(L)o=false end;local function B(K)local L=K:getParent()k={}l={}o=false;q=0;r=0;n=nil;L:removeEvents(K)end;local function C(K,L,O)q=q+1;r=r+1;for P,Q in pairs(k)do if Q.element==L then Q.zIndex=O;Q.objId=q;break end end;for P,Q in pairs(l)do for R,S in pairs(Q)do if S.element==L then S.zIndex=O;S.evId=r end end end;o=false;K:updateDraw()end;local function D(K,L)local O=K:getParent()for P,Q in pairs(l)do for R,S in pairs(Q)do if S.element==L then table.remove(l[P],R)end end;if f(l[P])<=0 then if O~=nil then O:removeEvent(P,K)end end end;o=false end;local function E(K,L,O)if type(O)=="table"then O=O:getName()end;if l[L]~=nil then for P,Q in pairs(l[L])do if Q.element:getName()==O then return Q end end end end;local function F(K,L,O)if E(K,L,O:getName())~=nil then return end;local P=O:getZIndex()r=r+1;if l[L]==nil then l[L]={}end;table.insert(l[L],{element=O,zIndex=P,evId=r})o=false;K:listenEvent(L)return O end;local function G(K,L,O)if l[L]~=nil then for P,Q in pairs(l[L])do if Q.element==O then table.remove(l[L],P)end end;if f(l[L])<=0 then K:listenEvent(L,false)end end;o=false end;local function H(K,L)return L~=nil and l[L]or l end;m={getType=function()return p end,getBase=function(K)return i end,isType=function(K,L)return p==L or i.isType~=nil and i.isType(L)or false end,setSize=function(K,...)i.setSize(K,...)K:customEventHandler("basalt_FrameResize")return K end,setPosition=function(K,...)i.setPosition(K,...)K:customEventHandler("basalt_FrameReposition")return K end,searchChildren=function(K,L)local O={}for P,Q in pairs(k)do if string.find(Q.element:getName(),L)then table.insert(O,Q)end end;return O end,getChildrenByType=function(K,L)local O={}for P,Q in pairs(k)do if Q.element:isType(L)then table.insert(O,Q)end end;return O end,setImportant=function(K,L)q=q+1;r=r+1;for O,P in pairs(l)do for Q,R in pairs(P)do if R.element==L then R.evId=r;table.remove(l[O],Q)table.insert(l[O],R)break end end end;for O,P in ipairs(k)do if P.element==L then P.objId=q;table.remove(k,O)table.insert(k,P)break end end;if K.updateDraw~=nil then K:updateDraw()end;o=false end,sortChildren=function(K)if o then return end;table.sort(k,s)for L,O in pairs(l)do table.sort(l[L],t)end;o=true end,clearFocusedChild=function(K)if n~=nil then if v(K,n)~=nil then n:loseFocusHandler()end end;n=nil;return K end,setFocusedChild=function(K,L)if n~=L then if n~=nil then if v(K,n)~=nil then n:loseFocusHandler()end end;if L~=nil then if v(K,L)~=nil then L:getFocusHandler()end end;n=L;return true end;return false end,getFocused=function(K)return n end,getChild=v,getChildren=u,getDeepChildren=w,addChild=z,removeChild=A,removeChildren=B,getEvents=H,getEvent=E,addEvent=F,removeEvent=G,removeEvents=D,updateZIndex=C,listenEvent=function(K,L,O)i.listenEvent(K,L,O)if l[L]==nil then l[L]={}end;return K end,customEventHandler=function(K,...)i.customEventHandler(K,...)for L,O in pairs(k)do if O.element.customEventHandler~=nil then O.element:customEventHandler(...)end end end,loseFocusHandler=function(K)i.loseFocusHandler(K)if n~=nil then n:loseFocusHandler()n=nil end end,getBasalt=function(K)return h end,setPalette=function(K,L,...)local O=K:getParent()O:setPalette(L,...)return K end,eventHandler=function(K,...)if i.eventHandler~=nil then i.eventHandler(K,...)if l["other_event"]~=nil then K:sortChildren()for L,O in ipairs(l["other_event"])do if O.element.eventHandler~=nil then O.element.eventHandler(O.element,...)end end end end end}for K,L in pairs({mouse_click={"mouseHandler",true},mouse_up={"mouseUpHandler",false},mouse_drag={"dragHandler",false},mouse_scroll={"scrollHandler",true},mouse_hover={"hoverHandler",false}})do m[L[1]]=function(O,P,Q,R,...)if i[L[1]]~=nil then if i[L[1]](O,P,Q,R,...)then if l[K]~=nil then O:sortChildren()for S,T in ipairs(l[K])do if T.element[L[1]]~=nil then local U,Y=0,0;if O.getOffset~=nil then U,Y=O:getOffset()end;if T.element.getIgnoreOffset~=nil then if T.element.getIgnoreOffset()then U,Y=0,0 end end;if T.element[L[1]](T.element,P,Q+U,R+Y,...)then return true end end end;if L[2]then O:clearFocusedChild()end end;return true end end end end;for K,L in pairs({key="keyHandler",key_up="keyUpHandler",char="charHandler"})do m[L]=function(O,...)if i[L]~=nil then if i[L](O,...)then if l[K]~=nil then O:sortChildren()for P,Q in ipairs(l[K])do if Q.element[L]~=nil then if Q.element[L](Q.element,...)then return true end end end end end end end end;for K,L in pairs(h.getObjects())do m["add"..K]=function(O,P)return O:addChild(h:createObject(K,P))end end;m.__index=m;return setmetatable(m,i)end end;a["objects"]["Checkbox"]=function(...)local e=d("utils")local f=d("tHex")return function(g,h)local i=h.getObject("ChangeableObject")(g,h)local p="Checkbox"i:setZIndex(5)i:setValue(false)i:setSize(1,1)local k,l,m,n="\42"," ","","right"local o={load=function(q)q:listenEvent("mouse_click",q)q:listenEvent("mouse_up",q)end,getType=function(q)return p end,isType=function(q,r)return p==r or i.isType~=nil and i.isType(r)or false end,setSymbol=function(q,r,s)k=r or k;l=s or l;q:updateDraw()return q end,setActiveSymbol=function(q,r)return q:setSymbol(r,nil)end,setInactiveSymbol=function(q,r)return q:setSymbol(nil,r)end,getSymbol=function(q)return k,l end,getActiveSymbol=function(q)return k end,getInactiveSymbol=function(q)return l end,setText=function(q,r)m=r;return q end,getText=function(q)return m end,setTextPosition=function(q,r)n=r or n;return q end,getTextPosition=function(q)return n end,setChecked=i.setValue,getChecked=i.getValue,mouseHandler=function(q,r,s,t)if i.mouseHandler(q,r,s,t)then if r==1 then if q:getValue()~=true and q:getValue()~=false then q:setValue(false)else q:setValue(not q:getValue())end;q:updateDraw()return true end end;return false end,draw=function(q)i.draw(q)q:addDraw("checkbox",function()local r,s=q:getPosition()local t,u=q:getSize()local v=e.getTextVerticalAlign(u,"center")local w,z=q:getBackground(),q:getForeground()if q:getValue()then q:addBlit(1,v,e.getTextHorizontalAlign(k,t,"center"),f[z],f[w])else q:addBlit(1,v,e.getTextHorizontalAlign(l,t,"center"),f[z],f[w])end;if m~=""then local A=n=="left"and-m:len()or 3;q:addText(A,v,m)end end)end}o.__index=o;return setmetatable(o,i)end end;a["objects"]["Button"]=function(...)local e=d("utils")local f=d("tHex")return function(g,h)local i=h.getObject("VisualObject")(g,h)local p="Button"local k="center"local l="center"local m="Button"i:setSize(12,3)i:setZIndex(5)local n={getType=function(o)return p end,isType=function(o,q)return p==q or i.isType~=nil and i.isType(q)or false end,getBase=function(o)return i end,getHorizontalAlign=function(o)return k end,setHorizontalAlign=function(o,q)k=q;o:updateDraw()return o end,getVerticalAlign=function(o)return l end,setVerticalAlign=function(o,q)l=q;o:updateDraw()return o end,getText=function(o)return m end,setText=function(o,q)m=q;o:updateDraw()return o end,draw=function(o)i.draw(o)o:addDraw("button",function()local q,r=o:getSize()local s=e.getTextVerticalAlign(r,l)local t;if k=="center"then t=math.floor((q-m:len())/2)elseif k=="right"then t=q-m:len()end;o:addText(t+1,s,m)o:addFG(t+1,s,f[o:getForeground()or colors.white]:rep(m:len()))end)end}n.__index=n;return setmetatable(n,i)end end;a["objects"]["Dropdown"]=function(...)local e=d("utils")local f=d("tHex")return function(g,h)local i=h.getObject("List")(g,h)local p="Dropdown"i:setSize(12,1)i:setZIndex(6)local k=true;local l="left"local m=0;local n=0;local o=0;local q=true;local r="\16"local s="\31"local t=false;local u={getType=function(v)return p end,isType=function(v,w)return p==w or i.isType~=nil and i.isType(w)or false end,load=function(v)v:listenEvent("mouse_click",v)v:listenEvent("mouse_up",v)v:listenEvent("mouse_scroll",v)v:listenEvent("mouse_drag",v)end,setOffset=function(v,w)m=w;v:updateDraw()return v end,getOffset=function(v)return m end,addItem=function(v,w,...)i.addItem(v,w,...)if q then n=math.max(n,#w)o=o+1 end;return v end,removeItem=function(v,w)i.removeItem(v,w)if q then n=0;o=0;for Z=1,#list do n=math.max(n,#list[Z].text)end;o=#list end end,isOpened=function(v)return t end,setOpened=function(v,w)t=w;v:updateDraw()return v end,setDropdownSize=function(v,w,z)n,o=w,z;q=false;v:updateDraw()return v end,setDropdownWidth=function(v,w)return v:setDropdownSize(w,o)end,setDropdownHeight=function(v,w)return v:setDropdownSize(n,w)end,getDropdownSize=function(v)return n,o end,getDropdownWidth=function(v)return n end,getDropdownHeight=function(v)return o end,mouseHandler=function(v,w,z,A,B)if t then local D,E=v:getAbsolutePosition()if w==1 then local F=v:getAll()if#F>0 then for Z=1,o do if F[Z+m]~=nil then if D<=z and D+n>z and E+Z==A then v:setValue(F[Z+m])v:updateDraw()local G=v:sendEvent("mouse_click",v,"mouse_click",w,z,A)if G==false then return G end;if B then h.schedule(function()sleep(0.1)v:mouseUpHandler(w,z,A)end)()end;return true end end end end end end;local C=i:getBase()if C.mouseHandler(v,w,z,A)then t=not t;v:getParent():setImportant(v)v:updateDraw()return true else if t then v:updateDraw()t=false end;return false end end,mouseUpHandler=function(v,w,z,A)if t then local B,C=v:getAbsolutePosition()if w==1 then local D=v:getAll()if#D>0 then for Z=1,o do if D[Z+m]~=nil then if B<=z and B+n>z and C+Z==A then t=false;v:updateDraw()local E=v:sendEvent("mouse_up",v,"mouse_up",w,z,A)if E==false then return E end;return true end end end end end end end,dragHandler=function(v,w,z,A)if i.dragHandler(v,w,z,A)then t=true end end,scrollHandler=function(v,w,z,A)if t then local B,C=v:getAbsolutePosition()if z>=B and z<=B+n and A>=C and A<=C+o then v:setFocus()end end;if t and v:isFocused()then local B,C=v:getAbsolutePosition()if z<B or z>B+n or A<C or A>C+o then return false end;if#v:getAll()<=o then return false end;local D=v:getAll()m=m+w;if m<0 then m=0 end;if w==1 then if#D>o then if m>#D-o then m=#D-o end else m=math.min(#D-1,0)end end;local E=v:sendEvent("mouse_scroll",v,"mouse_scroll",w,z,A)if E==false then return E end;v:updateDraw()return true end end,draw=function(v)i.draw(v)v:setDrawState("list",false)v:addDraw("dropdown",function()local w,z=v:getPosition()local A,B=v:getSize()local C=v:getValue()local D=v:getAll()local E,F=v:getBackground(),v:getForeground()local G=e.getTextHorizontalAlign(C~=nil and C.text or"",A,l):sub(1,A-1)..(t and s or r)v:addBlit(1,1,G,f[F]:rep(#G),f[E]:rep(#G))if t then v:addTextBox(1,2,n,o," ")v:addBackgroundBox(1,2,n,o,E)v:addForegroundBox(1,2,n,o,F)for Z=1,o do if D[Z+m]~=nil then local H=e.getTextHorizontalAlign(D[Z+m].text,n,l)if D[Z+m]==C then if k then local K,L=v:getSelectionColor()v:addBlit(1,Z+1,H,f[L]:rep(#H),f[K]:rep(#H))else v:addBlit(1,Z+1,H,f[D[Z+m].fgCol]:rep(#H),f[D[Z+m].bgCol]:rep(#H))end else v:addBlit(1,Z+1,H,f[D[Z+m].fgCol]:rep(#H),f[D[Z+m].bgCol]:rep(#H))end end end end end)end}u.__index=u;return setmetatable(u,i)end end;a["objects"]["Flexbox"]=function(...)local function e(f,g)local h=0;local i=0;local p=0;local k,l=f:getSize()local m={getFlexGrow=function(n)return h end,setFlexGrow=function(n,o)h=o;return n end,getFlexShrink=function(n)return i end,setFlexShrink=function(n,o)i=o;return n end,getFlexBasis=function(n)return p end,setFlexBasis=function(n,o)p=o;return n end,getSize=function(n)return k,l end,getWidth=function(n)return k end,getHeight=function(n)return l end,setSize=function(n,o,q,r,s)f.setSize(n,o,q,r)if not s then k,l=f:getSize()end;return n end}m.__index=m;return setmetatable(m,f)end;return function(f,g)local h=g.getObject("ScrollableFrame")(f,g)local i="Flexbox"local p="row"local k=1;local l="flex-start"local m="nowrap"local n={}local o={}local q=false;local r=e({getHeight=function(z)return 0 end,getWidth=function(z)return 0 end,getPosition=function(z)return 0,0 end,getSize=function(z)return 0,0 end,isType=function(z)return false end,getType=function(z)return"lineBreakFakeObject"end,setPosition=function(z)end,setSize=function(z)end})r:setFlexBasis(0):setFlexGrow(0):setFlexShrink(0)local function s(z)if m=="nowrap"then o={}local A=1;local B=1;local C=1;for D,E in pairs(n)do if o[A]==nil then o[A]={offset=1}end;local F=p=="row"and E:getHeight()or E:getWidth()if F>B then B=F end;if E==r then C=C+B+k;B=1;A=A+1;o[A]={offset=C}else table.insert(o[A],E)end end elseif m=="wrap"then o={}local A=1;local B=1;local C=p=="row"and z:getWidth()or z:getHeight()local D=0;local E=1;for F,G in pairs(n)do if o[E]==nil then o[E]={offset=1}end;if G==r then B=B+A+k;D=0;A=1;E=E+1;o[E]={offset=B}else local H=p=="row"and G:getWidth()or G:getHeight()if H+D<=C then table.insert(o[E],G)D=D+H+k else B=B+A+k;A=p=="row"and G:getHeight()or G:getWidth()E=E+1;D=H+k;o[E]={offset=B,G}end;local K=p=="row"and G:getHeight()or G:getWidth()if K>A then A=K end end end end end;local function t(z,A)local B,C=z:getSize()local D=0;local E=0;local F=0;for K,L in ipairs(A)do D=D+L:getFlexGrow()E=E+L:getFlexShrink()F=F+L:getFlexBasis()end;local G=B-F-k*(#A-1)local H=1;for K,L in ipairs(A)do if L~=r then local O;local P=L:getFlexGrow()local Q=L:getFlexShrink()local R=L:getFlexBasis()~=0 and L:getFlexBasis()or L:getWidth()if D>0 then O=R+P/D*G else O=R end;if G<0 and E>0 then O=R+Q/E*G end;L:setPosition(H,A.offset or 1)L:setSize(O,L:getHeight(),false,true)H=H+O+k end end;if l=="flex-end"then local K=H-k;local L=B-K+1;for O,P in ipairs(A)do local Q,R=P:getPosition()P:setPosition(Q+L,R)end elseif l=="center"then local K=H-k;local L=(B-K)/2+1;for O,P in ipairs(A)do local Q,R=P:getPosition()P:setPosition(Q+L,R)end elseif l=="space-between"then local K=H-k;local L=(B-K)/(#A-1)+1;for O,P in ipairs(A)do if O>1 then local Q,R=P:getPosition()P:setPosition(Q+L*(O-1),R)end end elseif l=="space-around"then local K=H-k;local L=(B-K)/#A;for O,P in ipairs(A)do local Q,R=P:getPosition()P:setPosition(Q+L*O-L/2,R)end elseif l=="space-evenly"then local K=#A+1;local L=0;for R,S in ipairs(A)do L=L+S:getWidth()end;local O=B-L;local P=math.floor(O/K)local Q=O-P*K;H=P+(Q>0 and 1 or 0)Q=Q>0 and Q-1 or 0;for R,S in ipairs(A)do S:setPosition(H,1)H=H+S:getWidth()+P+(Q>0 and 1 or 0)Q=Q>0 and Q-1 or 0 end end end;local function u(z,A)local B,C=z:getSize()local D=0;local E=0;local F=0;for K,L in ipairs(A)do D=D+L:getFlexGrow()E=E+L:getFlexShrink()F=F+L:getFlexBasis()end;local G=C-F-k*(#A-1)local H=1;for K,L in ipairs(A)do if L~=r then local O;local P=L:getFlexGrow()local Q=L:getFlexShrink()local R=L:getFlexBasis()~=0 and L:getFlexBasis()or L:getHeight()if D>0 then O=R+P/D*G else O=R end;if G<0 and E>0 then O=R+Q/E*G end;L:setPosition(A.offset,H)L:setSize(L:getWidth(),O,false,true)H=H+O+k end end;if l=="flex-end"then local K=H-k;local L=C-K+1;for O,P in ipairs(A)do local Q,R=P:getPosition()P:setPosition(Q,R+L)end elseif l=="center"then local K=H-k;local L=(C-K)/2;for O,P in ipairs(A)do local Q,R=P:getPosition()P:setPosition(Q,R+L)end elseif l=="space-between"then local K=H-k;local L=(C-K)/(#A-1)+1;for O,P in ipairs(A)do if O>1 then local Q,R=P:getPosition()P:setPosition(Q,R+L*(O-1))end end elseif l=="space-around"then local K=H-k;local L=(C-K)/#A;for O,P in ipairs(A)do local Q,R=P:getPosition()P:setPosition(Q,R+L*O-L/2)end elseif l=="space-evenly"then local K=#A+1;local L=0;for R,S in ipairs(A)do L=L+S:getHeight()end;local O=C-L;local P=math.floor(O/K)local Q=O-P*K;H=P+(Q>0 and 1 or 0)Q=Q>0 and Q-1 or 0;for R,S in ipairs(A)do local T,U=S:getPosition()S:setPosition(T,H)H=H+S:getHeight()+P+(Q>0 and 1 or 0)Q=Q>0 and Q-1 or 0 end end end;local function v(z)s(z)if p=="row"then for A,B in pairs(o)do t(z,B)end else for A,B in pairs(o)do u(z,B)end end;q=false end;local w={getType=function()return i end,isType=function(z,A)return i==A or h.isType~=nil and h.isType(A)or false end,setJustifyContent=function(z,A)l=A;q=true;z:updateDraw()return z end,getJustifyContent=function(z)return l end,setDirection=function(z,A)p=A;q=true;z:updateDraw()return z end,getDirection=function(z)return p end,setSpacing=function(z,A)k=A;q=true;z:updateDraw()return z end,getSpacing=function(z)return k end,setWrap=function(z,A)m=A;q=true;z:updateDraw()return z end,getWrap=function(z)return m end,updateLayout=function(z)q=true;z:updateDraw()end,addBreak=function(z)table.insert(n,r)q=true;z:updateDraw()return z end,customEventHandler=function(z,A,...)h.customEventHandler(z,A,...)if A=="basalt_FrameResize"then q=true end end,draw=function(z)h.draw(z)z:addDraw("flexboxDraw",function()if q then v(z)end end,1)end}for z,A in pairs(g.getObjects())do w["add"..z]=function(B,C)local D=h["add"..z](B,C)local E=e(D,g)table.insert(n,E)q=true;return E end end;w.__index=w;return setmetatable(w,h)end end;a["objects"]["Label"]=function(...)local e=d("utils")local f=e.wrapText;local g=e.writeWrappedText;local h=d("tHex")return function(i,p)local k=p.getObject("VisualObject")(i,p)local l="Label"k:setZIndex(3)k:setSize(5,1)k:setBackground(false)local m=true;local n,o="Label","left"local q={getType=function(r)return l end,getBase=function(r)return k end,setText=function(r,s)n=tostring(s)if m then local t=f(n,#n)local u,v=1,1;for w,z in pairs(t)do v=v+1;u=math.max(u,z:len())end;r:setSize(u,v)m=true end;r:updateDraw()return r end,getAutoSize=function(r)return m end,setAutoSize=function(r,s)m=s;return r end,getText=function(r)return n end,setSize=function(r,s,t)k.setSize(r,s,t)m=false;return r end,getTextAlign=function(r)return o end,setTextAlign=function(r,s)o=s or o;return r end,draw=function(r)k.draw(r)r:addDraw("label",function()local s,t=r:getSize()local u=o=="center"and math.floor(s/2-n:len()/2+0.5)or o=="right"and s-(n:len()-1)or 1;g(r,u,1,n,s+1,t)end)end,init=function(r)k.init(r)local s=r:getParent()r:setForeground(s:getForeground())end}q.__index=q;return setmetatable(q,k)end end;a["objects"]["Input"]=function(...)local e=d("utils")local f=d("tHex")return function(g,h)local i=h.getObject("ChangeableObject")(g,h)local p="Input"local k="text"local l=0;i:setZIndex(5)i:setValue("")i:setSize(12,1)local m=1;local n=1;local o=""local q=colors.black;local r=colors.lightGray;local s=o;local t=false;local u={load=function(v)v:listenEvent("mouse_click")v:listenEvent("key")v:listenEvent("char")v:listenEvent("other_event")v:listenEvent("mouse_drag")end,getType=function(v)return p end,isType=function(v,w)return p==w or i.isType~=nil and i.isType(w)or false end,setDefaultFG=function(v,w)return v:setDefaultText(v,o,w,nil)end,setDefaultBG=function(v,w)return v:setDefaultText(v,o,nil,w)end,setDefaultText=function(v,w,z,A)o=w;r=z or r;q=A or q;if v:isFocused()then s=""else s=o end;v:updateDraw()return v end,getDefaultText=function(v)return o,r,q end,setOffset=function(v,w)n=w;v:updateDraw()return v end,getOffset=function(v)return n end,setTextOffset=function(v,w)m=w;v:updateDraw()return v end,getTextOffset=function(v)return m end,setInputType=function(v,w)k=w;v:updateDraw()return v end,getInputType=function(v)return k end,setValue=function(v,w)i.setValue(v,tostring(w))if not t then m=tostring(w):len()+1;n=math.max(1,m-v:getWidth()+1)if v:isFocused()then local z=v:getParent()local A,B=v:getPosition()z:setCursor(true,A+m-n,B+math.floor(v:getHeight()/2),v:getForeground())end end;v:updateDraw()return v end,getValue=function(v)local w=i.getValue(v)return k=="number"and tonumber(w)or w end,setInputLimit=function(v,w)l=tonumber(w)or l;v:updateDraw()return v end,getInputLimit=function(v)return l end,getFocusHandler=function(v)i.getFocusHandler(v)local w=v:getParent()if w~=nil then local z,A=v:getPosition()s=""if o~=""then v:updateDraw()end;w:setCursor(true,z+m-n,A+math.max(math.ceil(v:getHeight()/2-1,1)),v:getForeground())end end,loseFocusHandler=function(v)i.loseFocusHandler(v)local w=v:getParent()s=o;if o~=""then v:updateDraw()end;w:setCursor(false)end,keyHandler=function(v,w)if i.keyHandler(v,w)then local z,A=v:getSize()local B=v:getParent()t=true;if w==keys.backspace then local F=tostring(i.getValue())if m>1 then v:setValue(F:sub(1,m-2)..F:sub(m,F:len()))m=math.max(m-1,1)if m<n then n=math.max(n-1,1)end end end;if w==keys.enter then B:clearFocusedChild(v)end;if w==keys.right then local F=tostring(i.getValue()):len()m=m+1;if m>F then m=F+1 end;m=math.max(m,1)if m<n or m>=z+n then n=m-z+1 end;n=math.max(n,1)end;if w==keys.left then m=m-1;if m>=1 then if m<n or m>=z+n then n=m end end;m=math.max(m,1)n=math.max(n,1)end;local C,D=v:getPosition()local E=tostring(i.getValue())v:updateDraw()t=false;return true end end,charHandler=function(v,w)if i.charHandler(v,w)then t=true;local z,A=v:getSize()local B=i.getValue()if B:len()<l or l<=0 then if k=="number"then local F=B;if m==1 and w=="-"or w=="."or tonumber(w)~=nil then v:setValue(B:sub(1,m-1)..w..B:sub(m,B:len()))m=m+1;if w=="."or w=="-"and#B>0 then if tonumber(i.getValue())==nil then v:setValue(F)m=m-1 end end end else v:setValue(B:sub(1,m-1)..w..B:sub(m,B:len()))m=m+1 end;if m>=z+n then n=n+1 end end;local C,D=v:getPosition()local E=tostring(i.getValue())t=false;v:updateDraw()return true end end,mouseHandler=function(v,w,z,A)if i.mouseHandler(v,w,z,A)then local B=v:getParent()local C,D=v:getPosition()local E,F=v:getAbsolutePosition(C,D)local G,H=v:getSize()m=z-E+n;local K=i.getValue()if m>K:len()then m=K:len()+1 end;if m<n then n=m-1;if n<1 then n=1 end end;B:setCursor(true,C+m-n,D+math.max(math.ceil(H/2-1,1)),v:getForeground())return true end end,dragHandler=function(v,w,z,A,B,C)if v:isFocused()then if v:isCoordsInObject(z,A)then if i.dragHandler(v,w,z,A,B,C)then return true end end;local D=v:getParent()D:clearFocusedChild()end end,draw=function(v)i.draw(v)v:addDraw("input",function()local w=v:getParent()local z,A=v:getPosition()local B,C=v:getSize()local D=e.getTextVerticalAlign(C,textVerticalAlign)local E=tostring(i.getValue())local F=v:getBackground()local G=v:getForeground()local H;if E:len()<=0 then H=s;F=q or F;G=r or G end;H=s;if E~=""then H=E end;H=H:sub(n,B+n-1)local K=B-H:len()if K<0 then K=0 end;if k=="password"and E~=""then H=string.rep("*",H:len())end;H=H..string.rep(" ",K)v:addBlit(1,D,H,f[G]:rep(H:len()),f[F]:rep(H:len()))if v:isFocused()then w:setCursor(true,z+m-n,A+math.floor(v:getHeight()/2),v:getForeground())end end)end}u.__index=u;return setmetatable(u,i)end end;a["objects"]["Menubar"]=function(...)local e=d("utils")local f=d("tHex")return function(g,h)local i=h.getObject("List")(g,h)local p="Menubar"local k={}i:setSize(30,1)i:setZIndex(5)local l=0;local m,n=1,1;local o=true;local function q()local r=0;local s=i:getWidth()local t=i:getAll()for Z=1,#t do r=r+t[Z].text:len()+m*2 end;return math.max(r-s,0)end;k={init=function(r)local s=r:getParent()r:listenEvent("mouse_click")r:listenEvent("mouse_drag")r:listenEvent("mouse_scroll")return i.init(r)end,getType=function(r)return p end,getBase=function(r)return i end,setSpace=function(r,s)m=s or m;r:updateDraw()return r end,getSpace=function(r)return m end,setScrollable=function(r,s)o=s;if s==nil then o=true end;return r end,getScrollable=function(r)return o end,mouseHandler=function(r,s,t,u)if i:getBase().mouseHandler(r,s,t,u)then local v,w=r:getAbsolutePosition()local z,A=r:getSize()local B=0;local C=r:getAll()for Z=1,#C do if C[Z]~=nil then if v+B<=t+l and v+B+C[Z].text:len()+m*2>t+l and w==u then r:setValue(C[Z])r:sendEvent(event,r,event,0,t,u,C[Z])end;B=B+C[Z].text:len()+m*2 end end;r:updateDraw()return true end end,scrollHandler=function(r,s,t,u)if i:getBase().scrollHandler(r,s,t,u)then if o then l=l+s;if l<0 then l=0 end;local v=q()if l>v then l=v end;r:updateDraw()end;return true end;return false end,draw=function(r)i.draw(r)r:addDraw("list",function()local s=r:getParent()local t,u=r:getSize()local v=""local w=""local z=""local A,B=r:getSelectionColor()for C,D in pairs(r:getAll())do local E=(" "):rep(m)..D.text..(" "):rep(m)v=v..E;if D==r:getValue()then w=w..f[A or D.bgCol or r:getBackground()]:rep(E:len())z=z..f[B or D.FgCol or r:getForeground()]:rep(E:len())else w=w..f[D.bgCol or r:getBackground()]:rep(E:len())z=z..f[D.FgCol or r:getForeground()]:rep(E:len())end end;r:addBlit(1,1,v:sub(l+1,t+l),z:sub(l+1,t+l),w:sub(l+1,t+l))end)end}k.__index=k;return setmetatable(k,i)end end;a["objects"]["Pane"]=function(...)return function(e,f)local g=f.getObject("VisualObject")(e,f)local h="Pane"g:setSize(25,10)local i={getType=function(p)return h end}i.__index=i;return setmetatable(i,g)end end;a["objects"]["Slider"]=function(...)local e=d("tHex")return function(f,g)local h=g.getObject("ChangeableObject")(f,g)local i="Slider"h:setSize(12,1)h:setValue(1)h:setBackground(false,"\140",colors.black)local p="horizontal"local k=" "local l=colors.black;local m=colors.gray;local n=12;local o=1;local q=1;local function r(t,u,v,w)local z,A=t:getPosition()local B,C=t:getSize()local D=p=="vertical"and C or B;for an=0,D do if(p=="vertical"and A+an==w or p=="horizontal"and z+an==v)and z<=v and z+B>v and A<=w and A+C>w then o=math.min(an+1,D-(#k+q-2))t:setValue(n/D*o)t:updateDraw()end end end;local s={getType=function(t)return i end,load=function(t)t:listenEvent("mouse_click")t:listenEvent("mouse_drag")t:listenEvent("mouse_scroll")end,setSymbol=function(t,u)k=u:sub(1,1)t:updateDraw()return t end,getSymbol=function(t)return k end,setIndex=function(t,u)o=u;if o<1 then o=1 end;local v,w=t:getSize()o=math.min(o,(p=="vertical"and w or v)-(q-1))t:setValue(n/(p=="vertical"and w or v)*o)t:updateDraw()return t end,getIndex=function(t)return o end,setMaxValue=function(t,u)n=u;return t end,getMaxValue=function(t)return n end,setSymbolColor=function(t,u)symbolColor=u;t:updateDraw()return t end,getSymbolColor=function(t)return symbolColor end,setBarType=function(t,u)p=u:lower()t:updateDraw()return t end,getBarType=function(t)return p end,mouseHandler=function(t,u,v,w)if h.mouseHandler(t,u,v,w)then r(t,u,v,w)return true end;return false end,dragHandler=function(t,u,v,w)if h.dragHandler(t,u,v,w)then r(t,u,v,w)return true end;return false end,scrollHandler=function(t,u,v,w)if h.scrollHandler(t,u,v,w)then local z,A=t:getSize()o=o+u;if o<1 then o=1 end;o=math.min(o,(p=="vertical"and A or z)-(q-1))t:setValue(n/(p=="vertical"and A or z)*o)t:updateDraw()return true end;return false end,draw=function(t)h.draw(t)t:addDraw("slider",function()local u,v=t:getSize()local w,z=t:getBackground(),t:getForeground()if p=="horizontal"then t:addText(o,oby,k:rep(q))if m~=false then t:addBG(o,1,e[m]:rep(#k*q))end;if l~=false then t:addFG(o,1,e[l]:rep(#k*q))end end;if p=="vertical"then for Z=0,v-1 do if o==Z+1 then for av=0,math.min(q-1,v)do t:addBlit(1,1+Z+av,k,e[symbolColor],e[symbolColor])end else if Z+1<o or Z+1>o-1+q then t:addBlit(1,1+Z,bgSymbol,e[z],e[w])end end end end end)end}s.__index=s;return setmetatable(s,h)end end;a["objects"]["MovableFrame"]=function(...)local e,f,g,h=math.max,math.min,string.sub,string.rep;return function(i,p)local k=p.getObject("Frame")(i,p)local l="MovableFrame"local m;local n,o,q=0,0,false;local r={{x1=1,x2="width",y1=1,y2=1}}local s={getType=function()return l end,setDraggingMap=function(t,u)r=u;return t end,getDraggingMap=function(t)return r end,isType=function(t,u)return l==u or k.isType~=nil and k.isType(u)or false end,getBase=function(t)return k end,load=function(t)k.load(t)t:listenEvent("mouse_click")t:listenEvent("mouse_up")t:listenEvent("mouse_drag")end,removeChildren=function(t)k.removeChildren(t)t:listenEvent("mouse_click")t:listenEvent("mouse_up")t:listenEvent("mouse_drag")end,dragHandler=function(t,u,v,w)if k.dragHandler(t,u,v,w)then if q then local z,A=m:getOffset()z=z<0 and math.abs(z)or-z;A=A<0 and math.abs(A)or-A;local B=1;local C=1;B,C=m:getAbsolutePosition()t:setPosition(v+n-(B-1)+z,w+o-(C-1)+A)t:updateDraw()end;return true end end,mouseHandler=function(t,u,v,w,...)if k.mouseHandler(t,u,v,w,...)then m:setImportant(t)local z,A=t:getAbsolutePosition()local B,C=t:getSize()for D,E in pairs(r)do local F,G=E.x1=="width"and B or E.x1,E.x2=="width"and B or E.x2;local H,K=E.y1=="height"and C or E.y1,E.y2=="height"and C or E.y2;if v>=z+F-1 and v<=z+G-1 and w>=A+H-1 and w<=A+K-1 then q=true;n=z-v;o=A-w;return true end end;return true end end,mouseUpHandler=function(t,...)q=false;return k.mouseUpHandler(t,...)end,setParent=function(t,u,...)k.setParent(t,u,...)m=u;return t end}s.__index=s;return setmetatable(s,k)end end;a["objects"]["Radio"]=function(...)local e=d("utils")local f=d("tHex")return function(g,h)local i=h.getObject("List")(g,h)local p="Radio"i:setSize(1,1)i:setZIndex(5)local k={}local l=colors.black;local m=colors.green;local n=colors.black;local o=colors.red;local q=true;local r="\7"local s="left"local t={getType=function(u)return p end,addItem=function(u,v,w,z,A,B,...)i.addItem(u,v,A,B,...)table.insert(k,{x=w or 1,y=z or#k*2})return u end,removeItem=function(u,v)i.removeItem(u,v)table.remove(k,v)return u end,clear=function(u)i.clear(u)k={}return u end,editItem=function(u,v,w,z,A,B,C,...)i.editItem(u,v,w,B,C,...)table.remove(k,v)table.insert(k,v,{x=z or 1,y=A or 1})return u end,setBoxSelectionColor=function(u,v,w)l=v;m=w;return u end,setBoxSelectionBG=function(u,v)return u:setBoxSelectionColor(v,m)end,setBoxSelectionFG=function(u,v)return u:setBoxSelectionColor(l,v)end,getBoxSelectionColor=function(u)return l,m end,getBoxSelectionBG=function(u)return l end,getBoxSelectionFG=function(u)return m end,setBoxDefaultColor=function(u,v,w)n=v;o=w;return u end,setBoxDefaultBG=function(u,v)return u:setBoxDefaultColor(v,o)end,setBoxDefaultFG=function(u,v)return u:setBoxDefaultColor(n,v)end,getBoxDefaultColor=function(u)return n,o end,getBoxDefaultBG=function(u)return n end,getBoxDefaultFG=function(u)return o end,mouseHandler=function(u,v,w,z,...)if#k>0 then local A,B=u:getAbsolutePosition()local C=u:getAll()for D,E in pairs(C)do if A+k[D].x-1<=w and A+k[D].x-1+E.text:len()+1>=w and B+k[D].y-1==z then u:setValue(E)local F=u:sendEvent("mouse_click",u,"mouse_click",v,w,z,...)u:updateDraw()if F==false then return F end;return true end end end end,draw=function(u)u:addDraw("radio",function()local v,w=u:getSelectionColor()local z=u:getAll()for A,B in pairs(z)do if B==u:getValue()then u:addBlit(k[A].x,k[A].y,r,f[m],f[l])u:addBlit(k[A].x+2,k[A].y,B.text,f[w]:rep(#B.text),f[v]:rep(#B.text))else u:addBackgroundBox(k[A].x,k[A].y,1,1,n or colors.black)u:addBlit(k[A].x+2,k[A].y,B.text,f[B.fgCol]:rep(#B.text),f[B.bgCol]:rep(#B.text))end end;return true end)end}t.__index=t;return setmetatable(t,i)end end;a["objects"]["VisualObject"]=function(...)local e=d("utils")local f=d("tHex")local g,h,i=string.sub,string.find,table.insert;return function(p,k)local l=k.getObject("Object")(p,k)local m="VisualObject"local n,o,q,r,s=true,false,false,false,false;local t=1;local u,v,w,z=1,1,1,1;local A,B,C,D=0,0,0,0;local E,F,G=colors.black,colors.white,false;local H;local K={}local L={}local O={}local P={}local function Q(S,T)local U={}if S==""then return U end;T=T or" "local Y=1;local a0,a1=h(S,T,Y)while a0 do i(U,{x=Y,value=g(S,Y,a0-1)})Y=a1+1;a0,a1=h(S,T,Y)end;i(U,{x=Y,value=g(S,Y)})return U end;local R={getType=function(S)return m end,getBase=function(S)return l end,isType=function(S,T)return m==T or l.isType~=nil and l.isType(T)or false end,getBasalt=function(S)return k end,show=function(S)n=true;S:updateDraw()return S end,hide=function(S)n=false;S:updateDraw()return S end,isVisible=function(S)return n end,setVisible=function(S,T)n=T or not n;S:updateDraw()return S end,setTransparency=function(S,T)G=T~=nil and T or true;S:updateDraw()return S end,setParent=function(S,T,U)l.setParent(S,T,U)H=T;return S end,setFocus=function(S)if H~=nil then H:setFocusedChild(S)end;return S end,setZIndex=function(S,T)t=T;if H~=nil then H:updateZIndex(S,t)S:updateDraw()end;return S end,getZIndex=function(S)return t end,updateDraw=function(S)if H~=nil then H:updateDraw()end;return S end,setPosition=function(S,T,U,Y)local a0,a1=u,v;if type(T)=="number"then u=Y and u+T or T end;if type(U)=="number"then v=Y and v+U or U end;if H~=nil then H:customEventHandler("basalt_FrameReposition",S)end;if S:getType()=="Container"then H:customEventHandler("basalt_FrameReposition",S)end;S:updateDraw()S:repositionHandler(a0,a1)return S end,getX=function(S)return u end,setX=function(S,T)return S:setPosition(T,v)end,getY=function(S)return v end,setY=function(S,T)return S:setPosition(u,T)end,getPosition=function(S)return u,v end,setSize=function(S,T,U,Y)local a0,a1=w,z;if type(T)=="number"then w=Y and w+T or T end;if type(U)=="number"then z=Y and z+U or U end;if H~=nil then H:customEventHandler("basalt_FrameResize",S)if S:getType()=="Container"then H:customEventHandler("basalt_FrameResize",S)end end;S:resizeHandler(a0,a1)S:updateDraw()return S end,getHeight=function(S)return z end,setHeight=function(S,T)return S:setSize(w,T)end,getWidth=function(S)return w end,setWidth=function(S,T)return S:setSize(T,z)end,getSize=function(S)return w,z end,setBackground=function(S,T)E=T;S:updateDraw()return S end,getBackground=function(S)return E end,setForeground=function(S,T)F=T or false;S:updateDraw()return S end,getForeground=function(S)return F end,getAbsolutePosition=function(S,T,U)if T==nil or U==nil then T,U=S:getPosition()end;if H~=nil then local Y,a0=H:getAbsolutePosition()T=Y+T-1;U=a0+U-1 end;return T,U end,ignoreOffset=function(S,T)o=T;if T==nil then o=true end;return S end,getIgnoreOffset=function(S)return o end,isCoordsInObject=function(S,T,U)if n and S:isEnabled()then if T==nil or U==nil then return false end;local Y,a0=S:getAbsolutePosition()local a1,a2=S:getSize()if Y<=T and Y+a1>T and a0<=U and a0+a2>U then return true end end;return false end,onGetFocus=function(S,...)for T,U in pairs(table.pack(...))do if type(U)=="function"then S:registerEvent("get_focus",U)end end;return S end,onLoseFocus=function(S,...)for T,U in pairs(table.pack(...))do if type(U)=="function"then S:registerEvent("lose_focus",U)end end;return S end,isFocused=function(S)if H~=nil then return H:getFocused()==S end;return true end,resizeHandler=function(S,...)if S:isEnabled()then local T=S:sendEvent("basalt_resize",...)if T==false then return false end end;return true end,repositionHandler=function(S,...)if S:isEnabled()then local T=S:sendEvent("basalt_reposition",...)if T==false then return false end end;return true end,onResize=function(S,...)for T,U in pairs(table.pack(...))do if type(U)=="function"then S:registerEvent("basalt_resize",U)end end;return S end,onReposition=function(S,...)for T,U in pairs(table.pack(...))do if type(U)=="function"then S:registerEvent("basalt_reposition",U)end end;return S end,mouseHandler=function(S,T,U,Y,a0)if S:isCoordsInObject(U,Y)then local a1,a2=S:getAbsolutePosition()local a3=S:sendEvent("mouse_click",T,U-(a1-1),Y-(a2-1),U,Y,a0)if a3==false then return false end;if H~=nil then H:setFocusedChild(S)end;r=true;s=true;A,B=U,Y;return true end end,mouseUpHandler=function(S,T,U,Y)s=false;if r then local a0,a1=S:getAbsolutePosition()local a2=S:sendEvent("mouse_release",T,U-(a0-1),Y-(a1-1),U,Y)r=false end;if S:isCoordsInObject(U,Y)then local a0,a1=S:getAbsolutePosition()local a2=S:sendEvent("mouse_up",T,U-(a0-1),Y-(a1-1),U,Y)if a2==false then return false end;return true end end,dragHandler=function(S,T,U,Y)if s then local a0,a1=S:getAbsolutePosition()local a2=S:sendEvent("mouse_drag",T,U-(a0-1),Y-(a1-1),A-U,B-Y,U,Y)A,B=U,Y;if a2==false then return false end;if H~=nil then H:setFocusedChild(S)end;return true end;if S:isCoordsInObject(U,Y)then local a0,a1=S:getAbsolutePosition()A,B=U,Y;C,D=a0-U,a1-Y end end,scrollHandler=function(S,T,U,Y)if S:isCoordsInObject(U,Y)then local a0,a1=S:getAbsolutePosition()local a2=S:sendEvent("mouse_scroll",T,U-(a0-1),Y-(a1-1))if a2==false then return false end;if H~=nil then H:setFocusedChild(S)end;return true end end,hoverHandler=function(S,T,U,Y)if S:isCoordsInObject(T,U)then local a0=S:sendEvent("mouse_hover",T,U,Y)if a0==false then return false end;q=true;return true end;if q then local a0=S:sendEvent("mouse_leave",T,U,Y)if a0==false then return false end;q=false end end,keyHandler=function(S,T,U)if S:isEnabled()and n then if S:isFocused()then local Y=S:sendEvent("key",T,U)if Y==false then return false end;return true end end end,keyUpHandler=function(S,T)if S:isEnabled()and n then if S:isFocused()then local U=S:sendEvent("key_up",T)if U==false then return false end;return true end end end,charHandler=function(S,T)if S:isEnabled()and n then if S:isFocused()then local U=S:sendEvent("char",T)if U==false then return false end;return true end end end,getFocusHandler=function(S)local T=S:sendEvent("get_focus")if T~=nil then return T end;return true end,loseFocusHandler=function(S)s=false;local T=S:sendEvent("lose_focus")if T~=nil then return T end;return true end,addDraw=function(S,T,U,Y,a0,a1)local a2=(a0==nil or a0==1)and L or a0==2 and K or a0==3 and O;Y=Y or#a2+1;if T~=nil then for a4,a5 in pairs(a2)do if a5.name==T then table.remove(a2,a4)break end end;local a3={name=T,f=U,pos=Y,active=a1~=nil and a1 or true}table.insert(a2,Y,a3)end;S:updateDraw()return S end,addPreDraw=function(S,T,U,Y,a0)S:addDraw(T,U,Y,2)return S end,addPostDraw=function(S,T,U,Y,a0)S:addDraw(T,U,Y,3)return S end,setDrawState=function(S,T,U,Y)local a0=(Y==nil or Y==1)and L or Y==2 and K or Y==3 and O;for a1,a2 in pairs(a0)do if a2.name==T then a2.active=U;break end end;S:updateDraw()return S end,getDrawId=function(S,T,U)local Y=U==1 and L or U==2 and K or U==3 and O or L;for a0,a1 in pairs(Y)do if a1.name==T then return a0 end end end,addText=function(S,T,U,Y)local a0=S:getParent()or S;local a1,a2=S:getPosition()if H~=nil then local a4,a5=H:getOffset()a1=o and a1 or a1-a4;a2=o and a2 or a2-a5 end;if not G then a0:setText(T+a1-1,U+a2-1,Y)return end;local a3=Q(Y,"\0")for a4,a5 in pairs(a3)do if a5.value~=""and a5.value~="\0"then a0:setText(T+a5.x+a1-2,U+a2-1,a5.value)end end end,addBG=function(S,T,U,Y,a0)local a1=H or S;local a2,a3=S:getPosition()if H~=nil then local a5,a6=H:getOffset()a2=o and a2 or a2-a5;a3=o and a3 or a3-a6 end;if not G then a1:setBG(T+a2-1,U+a3-1,Y)return end;local a4=Q(Y)for a5,a6 in pairs(a4)do if a6.value~=""and a6.value~=" "then if a0~=true then a1:setText(T+a6.x+a2-2,U+a3-1,(" "):rep(#a6.value))a1:setBG(T+a6.x+a2-2,U+a3-1,a6.value)else table.insert(P,{x=T+a6.x-1,y=U,bg=a6.value})a1:setBG(T+a2-1,U+a3-1,fg)end end end end,addFG=function(S,T,U,Y)local a0=H or S;local a1,a2=S:getPosition()if H~=nil then local a4,a5=H:getOffset()a1=o and a1 or a1-a4;a2=o and a2 or a2-a5 end;if not G then a0:setFG(T+a1-1,U+a2-1,Y)return end;local a3=Q(Y)for a4,a5 in pairs(a3)do if a5.value~=""and a5.value~=" "then a0:setFG(T+a5.x+a1-2,U+a2-1,a5.value)end end end,addBlit=function(S,T,U,Y,a0,a1)local a2=H or S;local a3,a4=S:getPosition()if H~=nil then local a8,a9=H:getOffset()a3=o and a3 or a3-a8;a4=o and a4 or a4-a9 end;if not G then a2:blit(T+a3-1,U+a4-1,Y,a0,a1)return end;local a5=Q(Y,"\0")local a6=Q(a0)local a7=Q(a1)for a8,a9 in pairs(a5)do if a9.value~=""or a9.value~="\0"then a2:setText(T+a9.x+a3-2,U+a4-1,a9.value)end end;for a8,a9 in pairs(a7)do if a9.value~=""or a9.value~=" "then a2:setBG(T+a9.x+a3-2,U+a4-1,a9.value)end end;for a8,a9 in pairs(a6)do if a9.value~=""or a9.value~=" "then a2:setFG(T+a9.x+a3-2,U+a4-1,a9.value)end end end,addTextBox=function(S,T,U,Y,a0,a1)local a2=H or S;local a3,a4=S:getPosition()if H~=nil then local a5,a6=H:getOffset()a3=o and a3 or a3-a5;a4=o and a4 or a4-a6 end;a2:drawTextBox(T+a3-1,U+a4-1,Y,a0,a1)end,addForegroundBox=function(S,T,U,Y,a0,a1)local a2=H or S;local a3,a4=S:getPosition()if H~=nil then local a5,a6=H:getOffset()a3=o and a3 or a3-a5;a4=o and a4 or a4-a6 end;a2:drawForegroundBox(T+a3-1,U+a4-1,Y,a0,a1)end,addBackgroundBox=function(S,T,U,Y,a0,a1)local a2=H or S;local a3,a4=S:getPosition()if H~=nil then local a5,a6=H:getOffset()a3=o and a3 or a3-a5;a4=o and a4 or a4-a6 end;a2:drawBackgroundBox(T+a3-1,U+a4-1,Y,a0,a1)end,render=function(S)if n then S:redraw()end end,redraw=function(S)for T,U in pairs(K)do if U.active then U.f(S)end end;for T,U in pairs(L)do if U.active then U.f(S)end end;for T,U in pairs(O)do if U.active then U.f(S)end end;return true end,draw=function(S)S:addDraw("base",function()local T,U=S:getSize()if E~=false then S:addTextBox(1,1,T,U," ")S:addBackgroundBox(1,1,T,U,E)end;if F~=false then S:addForegroundBox(1,1,T,U,F)end end,1)end}R.__index=R;return setmetatable(R,l)end end;a["objects"]["ScrollableFrame"]=function(...)local e,f,g,h=math.max,math.min,string.sub,string.rep;return function(i,p)local k=p.getObject("Frame")(i,p)local l="ScrollableFrame"local m;local n=0;local o=0;local q=true;local function r(v)local w=0;local z=v:getChildren()for A,B in pairs(z)do if B.element.getWidth~=nil and B.element.getX~=nil then local C,D=B.element:getWidth(),B.element:getX()local E=v:getWidth()if B.element:getType()=="Dropdown"then if B.element:isOpened()then local F=B.element:getDropdownSize()if F+D-E>=w then w=e(F+D-E,0)end end end;if C+D-E>=w then w=e(C+D-E,0)end end end;return w end;local function s(v)local w=0;local z=v:getChildren()for A,B in pairs(z)do if B.element.getHeight~=nil and B.element.getY~=nil then local C,D=B.element:getHeight(),B.element:getY()local E=v:getHeight()if B.element:getType()=="Dropdown"then if B.element:isOpened()then local F,G=B.element:getDropdownSize()if G+D-E>=w then w=e(G+D-E,0)end end end;if C+D-E>=w then w=e(C+D-E,0)end end end;return w end;local function t(v,w)local z,A=v:getOffset()local B;if n==1 then B=q and r(v)or o;v:setOffset(f(B,e(0,z+w)),A)elseif n==0 then B=q and s(v)or o;v:setOffset(z,f(B,e(0,A+w)))end;v:updateDraw()end;local u={getType=function()return l end,isType=function(v,w)return l==w or k.isType~=nil and k.isType(w)or false end,setDirection=function(v,w)n=w=="horizontal"and 1 or w=="vertical"and 0 or n;return v end,setScrollAmount=function(v,w)o=w;q=false;return v end,getBase=function(v)return k end,load=function(v)k.load(v)v:listenEvent("mouse_scroll")end,removeChildren=function(v)k.removeChildren(v)v:listenEvent("mouse_scroll")end,setParent=function(v,w,...)k.setParent(v,w,...)m=w;return v end,scrollHandler=function(v,w,z,A)if k:getBase().scrollHandler(v,w,z,A)then v:sortChildren()for B,C in ipairs(v:getEvents("mouse_scroll"))do if C.element.scrollHandler~=nil then local D,E=0,0;if v.getOffset~=nil then D,E=v:getOffset()end;if C.element.getIgnoreOffset()then D,E=0,0 end;if C.element.scrollHandler(C.element,w,z+D,A+E)then return true end end end;t(v,w,z,A)v:clearFocusedChild()return true end end,draw=function(v)k.draw(v)v:addDraw("scrollableFrame",function()if q then t(v,0)end end,0)end}u.__index=u;return setmetatable(u,k)end end;a["objects"]["Scrollbar"]=function(...)local e=d("tHex")return function(f,g)local h=g.getObject("VisualObject")(f,g)local i="Scrollbar"h:setZIndex(2)h:setSize(1,8)h:setBackground(colors.lightGray,"\127",colors.gray)local p="vertical"local k=" "local l=colors.black;local m=colors.black;local n=3;local o=1;local q=1;local r=true;local function s()local v,w=h:getSize()if r then q=math.max((p=="vertical"and w or v-#k)-(n-1),1)end end;s()local function t(v,w,z,A)local B,C=v:getAbsolutePosition()local D,E=v:getSize()s()local F=p=="vertical"and E or D;for an=0,F do if(p=="vertical"and C+an==A or p=="horizontal"and B+an==z)and B<=z and B+D>z and C<=A and C+E>A then o=math.min(an+1,F-(#k+q-2))v:scrollbarMoveHandler()v:updateDraw()end end end;local u={getType=function(v)return i end,load=function(v)h.load(v)local w=v:getParent()v:listenEvent("mouse_click")v:listenEvent("mouse_up")v:listenEvent("mouse_scroll")v:listenEvent("mouse_drag")end,setSymbol=function(v,w,z,A)k=w:sub(1,1)l=z or l;m=A or m;s()v:updateDraw()return v end,setSymbolBG=function(v,w)return v:setSymbol(k,w,nil)end,setSymbolFG=function(v,w)return v:setSymbol(k,nil,w)end,getSymbol=function(v)return k end,getSymbolBG=function(v)return l end,getSymbolFG=function(v)return m end,setIndex=function(v,w)o=w;if o<1 then o=1 end;local z,A=v:getSize()s()v:updateDraw()return v end,setScrollAmount=function(v,w)n=w;s()v:updateDraw()return v end,getScrollAmount=function(v)return n end,getIndex=function(v)local w,z=v:getSize()return n>(p=="vertical"and z or w)and math.floor(n/(p=="vertical"and z or w)*o)or o end,setSymbolSize=function(v,w)q=tonumber(w)or 1;r=w~=false and false or true;s()v:updateDraw()return v end,getSymbolSize=function(v)return q end,setBarType=function(v,w)p=w:lower()s()v:updateDraw()return v end,getBarType=function(v)return p end,mouseHandler=function(v,w,z,A,...)if h.mouseHandler(v,w,z,A,...)then t(v,w,z,A)return true end;return false end,dragHandler=function(v,w,z,A)if h.dragHandler(v,w,z,A)then t(v,w,z,A)return true end;return false end,setSize=function(v,...)h.setSize(v,...)s()return v end,scrollHandler=function(v,w,z,A)if h.scrollHandler(v,w,z,A)then local B,C=v:getSize()s()o=o+w;if o<1 then o=1 end;o=math.min(o,(p=="vertical"and C or B)-(p=="vertical"and q-1 or#k+q-2))v:scrollbarMoveHandler()v:updateDraw()end end,onChange=function(v,...)for w,z in pairs(table.pack(...))do if type(z)=="function"then v:registerEvent("scrollbar_moved",z)end end;return v end,scrollbarMoveHandler=function(v)v:sendEvent("scrollbar_moved",v:getIndex())end,customEventHandler=function(v,w,...)h.customEventHandler(v,w,...)if w=="basalt_FrameResize"then s()end end,draw=function(v)h.draw(v)v:addDraw("scrollbar",function()local w=v:getParent()local z,A=v:getSize()local B,C=v:getBackground(),v:getForeground()if p=="horizontal"then for Z=0,A-1 do v:addBlit(o,1+Z,k:rep(q),e[m]:rep(#k*q),e[l]:rep(#k*q))end elseif p=="vertical"then for Z=0,A-1 do if o==Z+1 then for av=0,math.min(q-1,A)do v:addBlit(1,o+av,k:rep(math.max(#k,z)),e[m]:rep(math.max(#k,z)),e[l]:rep(math.max(#k,z)))end end end end end)end}u.__index=u;return setmetatable(u,h)end end;a["objects"]["Thread"]=function(...)return function(e,f)local g=f.getObject("Object")(e,f)local h="Thread"local i;local p;local k=false;local l;local m={getType=function(n)return h end,start=function(n,o)if o==nil then error("Function provided to thread is nil")end;i=o;p=coroutine.create(i)k=true;l=nil;local q,r=coroutine.resume(p)l=r;if not q then if r~="Terminated"then error("Thread Error Occurred - "..r)end end;n:listenEvent("mouse_click")n:listenEvent("mouse_up")n:listenEvent("mouse_scroll")n:listenEvent("mouse_drag")n:listenEvent("key")n:listenEvent("key_up")n:listenEvent("char")n:listenEvent("other_event")return n end,getStatus=function(n,o)if p~=nil then return coroutine.status(p)end;return nil end,stop=function(n,o)k=false;n:listenEvent("mouse_click",false)n:listenEvent("mouse_up",false)n:listenEvent("mouse_scroll",false)n:listenEvent("mouse_drag",false)n:listenEvent("key",false)n:listenEvent("key_up",false)n:listenEvent("char",false)n:listenEvent("other_event",false)return n end,mouseHandler=function(n,...)n:eventHandler("mouse_click",...)end,mouseUpHandler=function(n,...)n:eventHandler("mouse_up",...)end,mouseScrollHandler=function(n,...)n:eventHandler("mouse_scroll",...)end,mouseDragHandler=function(n,...)n:eventHandler("mouse_drag",...)end,mouseMoveHandler=function(n,...)n:eventHandler("mouse_move",...)end,keyHandler=function(n,...)n:eventHandler("key",...)end,keyUpHandler=function(n,...)n:eventHandler("key_up",...)end,charHandler=function(n,...)n:eventHandler("char",...)end,eventHandler=function(n,o,...)g.eventHandler(n,o,...)if k then if coroutine.status(p)=="suspended"then if l~=nil then if o~=l then return end;l=nil end;local q,r=coroutine.resume(p,o,...)l=r;if not q then if r~="Terminated"then error("Thread Error Occurred - "..r)end end else n:stop()end end end}m.__index=m;return setmetatable(m,g)end end;a["objects"]["Object"]=function(...)local e=d("basaltEvent")local f=d("utils")local g=f.uuid;local h,i=table.unpack,string.sub;return function(p,k)p=p or g()assert(k~=nil,"Unable to find basalt instance! ID: "..p)local l="Object"local m,n=true,false;local o=e()local q={}local r={}local s;local t={init=function(u)if n then return false end;n=true;return true end,load=function(u)end,getType=function(u)return l end,isType=function(u,v)return l==v end,getProperty=function(u,v)local w=u["get"..v:gsub("^%l",string.upper)]if w~=nil then return w(u)end end,setProperty=function(u,v,...)local w=u["set"..v:gsub("^%l",string.upper)]if w~=nil then return w(u,...)end end,getName=function(u)return p end,getParent=function(u)return s end,setParent=function(u,v,w)if w then s=v;return u end;if v.getType~=nil and v:isType("Container")then u:remove()v:addChild(u)if u.show then u:show()end;s=v end;return u end,updateEvents=function(u)for v,w in pairs(r)do s:removeEvent(v,u)if w then s:addEvent(v,u)end end;return u end,listenEvent=function(u,v,w)if s~=nil then if w or w==nil then r[v]=true;s:addEvent(v,u)elseif w==false then r[v]=false;s:removeEvent(v,u)end end;return u end,getZIndex=function(u)return 1 end,enable=function(u)m=true;return u end,disable=function(u)m=false;return u end,isEnabled=function(u)return m end,remove=function(u)if s~=nil then s:removeChild(u)end;u:updateDraw()return u end,getBaseFrame=function(u)if s~=nil then return s:getBaseFrame()end;return u end,onEvent=function(u,...)for v,w in pairs(table.pack(...))do if type(w)=="function"then u:registerEvent("other_event",w)end end;return u end,getEventSystem=function(u)return o end,getRegisteredEvents=function(u)return q end,registerEvent=function(u,v,w)if s~=nil then if v=="mouse_drag"then s:addEvent("mouse_click",u)s:addEvent("mouse_up",u)end;s:addEvent(v,u)end;o:registerEvent(v,w)if q[v]==nil then q[v]={}end;table.insert(q[v],w)end,removeEvent=function(u,v,w)if o:getEventCount(v)<1 then if s~=nil then s:removeEvent(v,u)end end;o:removeEvent(v,w)if q[v]~=nil then table.remove(q[v],w)if#q[v]==0 then q[v]=nil end end end,eventHandler=function(u,v,...)local w=u:sendEvent("other_event",v,...)if w~=nil then return w end end,customEventHandler=function(u,v,...)local w=u:sendEvent("custom_event",v,...)if w~=nil then return w end;return true end,sendEvent=function(u,v,...)if v=="other_event"or v=="custom_event"then return o:sendEvent(v,u,...)end;return o:sendEvent(v,u,v,...)end,onClick=function(u,...)for v,w in pairs(table.pack(...))do if type(w)=="function"then u:registerEvent("mouse_click",w)end end;return u end,onClickUp=function(u,...)for v,w in pairs(table.pack(...))do if type(w)=="function"then u:registerEvent("mouse_up",w)end end;return u end,onRelease=function(u,...)for v,w in pairs(table.pack(...))do if type(w)=="function"then u:registerEvent("mouse_release",w)end end;return u end,onScroll=function(u,...)for v,w in pairs(table.pack(...))do if type(w)=="function"then u:registerEvent("mouse_scroll",w)end end;return u end,onHover=function(u,...)for v,w in pairs(table.pack(...))do if type(w)=="function"then u:registerEvent("mouse_hover",w)end end;return u end,onLeave=function(u,...)for v,w in pairs(table.pack(...))do if type(w)=="function"then u:registerEvent("mouse_leave",w)end end;return u end,onDrag=function(u,...)for v,w in pairs(table.pack(...))do if type(w)=="function"then u:registerEvent("mouse_drag",w)end end;return u end,onKey=function(u,...)for v,w in pairs(table.pack(...))do if type(w)=="function"then u:registerEvent("key",w)end end;return u end,onChar=function(u,...)for v,w in pairs(table.pack(...))do if type(w)=="function"then u:registerEvent("char",w)end end;return u end,onKeyUp=function(u,...)for v,w in pairs(table.pack(...))do if type(w)=="function"then u:registerEvent("key_up",w)end end;return u end}t.__index=t;return t end end;a["objects"]["MonitorFrame"]=function(...)local e=d("basaltMon")local f,g,h,i=math.max,math.min,string.sub,string.rep;return function(p,k)local l=k.getObject("BaseFrame")(p,k)local m="MonitorFrame"l:setTerm(nil)local n=false;local o;local q={getType=function()return m end,isType=function(r,s)return m==s or l.isType~=nil and l.isType(s)or false end,getBase=function(r)return l end,setMonitor=function(r,s)if type(s)=="string"then local t=peripheral.wrap(s)if t~=nil then r:setTerm(t)end elseif type(s)=="table"then r:setTerm(s)end;return r end,setMonitorGroup=function(r,s)o=e(s)r:setTerm(o)n=true;return r end,render=function(r)if r:getTerm()~=nil then l.render(r)end end,show=function(r)l:getBase().show(r)k.setActiveFrame(r)for s,t in pairs(colors)do if type(t)=="number"then termObject.setPaletteColor(t,colors.packRGB(term.nativePaletteColor(t)))end end;for s,t in pairs(colorTheme)do if type(t)=="number"then termObject.setPaletteColor(type(s)=="number"and s or colors[s],t)else local u,v,w=table.unpack(t)termObject.setPaletteColor(type(s)=="number"and s or colors[s],u,v,w)end end;return r end}q.mouseHandler=function(r,s,t,u,v,w,...)if n then t,u=o.calculateClick(w,t,u)end;l.mouseHandler(r,s,t,u,v,w,...)end;q.__index=q;return setmetatable(q,l)end end;a["objects"]["Switch"]=function(...)return function(e,f)local g=f.getObject("ChangeableObject")(e,f)local h="Switch"g:setSize(4,1)g:setValue(false)g:setZIndex(5)local i=colors.black;local p=colors.red;local k=colors.green;local l={getType=function(m)return h end,setSymbol=function(m,n)i=n;return m end,getSymbol=function(m)return i end,setActiveBackground=function(m,n)k=n;return m end,getActiveBackground=function(m)return k end,setInactiveBackground=function(m,n)p=n;return m end,getInactiveBackground=function(m)return p end,load=function(m)m:listenEvent("mouse_click")end,mouseHandler=function(m,...)if g.mouseHandler(m,...)then m:setValue(not m:getValue())m:updateDraw()return true end end,draw=function(m)g.draw(m)m:addDraw("switch",function()local n=m:getParent()local o,q=m:getBackground(),m:getForeground()local r,s=m:getSize()if m:getValue()then m:addBackgroundBox(1,1,r,s,k)m:addBackgroundBox(r,1,1,s,i)else m:addBackgroundBox(1,1,r,s,p)m:addBackgroundBox(1,1,1,s,i)end end)end}l.__index=l;return setmetatable(l,g)end end;a["objects"]["Treeview"]=function(...)local e=d("utils")local f=d("tHex")return function(g,h)local i=h.getObject("ChangeableObject")(g,h)local p="Treeview"local k={}local l=colors.black;local m=colors.lightGray;local n=true;local o="left"local q,r=0,0;local s=true;i:setSize(16,8)i:setZIndex(5)local function t(w,z)w=w or""z=z or false;local A=false;local B=nil;local C={}local D={}local E;D={getChildren=function(F)return C end,setParent=function(F,G)if B~=nil then B.removeChild(B.findChildrenByText(D.getText()))end;B=G;i:updateDraw()return D end,getParent=function(F)return B end,addChild=function(F,G,H)local K=t(G,H)K.setParent(D)table.insert(C,K)i:updateDraw()return K end,setExpanded=function(F,G)if z then A=G end;i:updateDraw()return D end,isExpanded=function(F)return A end,onSelect=function(F,...)for G,H in pairs(table.pack(...))do if type(H)=="function"then E=H end end;return D end,callOnSelect=function(F)if E~=nil then E(D)end end,setExpandable=function(F,G)G=G;i:updateDraw()return D end,isExpandable=function(F)return z end,removeChild=function(F,G)if type(G)=="table"then for H,K in pairs(G)do if K==G then G=H;break end end end;table.remove(C,G)i:updateDraw()return D end,findChildrenByText=function(F,G)local H={}for K,L in ipairs(C)do if string.find(L.getText(),G)then table.insert(H,L)end end;return H end,getText=function(F)return w end,setText=function(F,G)w=G;i:updateDraw()return D end}return D end;local u=t("Root",true)u:setExpanded(true)local v={init=function(w)local z=w:getParent()w:listenEvent("mouse_click")w:listenEvent("mouse_scroll")return i.init(w)end,getBase=function(w)return i end,getType=function(w)return p end,isType=function(w,z)return p==z or i.isType~=nil and i.isType(z)or false end,setOffset=function(w,z,A)q=z;r=A;return w end,setXOffset=function(w,z)return w:setOffset(z,r)end,setYOffset=function(w,z)return w:setOffset(q,z)end,getOffset=function(w)return q,r end,getXOffset=function(w)return q end,getYOffset=function(w)return r end,setScrollable=function(w,z)s=z;return w end,getScrollable=function(w,z)return s end,setSelectionColor=function(w,z,A,B)l=z or w:getBackground()m=A or w:getForeground()n=B~=nil and B or true;w:updateDraw()return w end,setSelectionBG=function(w,z)return w:setSelectionColor(z,nil,n)end,setSelectionFG=function(w,z)return w:setSelectionColor(nil,z,n)end,getSelectionColor=function(w)return l,m end,getSelectionBG=function(w)return l end,getSelectionFG=function(w)return m end,isSelectionColorActive=function(w)return n end,getRoot=function(w)return u end,setRoot=function(w,z)u=z;z.setParent(nil)return w end,onSelect=function(w,...)for z,A in pairs(table.pack(...))do if type(A)=="function"then w:registerEvent("treeview_select",A)end end;return w end,selectionHandler=function(w,z)z.callOnSelect(z)w:sendEvent("treeview_select",z)return w end,mouseHandler=function(w,z,A,B)if i.mouseHandler(w,z,A,B)then local C=1-r;local D,E=w:getAbsolutePosition()local F,G=w:getSize()local function H(K,L)if B==E+C-1 then if A>=D and A<D+F then K:setExpanded(not K:isExpanded())w:selectionHandler(K)w:setValue(K)w:updateDraw()return true end end;C=C+1;if K:isExpanded()then for O,P in ipairs(K:getChildren())do if H(P,L+1)then return true end end end;return false end;for K,L in ipairs(u:getChildren())do if H(L,1)then return true end end end end,scrollHandler=function(w,z,A,B)if i.scrollHandler(w,z,A,B)then if s then local C,D=w:getSize()r=r+z;if r<0 then r=0 end;if z>=1 then local E=0;local function F(G,H)E=E+1;if G:isExpanded()then for K,L in ipairs(G:getChildren())do F(L,H+1)end end end;for G,H in ipairs(u:getChildren())do F(H,1)end;if E>D then if r>E-D then r=E-D end else r=r-1 end end;w:updateDraw()end;return true end;return false end,draw=function(w)i.draw(w)w:addDraw("treeview",function()local z=1-r;local A=w:getValue()local function B(C,D)local E,F=w:getSize()if z>=1 and z<=F then local G=C==A and l or w:getBackground()local H=C==A and m or w:getForeground()local K=C.getText()w:addBlit(1+D+q,z,K,f[H]:rep(#K),f[G]:rep(#K))end;z=z+1;if C:isExpanded()then for G,H in ipairs(C:getChildren())do B(H,D+1)end end end;for C,D in ipairs(u:getChildren())do B(D,1)end end)end}v.__index=v;return setmetatable(v,i)end end;a["objects"]["Timer"]=function(...)return function(e,f)local g=f.getObject("Object")(e,f)local h="Timer"local i=0;local p=0;local k=0;local l;local m=false;local n={getType=function(o)return h end,setTime=function(o,q,r)i=q or 0;p=r or 1;return o end,getTime=function(o)return i end,start=function(o)if m then os.cancelTimer(l)end;k=p;l=os.startTimer(i)m=true;o:listenEvent("other_event")return o end,isActive=function(o)return m end,cancel=function(o)if l~=nil then os.cancelTimer(l)end;m=false;o:removeEvent("other_event")return o end,setStart=function(o,q)if q==true then return o:start()else return o:cancel()end end,onCall=function(o,q)o:registerEvent("timed_event",q)return o end,eventHandler=function(o,q,...)g.eventHandler(o,q,...)if q=="timer"and tObj==l and m then o:sendEvent("timed_event")if k>=1 then k=k-1;if k>=1 then l=os.startTimer(i)end elseif k==-1 then l=os.startTimer(i)end end end}n.__index=n;return setmetatable(n,g)end end;a["objects"]["Program"]=function(...)local e=d("tHex")local f=d("process")local g=string.sub;return function(h,i)local p=i.getObject("VisualObject")(h,i)local k="Program"local l;local m;local n={}local function o(A,B,C,D)local E,F=1,1;local G,H=colors.black,colors.white;local K=false;local L=false;local O={}local P={}local Q={}local R={}local S;local T={}for an=0,15 do local aa=2^an;R[aa]={i.getTerm().getPaletteColour(aa)}end;local function U()S=(" "):rep(C)for Z=0,15 do local aa=2^Z;local ab=e[aa]T[aa]=ab:rep(C)end end;local function Y()U()local aa=S;local ab=T[colors.white]local ac=T[colors.black]for Z=1,D do O[Z]=g(O[Z]==nil and aa or O[Z]..aa:sub(1,C-O[Z]:len()),1,C)Q[Z]=g(Q[Z]==nil and ab or Q[Z]..ab:sub(1,C-Q[Z]:len()),1,C)P[Z]=g(P[Z]==nil and ac or P[Z]..ac:sub(1,C-P[Z]:len()),1,C)end;p.updateDraw(p)end;Y()local function a0()if E>=1 and F>=1 and E<=C and F<=D then else end end;local function a1(aa,ab,ac)if F<1 or F>D or E<1 or E+#aa-1>C then return end;O[F]=g(O[F],1,E-1)..aa..g(O[F],E+#aa,C)Q[F]=g(Q[F],1,E-1)..ab..g(Q[F],E+#aa,C)P[F]=g(P[F],1,E-1)..ac..g(P[F],E+#aa,C)E=E+#aa;if L then a0()end;l:updateDraw()end;local function a2(aa,ab,ac)if ac~=nil then local ad=O[ab]if ad~=nil then O[ab]=g(ad:sub(1,aa-1)..ac..ad:sub(aa+ac:len(),C),1,C)end end;l:updateDraw()end;local function a3(aa,ab,ac)if ac~=nil then local ad=P[ab]if ad~=nil then P[ab]=g(ad:sub(1,aa-1)..ac..ad:sub(aa+ac:len(),C),1,C)end end;l:updateDraw()end;local function a4(aa,ab,ac)if ac~=nil then local ad=Q[ab]if ad~=nil then Q[ab]=g(ad:sub(1,aa-1)..ac..ad:sub(aa+ac:len(),C),1,C)end end;l:updateDraw()end;local a5=function(aa)if type(aa)~="number"then error("bad argument #1 (expected number, got "..type(aa)..")",2)elseif e[aa]==nil then error("Invalid color (got "..aa..")",2)end;H=aa end;local a6=function(aa)if type(aa)~="number"then error("bad argument #1 (expected number, got "..type(aa)..")",2)elseif e[aa]==nil then error("Invalid color (got "..aa..")",2)end;G=aa end;local a7=function(aa,ab,ac,ad)if type(aa)~="number"then error("bad argument #1 (expected number, got "..type(aa)..")",2)end;if e[aa]==nil then error("Invalid color (got "..aa..")",2)end;local ae;if type(ab)=="number"and ac==nil and ad==nil then ae={colours.rgb8(ab)}R[aa]=ae else if type(ab)~="number"then error("bad argument #2 (expected number, got "..type(ab)..")",2)end;if type(ac)~="number"then error("bad argument #3 (expected number, got "..type(ac)..")",2)end;if type(ad)~="number"then error("bad argument #4 (expected number, got "..type(ad)..")",2)end;ae=R[aa]ae[1]=ab;ae[2]=ac;ae[3]=ad end end;local a8=function(aa)if type(aa)~="number"then error("bad argument #1 (expected number, got "..type(aa)..")",2)end;if e[aa]==nil then error("Invalid color (got "..aa..")",2)end;local ab=R[aa]return ab[1],ab[2],ab[3]end;local a9={setCursorPos=function(aa,ab)if type(aa)~="number"then error("bad argument #1 (expected number, got "..type(aa)..")",2)end;if type(ab)~="number"then error("bad argument #2 (expected number, got "..type(ab)..")",2)end;E=math.floor(aa)F=math.floor(ab)if L then a0()end end,getCursorPos=function()return E,F end,setCursorBlink=function(aa)if type(aa)~="boolean"then error("bad argument #1 (expected boolean, got "..type(aa)..")",2)end;K=aa end,getCursorBlink=function()return K end,getPaletteColor=a8,getPaletteColour=a8,setBackgroundColor=a6,setBackgroundColour=a6,setTextColor=a5,setTextColour=a5,setPaletteColor=a7,setPaletteColour=a7,getBackgroundColor=function()return G end,getBackgroundColour=function()return G end,getSize=function()return C,D end,getTextColor=function()return H end,getTextColour=function()return H end,basalt_resize=function(aa,ab)C,D=aa,ab;Y()end,basalt_reposition=function(aa,ab)A,B=aa,ab end,basalt_setVisible=function(aa)L=aa end,drawBackgroundBox=function(aa,ab,ac,ad,ae)for Z=1,ad do a3(aa,ab+Z-1,e[ae]:rep(ac))end end,drawForegroundBox=function(aa,ab,ac,ad,ae)for Z=1,ad do a4(aa,ab+Z-1,e[ae]:rep(ac))end end,drawTextBox=function(aa,ab,ac,ad,ae)for Z=1,ad do a2(aa,ab+Z-1,ae:rep(ac))end end,basalt_update=function()for Z=1,D do l:addBlit(1,Z,O[Z],Q[Z],P[Z])end end,scroll=function(aa)assert(type(aa)=="number","bad argument #1 (expected number, got "..type(aa)..")")if aa~=0 then for aw=1,D do local ab=aw+aa;if ab<1 or ab>D then O[aw]=S;Q[aw]=T[H]P[aw]=T[G]else O[aw]=O[ab]P[aw]=P[ab]Q[aw]=Q[ab]end end end;if L then a0()end end,isColor=function()return i.getTerm().isColor()end,isColour=function()return i.getTerm().isColor()end,write=function(aa)aa=tostring(aa)if L then a1(aa,e[H]:rep(aa:len()),e[G]:rep(aa:len()))end end,clearLine=function()if L then a2(1,F,(" "):rep(C))a3(1,F,e[G]:rep(C))a4(1,F,e[H]:rep(C))end;if L then a0()end end,clear=function()for Z=1,D do a2(1,Z,(" "):rep(C))a3(1,Z,e[G]:rep(C))a4(1,Z,e[H]:rep(C))end;if L then a0()end end,blit=function(aa,ab,ac)if type(aa)~="string"then error("bad argument #1 (expected string, got "..type(aa)..")",2)end;if type(ab)~="string"then error("bad argument #2 (expected string, got "..type(ab)..")",2)end;if type(ac)~="string"then error("bad argument #3 (expected string, got "..type(ac)..")",2)end;if#ab~=#aa or#ac~=#aa then error("Arguments must be the same length",2)end;if L then a1(aa,ab,ac)end end}return a9 end;p:setZIndex(5)p:setSize(30,12)local q=o(1,1,30,12)local r;local s=false;local t={}local function u(A)local B=A:getParent()local C,D=q.getCursorPos()local E,F=A:getPosition()local G,H=A:getSize()if E+C-1>=1 and E+C-1<=E+G-1 and D+F-1>=1 and D+F-1<=F+H-1 then B:setCursor(A:isFocused()and q.getCursorBlink(),E+C-1,D+F-1,q.getTextColor())end end;local function v(A,B,...)local C,D=r:resume(B,...)if C==false and D~=nil and D~="Terminated"then local E=A:sendEvent("program_error",D)if E~=false then error("Basalt Program - "..D)end end;if r:getStatus()=="dead"then A:sendEvent("program_done")end end;local function w(A,B,C,D,E)if r==nil then return false end;if not r:isDead()then if not s then local F,G=A:getAbsolutePosition()v(A,B,C,D-F+1,E-G+1)u(A)end end end;local function z(A,B,C,D)if r==nil then return false end;if not r:isDead()then if not s then if A.draw then v(A,B,C,D)u(A)end end end end;l={getType=function(A)return k end,show=function(A)p.show(A)q.setBackgroundColor(A:getBackground())q.setTextColor(A:getForeground())q.basalt_setVisible(true)return A end,hide=function(A)p.hide(A)q.basalt_setVisible(false)return A end,setPosition=function(A,B,C,D)p.setPosition(A,B,C,D)q.basalt_reposition(A:getPosition())return A end,getBasaltWindow=function()return q end,getBasaltProcess=function()return r end,setSize=function(A,B,C,D)p.setSize(A,B,C,D)q.basalt_resize(A:getWidth(),A:getHeight())return A end,getStatus=function(A)if r~=nil then return r:getStatus()end;return"inactive"end,setEnviroment=function(A,B)n=B or{}return A end,execute=function(A,B,...)m=B or m;r=f:new(m,q,n,...)q.setBackgroundColor(colors.black)q.setTextColor(colors.white)q.clear()q.setCursorPos(1,1)q.setBackgroundColor(A:getBackground())q.setTextColor(A:getForeground()or colors.white)q.basalt_setVisible(true)v(A)s=false;A:listenEvent("mouse_click",A)A:listenEvent("mouse_up",A)A:listenEvent("mouse_drag",A)A:listenEvent("mouse_scroll",A)A:listenEvent("key",A)A:listenEvent("key_up",A)A:listenEvent("char",A)A:listenEvent("other_event",A)return A end,setExecute=function(A,B,...)return A:execute(B,...)end,stop=function(A)local B=A:getParent()if r~=nil then if not r:isDead()then v(A,"terminate")if r:isDead()then B:setCursor(false)end end end;B:removeEvents(A)return A end,pause=function(A,B)s=B or not s;if r~=nil then if not r:isDead()then if not s then A:injectEvents(table.unpack(t))t={}end end end;return A end,isPaused=function(A)return s end,injectEvent=function(A,B,C,...)if r~=nil then if not r:isDead()then if s==false or C then v(A,B,...)else table.insert(t,{event=B,args={...}})end end end;return A end,getQueuedEvents=function(A)return t end,updateQueuedEvents=function(A,B)t=B or t;return A end,injectEvents=function(A,...)if r~=nil then if not r:isDead()then for B,C in pairs({...})do v(A,C.event,table.unpack(C.args))end end end;return A end,mouseHandler=function(A,B,C,D)if p.mouseHandler(A,B,C,D)then w(A,"mouse_click",B,C,D)return true end;return false end,mouseUpHandler=function(A,B,C,D)if p.mouseUpHandler(A,B,C,D)then w(A,"mouse_up",B,C,D)return true end;return false end,scrollHandler=function(A,B,C,D)if p.scrollHandler(A,B,C,D)then w(A,"mouse_scroll",B,C,D)return true end;return false end,dragHandler=function(A,B,C,D)if p.dragHandler(A,B,C,D)then w(A,"mouse_drag",B,C,D)return true end;return false end,keyHandler=function(A,B,C)if p.keyHandler(A,B,C)then z(A,"key",B,C)return true end;return false end,keyUpHandler=function(A,B)if p.keyUpHandler(A,B)then z(A,"key_up",B)return true end;return false end,charHandler=function(A,B)if p.charHandler(A,B)then z(A,"char",B)return true end;return false end,getFocusHandler=function(A)p.getFocusHandler(A)if r~=nil then if not r:isDead()then if not s then local B=A:getParent()if B~=nil then local C,D=q.getCursorPos()local E,F=A:getPosition()local G,H=A:getSize()if E+C-1>=1 and E+C-1<=E+G-1 and D+F-1>=1 and D+F-1<=F+H-1 then B:setCursor(q.getCursorBlink(),E+C-1,D+F-1,q.getTextColor())end end end end end end,loseFocusHandler=function(A)p.loseFocusHandler(A)if r~=nil then if not r:isDead()then local B=A:getParent()if B~=nil then B:setCursor(false)end end end end,eventHandler=function(A,B,...)p.eventHandler(A,B,...)if r==nil then return end;if not r:isDead()then if not s then v(A,B,...)if A:isFocused()then local C=A:getParent()local D,E=A:getPosition()local F,G=q.getCursorPos()local H,K=A:getSize()if D+F-1>=1 and D+F-1<=D+H-1 and G+E-1>=1 and G+E-1<=E+K-1 then C:setCursor(q.getCursorBlink(),D+F-1,G+E-1,q.getTextColor())end end else table.insert(t,{event=B,args={...}})end end end,resizeHandler=function(A,...)p.resizeHandler(A,...)if r~=nil then if not r:isDead()then if not s then q.basalt_resize(A:getSize())v(A,"term_resize",A:getSize())else q.basalt_resize(A:getSize())table.insert(t,{event="term_resize",args={A:getSize()}})end end end end,repositionHandler=function(A,...)p.repositionHandler(A,...)if r~=nil then if not r:isDead()then q.basalt_reposition(A:getPosition())end end end,draw=function(A)p.draw(A)A:addDraw("program",function()local B=A:getParent()local C,D=A:getPosition()local E,F=q.getCursorPos()local G,H=A:getSize()q.basalt_update()end)end,onError=function(A,...)for C,D in pairs(table.pack(...))do if type(D)=="function"then A:registerEvent("program_error",D)end end;local B=A:getParent()A:listenEvent("other_event")return A end,onDone=function(A,...)for C,D in pairs(table.pack(...))do if type(D)=="function"then A:registerEvent("program_done",D)end end;local B=A:getParent()A:listenEvent("other_event")return A end}l.__index=l;return setmetatable(l,p)end end;a["objects"]["Progressbar"]=function(...)return function(e,f)local g=f.getObject("ChangeableObject")(e,f)local h="Progressbar"local i=0;g:setZIndex(5)g:setValue(false)g:setSize(25,3)local p=colors.black;local k=""local l=colors.white;local m=""local n=0;local o={getType=function(q)return h end,setDirection=function(q,r)n=r;q:updateDraw()return q end,getDirection=function(q)return n end,setProgressBar=function(q,r,s,t)p=r or p;k=s or k;l=t or l;q:updateDraw()return q end,getProgressBar=function(q)return p,k,l end,setActiveBarColor=function(q,r)return q:setProgressBar(r,nil,nil)end,getActiveBarColor=function(q)return p end,setActiveBarSymbol=function(q,r)return q:setProgressBar(nil,r,nil)end,getActiveBarSymbol=function(q)return k end,setActiveBarSymbolColor=function(q,r)return q:setProgressBar(nil,nil,r)end,getActiveBarSymbolColor=function(q)return l end,setBackgroundSymbol=function(q,r)m=r:sub(1,1)q:updateDraw()return q end,getBackgroundSymbol=function(q)return m end,setProgress=function(q,r)if r>=0 and r<=100 and i~=r then i=r;q:setValue(i)if i==100 then q:progressDoneHandler()end end;q:updateDraw()return q end,getProgress=function(q)return i end,onProgressDone=function(q,r)q:registerEvent("progress_done",r)return q end,progressDoneHandler=function(q)q:sendEvent("progress_done")end,draw=function(q)g.draw(q)q:addDraw("progressbar",function()local r,s=q:getPosition()local t,u=q:getSize()local v,w=q:getBackground(),q:getForeground()if v~=false then q:addBackgroundBox(1,1,t,u,v)end;if m~=""then q:addTextBox(1,1,t,u,m)end;if w~=false then q:addForegroundBox(1,1,t,u,w)end;if n==1 then q:addBackgroundBox(1,1,t,u/100*i,p)q:addForegroundBox(1,1,t,u/100*i,l)q:addTextBox(1,1,t,u/100*i,k)elseif n==3 then q:addBackgroundBox(1,1+math.ceil(u-u/100*i),t,u/100*i,p)q:addForegroundBox(1,1+math.ceil(u-u/100*i),t,u/100*i,l)q:addTextBox(1,1+math.ceil(u-u/100*i),t,u/100*i,k)elseif n==2 then q:addBackgroundBox(1+math.ceil(t-t/100*i),1,t/100*i,u,p)q:addForegroundBox(1+math.ceil(t-t/100*i),1,t/100*i,u,l)q:addTextBox(1+math.ceil(t-t/100*i),1,t/100*i,u,k)else q:addBackgroundBox(1,1,math.ceil(t/100*i),u,p)q:addForegroundBox(1,1,math.ceil(t/100*i),u,l)q:addTextBox(1,1,math.ceil(t/100*i),u,k)end end)end}o.__index=o;return setmetatable(o,g)end end;a["objects"]["Textfield"]=function(...)local e=d("tHex")local f,g,h,i,p=string.rep,string.find,string.gmatch,string.sub,string.len;return function(k,l)local m=l.getObject("ChangeableObject")(k,l)local n="Textfield"local o,q,r,s=1,1,1,1;local t={""}local u={""}local v={""}local w={}local z={}local A,B,C,D;local E,F=colors.lightBlue,colors.black;m:setSize(30,12)m:setZIndex(5)local function G()if A~=nil and B~=nil and C~=nil and D~=nil then return true end;return false end;local function H()local R,S,T,U=A,B,C,D;if G()then if A<B and C<=D then R=A;S=B;if C<D then T=C;U=D else T=D;U=C end elseif A>B and C>=D then R=B;S=A;if C>D then T=D;U=C else T=C;U=D end elseif C>D then R=B;S=A;T=D;U=C end;return R,S,T,U end end;local function K(R)local S,T,U,Y=H()local a0=t[U]local a1=t[Y]t[U]=a0:sub(1,S-1)..a1:sub(T+1,a1:len())u[U]=u[U]:sub(1,S-1)..u[Y]:sub(T+1,u[Y]:len())v[U]=v[U]:sub(1,S-1)..v[Y]:sub(T+1,v[Y]:len())for an=Y,U+1,-1 do if an~=U then table.remove(t,an)table.remove(u,an)table.remove(v,an)end end;r,s=S,U;A,B,C,D=nil,nil,nil,nil;return R end;local function L(R,S)local T={}if R:len()>0 then for U in h(R,S)do local Y,a0=g(R,U)if Y~=nil and a0~=nil then table.insert(T,Y)table.insert(T,a0)local a1=i(R,1,Y-1)local a2=i(R,a0+1,R:len())R=a1 ..(":"):rep(U:len())..a2 end end end;return T end;local function O(R,S)S=S or s;local T=e[R:getForeground()]:rep(v[S]:len())local U=e[R:getBackground()]:rep(u[S]:len())for Y,a0 in pairs(z)do local a1=L(t[S],a0[1])if#a1>0 then for x=1,#a1/2 do local a2=x*2-1;if a0[2]~=nil then T=T:sub(1,a1[a2]-1)..e[a0[2]]:rep(a1[a2+1]-(a1[a2]-1))..T:sub(a1[a2+1]+1,T:len())end;if a0[3]~=nil then U=U:sub(1,a1[a2]-1)..e[a0[3]]:rep(a1[a2+1]-(a1[a2]-1))..U:sub(a1[a2+1]+1,U:len())end end end end;for Y,a0 in pairs(w)do for a1,a2 in pairs(a0)do local a3=L(t[S],a2)if#a3>0 then for x=1,#a3/2 do local a4=x*2-1;T=T:sub(1,a3[a4]-1)..e[Y]:rep(a3[a4+1]-(a3[a4]-1))..T:sub(a3[a4+1]+1,T:len())end end end end;v[S]=T;u[S]=U;R:updateDraw()end;local function P(R)for Z=1,#t do O(R,Z)end end;local Q={getType=function(R)return n end,setBackground=function(R,S)m.setBackground(R,S)P(R)return R end,setForeground=function(R,S)m.setForeground(R,S)P(R)return R end,setSelection=function(R,S,T)F=S or F;E=T or E;return R end,setSelectionFG=function(R,S)return R:setSelection(S,nil)end,setSelectionBG=function(R,S)return R:setSelection(nil,S)end,getSelection=function(R)return F,E end,getSelectionFG=function(R)return F end,getSelectionBG=function(R)return E end,getLines=function(R)return t end,getLine=function(R,S)return t[S]end,editLine=function(R,S,T)t[S]=T or t[S]O(R,S)R:updateDraw()return R end,clear=function(R)t={""}u={""}v={""}A,B,C,D=nil,nil,nil,nil;o,q,r,s=1,1,1,1;R:updateDraw()return R end,addLine=function(R,S,T)if S~=nil then local U=R:getBackground()local Y=R:getForeground()if#t==1 and t[1]==""then t[1]=S;u[1]=e[U]:rep(S:len())v[1]=e[Y]:rep(S:len())O(R,1)return R end;if T~=nil then table.insert(t,T,S)table.insert(u,T,e[U]:rep(S:len()))table.insert(v,T,e[Y]:rep(S:len()))else table.insert(t,S)table.insert(u,e[U]:rep(S:len()))table.insert(v,e[Y]:rep(S:len()))end end;O(R,T or#t)R:updateDraw()return R end,addKeywords=function(R,S,T)if w[S]==nil then w[S]={}end;for U,Y in pairs(T)do table.insert(w[S],Y)end;R:updateDraw()return R end,addRule=function(R,S,T,U)table.insert(z,{S,T,U})R:updateDraw()return R end,editRule=function(R,S,T,U)for Y,a0 in pairs(z)do if a0[1]==S then z[Y][2]=T;z[Y][3]=U end end;R:updateDraw()return R end,removeRule=function(R,S)for T,U in pairs(z)do if U[1]==S then table.remove(z,T)end end;R:updateDraw()return R end,setKeywords=function(R,S,T)w[S]=T;R:updateDraw()return R end,removeLine=function(R,S)if#t>1 then table.remove(t,S or#t)table.remove(u,S or#u)table.remove(v,S or#v)else t={""}u={""}v={""}end;R:updateDraw()return R end,getTextCursor=function(R)return r,s end,getOffset=function(R)return q,o end,setOffset=function(R,S,T)q=S or q;o=T or o;R:updateDraw()return R end,getXOffset=function(R)return q end,setXOffset=function(R,S)return R:setOffset(S,nil)end,getYOffset=function(R)return o end,setYOffset=function(R,S)return R:setOffset(nil,S)end,getFocusHandler=function(R)m.getFocusHandler(R)local S,T=R:getPosition()R:getParent():setCursor(true,S+r-q,T+s-o,R:getForeground())end,loseFocusHandler=function(R)m.loseFocusHandler(R)R:getParent():setCursor(false)end,keyHandler=function(R,S)if m.keyHandler(R,S)then local T=R:getParent()local U,Y=R:getPosition()local a0,a1=R:getSize()if S==keys.backspace then if G()then K(R)else if t[s]==""then if s>1 then table.remove(t,s)table.remove(v,s)table.remove(u,s)r=t[s-1]:len()+1;q=r-a0+1;if q<1 then q=1 end;s=s-1 end elseif r<=1 then if s>1 then r=t[s-1]:len()+1;q=r-a0+1;if q<1 then q=1 end;t[s-1]=t[s-1]..t[s]v[s-1]=v[s-1]..v[s]u[s-1]=u[s-1]..u[s]table.remove(t,s)table.remove(v,s)table.remove(u,s)s=s-1 end else t[s]=t[s]:sub(1,r-2)..t[s]:sub(r,t[s]:len())v[s]=v[s]:sub(1,r-2)..v[s]:sub(r,v[s]:len())u[s]=u[s]:sub(1,r-2)..u[s]:sub(r,u[s]:len())if r>1 then r=r-1 end;if q>1 then if r<q then q=q-1 end end end;if s<o then o=o-1 end end;O(R)R:setValue("")elseif S==keys.delete then if G()then K(R)else if r>t[s]:len()then if t[s+1]~=nil then t[s]=t[s]..t[s+1]table.remove(t,s+1)table.remove(u,s+1)table.remove(v,s+1)end else t[s]=t[s]:sub(1,r-1)..t[s]:sub(r+1,t[s]:len())v[s]=v[s]:sub(1,r-1)..v[s]:sub(r+1,v[s]:len())u[s]=u[s]:sub(1,r-1)..u[s]:sub(r+1,u[s]:len())end end;O(R)elseif S==keys.enter then if G()then K(R)end;table.insert(t,s+1,t[s]:sub(r,t[s]:len()))table.insert(v,s+1,v[s]:sub(r,v[s]:len()))table.insert(u,s+1,u[s]:sub(r,u[s]:len()))t[s]=t[s]:sub(1,r-1)v[s]=v[s]:sub(1,r-1)u[s]=u[s]:sub(1,r-1)s=s+1;r=1;q=1;if s-o>=a1 then o=o+1 end;R:setValue("")elseif S==keys.up then A,C,B,D=nil,nil,nil,nil;if s>1 then s=s-1;if r>t[s]:len()+1 then r=t[s]:len()+1 end;if q>1 then if r<q then q=r-a0+1;if q<1 then q=1 end end end;if o>1 then if s<o then o=o-1 end end end elseif S==keys.down then A,C,B,D=nil,nil,nil,nil;if s<#t then s=s+1;if r>t[s]:len()+1 then r=t[s]:len()+1 end;if q>1 then if r<q then q=r-a0+1;if q<1 then q=1 end end end;if s>=o+a1 then o=o+1 end end elseif S==keys.right then A,C,B,D=nil,nil,nil,nil;r=r+1;if s<#t then if r>t[s]:len()+1 then r=1;s=s+1 end elseif r>t[s]:len()then r=t[s]:len()+1 end;if r<1 then r=1 end;if r<q or r>=a0+q then q=r-a0+1 end;if q<1 then q=1 end elseif S==keys.left then A,C,B,D=nil,nil,nil,nil;r=r-1;if r>=1 then if r<q or r>=a0+q then q=r end end;if s>1 then if r<1 then s=s-1;r=t[s]:len()+1;q=r-a0+1 end end;if r<1 then r=1 end;if q<1 then q=1 end elseif S==keys.tab then if r%3==0 then t[s]=t[s]:sub(1,r-1).." "..t[s]:sub(r,t[s]:len())v[s]=v[s]:sub(1,r-1)..e[R:getForeground()]..v[s]:sub(r,v[s]:len())u[s]=u[s]:sub(1,r-1)..e[R:getBackground()]..u[s]:sub(r,u[s]:len())r=r+1 end;while r%3~=0 do t[s]=t[s]:sub(1,r-1).." "..t[s]:sub(r,t[s]:len())v[s]=v[s]:sub(1,r-1)..e[R:getForeground()]..v[s]:sub(r,v[s]:len())u[s]=u[s]:sub(1,r-1)..e[R:getBackground()]..u[s]:sub(r,u[s]:len())r=r+1 end end;if not(U+r-q>=U and U+r-q<U+a0 and(Y+s-o>=Y and Y+s-o<Y+a1))then q=math.max(1,t[s]:len()-a0+1)o=math.max(1,s-a1+1)end;local a2=(r<=t[s]:len()and r-1 or t[s]:len())-(q-1)if a2>R:getX()+a0-1 then a2=R:getX()+a0-1 end;local a3=s-o<a1 and s-o or s-o-1;if a2<1 then a2=0 end;T:setCursor(true,U+a2,Y+a3,R:getForeground())R:updateDraw()return true end end,charHandler=function(R,S)if m.charHandler(R,S)then local T=R:getParent()local U,Y=R:getPosition()local a0,a1=R:getSize()if G()then K(R)end;t[s]=t[s]:sub(1,r-1)..S..t[s]:sub(r,t[s]:len())v[s]=v[s]:sub(1,r-1)..e[R:getForeground()]..v[s]:sub(r,v[s]:len())u[s]=u[s]:sub(1,r-1)..e[R:getBackground()]..u[s]:sub(r,u[s]:len())r=r+1;if r>=a0+q then q=q+1 end;O(R)R:setValue("")if not(U+r-q>=U and U+r-q<U+a0 and(Y+s-o>=Y and Y+s-o<Y+a1))then q=math.max(1,t[s]:len()-a0+1)o=math.max(1,s-a1+1)end;local a2=(r<=t[s]:len()and r-1 or t[s]:len())-(q-1)if a2>R:getX()+a0-1 then a2=R:getX()+a0-1 end;local a3=s-o<a1 and s-o or s-o-1;if a2<1 then a2=0 end;T:setCursor(true,U+a2,Y+a3,R:getForeground())R:updateDraw()return true end end,dragHandler=function(R,S,T,U)if m.dragHandler(R,S,T,U)then local Y=R:getParent()local a0,a1=R:getAbsolutePosition()local a2,a3=R:getPosition()local a4,a5=R:getSize()if t[U-a1+o]~=nil then if T-a0+q>0 and T-a0+q<=a4 then r=T-a0+q;s=U-a1+o;if r>t[s]:len()then r=t[s]:len()+1 end;B=r;D=s;if r<q then q=r-1;if q<1 then q=1 end end;Y:setCursor(not G(),a2+r-q,a3+s-o,R:getForeground())R:updateDraw()end end;return true end end,scrollHandler=function(R,S,T,U)if m.scrollHandler(R,S,T,U)then local Y=R:getParent()local a0,a1=R:getAbsolutePosition()local a2,a3=R:getPosition()local a4,a5=R:getSize()o=o+S;if o>#t-(a5-1)then o=#t-(a5-1)end;if o<1 then o=1 end;if a0+r-q>=a0 and a0+r-q<a0+a4 and(a3+s-o>=a3 and a3+s-o<a3+a5)then Y:setCursor(not G(),a2+r-q,a3+s-o,R:getForeground())else Y:setCursor(false)end;R:updateDraw()return true end end,mouseHandler=function(R,S,T,U)if m.mouseHandler(R,S,T,U)then local Y=R:getParent()local a0,a1=R:getAbsolutePosition()local a2,a3=R:getPosition()if t[U-a1+o]~=nil then r=T-a0+q;s=U-a1+o;B=nil;D=nil;A=r;C=s;if r>t[s]:len()then r=t[s]:len()+1;A=r end;if r<q then q=r-1;if q<1 then q=1 end end;R:updateDraw()end;Y:setCursor(true,a2+r-q,a3+s-o,R:getForeground())return true end end,mouseUpHandler=function(R,S,T,U)if m.mouseUpHandler(R,S,T,U)then local Y,a0=R:getAbsolutePosition()if t[U-a0+o]~=nil then B=T-Y+q;D=U-a0+o;if B>t[D]:len()then B=t[D]:len()+1 end;if A==B and C==D then A,B,C,D=nil,nil,nil,nil end;R:updateDraw()end;return true end end,eventHandler=function(R,S,T,...)m.eventHandler(R,S,T,...)if S=="paste"then if R:isFocused()then local U=R:getParent()local Y,a0=R:getForeground(),R:getBackground()local a1,a2=R:getSize()t[s]=t[s]:sub(1,r-1)..T..t[s]:sub(r,t[s]:len())v[s]=v[s]:sub(1,r-1)..e[Y]:rep(T:len())..v[s]:sub(r,v[s]:len())u[s]=u[s]:sub(1,r-1)..e[a0]:rep(T:len())..u[s]:sub(r,u[s]:len())r=r+T:len()if r>=a1+q then q=r+1-a1 end;local a3,a4=R:getPosition()U:setCursor(true,a3+r-q,a4+s-o,Y)O(R)R:updateDraw()end end end,draw=function(R)m.draw(R)R:addDraw("textfield",function()local S,T=R:getSize()local U=e[R:getBackground()]local Y=e[R:getForeground()]for Z=1,T do local a0=""local a1=""local a2=""if t[Z+o-1]then a0=t[Z+o-1]a2=v[Z+o-1]a1=u[Z+o-1]end;a0=i(a0,q,S+q-1)a1=f(U,S)a2=f(Y,S)R:addText(1,Z,a0)R:addBG(1,Z,a1)R:addFG(1,Z,a2)R:addBlit(1,Z,a0,a2,a1)end;if A and B and C and D then local a0,a1,a2,a3=H()for Z=a2,a3 do local a4=#t[Z]local a5=0;if Z==a2 and Z==a3 then a5=a0-1-(q-1)a4=a4-(a0-1-(q-1))-(a4-a1+q-1)elseif Z==a3 then a4=a4-(a4-a1+q-1)elseif Z==a2 then a4=a4-(a0-1)a5=a0-1-(q-1)end;local a6=math.min(a4,S-a5)R:addBG(1+a5,Z,f(e[E],a6))R:addFG(1+a5,Z,f(e[F],a6))end end end)end,load=function(R)R:listenEvent("mouse_click")R:listenEvent("mouse_up")R:listenEvent("mouse_scroll")R:listenEvent("mouse_drag")R:listenEvent("key")R:listenEvent("char")R:listenEvent("other_event")end}Q.__index=Q;return setmetatable(Q,m)end end;return a["main"]()
