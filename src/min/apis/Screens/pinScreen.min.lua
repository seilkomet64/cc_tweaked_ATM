local a=require("basalt")local b=require("atmAPI")local c=require("helpers")local function d(e,f)local g=a.createFrame():setTheme({ButtonBG=colors.black,ButtonText=colors.white}):setBackground(colors.gray)local h=g:addFlexbox():setWrap("wrap"):setJustifyContent("center"):setSize("parent.w","parent.h"):setSpacing(1):setPosition(2,2):setJustifyContent("center")local i=g:addThread()local j=g:addThread()local k=h:addLabel():setText("_____"):setSize(5,1)local l=""h:addBreak()local function m()local n=string.rep("*",string.len(l))k:setText(n..string.rep("_",5-string.len(l)))end;local o=g:addLabel():setText(""):setForeground(colors.red)local function p(q)o:setText(q)local r=o:getSize()o:setPosition("2 + parent.w * 0.5 - "..r*0.5)end;g:addButton():setText("CANCEL"):setPosition("parent.w - 5",1):setSize(6,1):setForeground(colors.red):setBackground(colors.black):onClick(function()ChangeScreen(SCREENS.mainScreen,nil,{acc=f.acc})end)local function s()if string.len(l)<5 then p("Incorrect Pin! Try again...")return end;p("Checking...")j:start(function()local t,u=pcall(function()return b.checkPin(f.acc,l)end)if not t then local v=u:match(":%d+: (.+)")or u;if v=="Failed to contact the server!"then p("Server not reachable!")else p("An error occurred: "..v)end elseif u then p("Success!")ChangeScreen(e,nil,{pin=l,acc=f.acc})else p("Incorrect Pin! Try again...")end end)end;local w={"1","2","3","4","5","6","7","8","9","C","0","OK"}for x,y in ipairs(w)do local z=h:addButton():setText(y)if x%3==0 then h:addBreak()end;if y=="C"then z:setBackground(colors.red)elseif y=="OK"then z:setBackground(colors.green)end;c(z)z:onClick(function(self)if self:getText()=="C"then l=l:sub(1,-2)m()elseif self:getText()=="OK"then s()elseif string.len(l)==5 then return else l=l..self:getText()m()end end)end;local function A()while true do::B::local C,D,E=os.pullEvent()if C=="key"then if D==keys.backspace then l=l:sub(1,-2)m()end;if D==keys.enter then s()end elseif C=="char"then if string.len(l)==5 then goto B end;if tonumber(D)==nil then goto B end;l=l..D;m()end end end;i:start(A)return g end;return d
