local a=require("basalt")local b=require("atmAPI")local c=require("Screens.selectionBase")local d=require("Screens.errorDialog")local e=require("Screens.confirmDialog")local f=require("Screens.acceptDialog")local g=require("itemManager")local function h(i)local j=0;local k=0;local l;local m;local n;local o;local p,q,r,s,t,u;function t()o:start(p)end;function p()while true do local v,w,x=os.pullEvent()if v=="key"then if w==keys.backspace then local y=tostring(j)y=y:sub(1,-2)if y==""then y="0"end;j=tonumber(y)or j;s(0)end;if w==keys.enter then r()end elseif v=="char"then local y=tostring(j)y=y..w;j=tonumber(y)or j;s(0)end end end;function q()local z,A,B=pcall(function()return b.withdraw(i.acc,k,i.pin)end)k=0;if not z then local C=A:match(":%d+: (.+)")or A;if C=="Failed to contact the server!"then d(m,n,{"Server not reachable.","Try again later!"})elseif C=="Error: Incorrect PIN entered."then d(m,n,{"Incorrect PIN","Please try again."})else d(m,n,{"An error occurred: ",C})end else g.materializeItems(B)b.confirmWithdrawal(i.acc)f(m,n,{"Please pick up your "..CONFIG.CURRENCYNAME.."s","from the Dropper!"},i)end end;function r()if j==0 then d(m,n,{"You can't withdraw nothing!"})elseif l<0 then d(m,n,{"You don't have enough "..CONFIG.COINNAME.."!"})else k=j;e(m,n,string.format("Withdraw %s %ss?",k,CONFIG.CURRENCYNAME),q)end end;m=c("Withdraw",r,i)n=m:getChild("mainContent")o=m:addThread()local D=n:addFrame():setSize("parent.w","parent.h * 0.7 - 1"):setBackground(colors.lightGray)local E;local z,F=pcall(function()return b.balance(i.acc,i.pin)end)if z then D:addLabel():setText("Your Balance will be"):setPosition("parent.w * 0.5 + 1 - self.w * 0.5",2)E=D:addLabel():setText(F):setPosition("parent.w * 0.5 + 1 - self.w * 0.5",4)else local C=F:match(":%d+: (.+)")or F;d(m,n,{C})end;D:addLabel():setText("How many "..CONFIG.CURRENCYNAME.."s do you want to withdraw?"):setPosition("parent.w * 0.5 + 1 - self.w * 0.5","parent.h - 1")local G=n:addFrame():setSize("parent.w",3):setPosition(1,"parent.h * 0.7"):setBackground(colors.lightGray)local H={5,3}local I=G:addLabel("amountLabel"):setText(0):setPosition("parent.w * 0.5 + 1 - self.w * 0.5",2)function s(J)j=j+J;if j<0 then j=0 end;I:setText(j)l=F-j*CONFIG.EXCHANGERATE;E:setText(l)if l<0 then E:setForeground(colors.red)else E:setForeground(colors.black)end end;G:addButton():setText("-64"):setSize(H[1],H[2]):setPosition(2):onClick(function()s(-64)end)G:addButton():setText("-16"):setSize(H[1],H[2]):setPosition(8):onClick(function()s(-16)end)G:addButton():setText("-1"):setSize(H[1],H[2]):setPosition(14):onClick(function()s(-1)end)G:addButton():setText("+1"):setSize(H[1],H[2]):setPosition("parent.w - 17"):onClick(function()s(1)end)G:addButton():setText("+16"):setSize(H[1],H[2]):setPosition("parent.w - 11"):onClick(function()s(16)end)G:addButton():setText("+64"):setSize(H[1],H[2]):setPosition("parent.w - 5"):onClick(function()s(64)end)t()return m end;return h
