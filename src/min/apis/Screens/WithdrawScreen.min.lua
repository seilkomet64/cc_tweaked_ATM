local a=require("basalt")local b=require("atmAPI")local c=require("Screens.selectionBase")local d=require("Screens.errorDialog")local e=require("Screens.confirmDialog")local f=require("Screens.acceptDialog")local g=require("itemManager")local function h(i)local j=0;local k=0;local l;local m;local n;local o;local p,q,r,s,t,u;function t()o:start(p)end;function p()while true do local v,w,x=os.pullEvent()if v=="key"then if w==keys.backspace then local y=tostring(j)y=y:sub(1,-2)if y==""then y="0"end;j=tonumber(y)or j;s(0)end;if w==keys.enter then r()end elseif v=="char"then local y=tostring(j)y=y..w;j=tonumber(y)or j;s(0)end end end;function q()local z,A,B,C=pcall(function()return b.withdraw(i.acc,k,i.pin)end)k=0;if not z then local D=A:match(":%d+: (.+)")or A;if D=="Failed to contact the server!"then d(m,n,{"Server not reachable.","Try again later!"})elseif D=="Error: Incorrect PIN entered."then d(m,n,{"Incorrect PIN","Please try again."})else d(m,n,{"An error occurred: ",D})end else g.materializeItems(B)b.confirmWithdrawal(i.acc,C)f(m,n,{"Please pick up your "..CONFIG.CURRENCYNAME.."s","from the Dropper!"},i)end end;function r()if j==0 then d(m,n,{"You can't withdraw nothing!"})elseif l<0 then d(m,n,{"You don't have enough "..CONFIG.COINNAME.."!"})else k=j;e(m,n,string.format("Withdraw %s %ss?",k,CONFIG.CURRENCYNAME),q)end end;m=c("Withdraw",r,i)n=m:getChild("mainContent")o=m:addThread()local E=n:addFrame():setSize("parent.w","parent.h * 0.7 - 1"):setBackground(colors.lightGray)local F;local z,G=pcall(function()return b.balance(i.acc,i.pin)end)if z then E:addLabel():setText("Your Balance will be"):setPosition("parent.w * 0.5 + 1 - self.w * 0.5",2)F=E:addLabel():setText(G):setPosition("parent.w * 0.5 + 1 - self.w * 0.5",4)else local D=G:match(":%d+: (.+)")or G;d(m,n,{D})end;E:addLabel():setText("How many "..CONFIG.CURRENCYNAME.."s do you want to withdraw?"):setPosition("parent.w * 0.5 + 1 - self.w * 0.5","parent.h - 1")local H=n:addFrame():setSize("parent.w",3):setPosition(1,"parent.h * 0.7"):setBackground(colors.lightGray)local I={5,3}local J=H:addLabel("amountLabel"):setText(0):setPosition("parent.w * 0.5 + 1 - self.w * 0.5",2)function s(K)j=j+K;if j<0 then j=0 end;J:setText(j)l=G-j*CONFIG.EXCHANGERATE;F:setText(l)if l<0 then F:setForeground(colors.red)else F:setForeground(colors.black)end end;H:addButton():setText("-64"):setSize(I[1],I[2]):setPosition(2):onClick(function()s(-64)end)H:addButton():setText("-16"):setSize(I[1],I[2]):setPosition(8):onClick(function()s(-16)end)H:addButton():setText("-1"):setSize(I[1],I[2]):setPosition(14):onClick(function()s(-1)end)H:addButton():setText("+1"):setSize(I[1],I[2]):setPosition("parent.w - 17"):onClick(function()s(1)end)H:addButton():setText("+16"):setSize(I[1],I[2]):setPosition("parent.w - 11"):onClick(function()s(16)end)H:addButton():setText("+64"):setSize(I[1],I[2]):setPosition("parent.w - 5"):onClick(function()s(64)end)t()return m end;return h
