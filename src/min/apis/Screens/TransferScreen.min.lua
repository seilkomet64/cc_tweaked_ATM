local a=require("basalt")local b=require("atmAPI")local c=require("Screens.selectionBase")local d=require("Screens.errorDialog")local e=require("Screens.confirmDialog")local f=require("Screens.acceptDialog")local g=require("itemManager")local function h(i)local j=0;local k=0;local l;local m;local n;local o;local p,q,r,s,t,u;function t()o:start(p)end;function p()while true do local v,w,x=os.pullEvent()if v=="key"then if w==keys.backspace then local y=tostring(j)y=y:sub(1,-2)if y==""then y="0"end;j=tonumber(y)or j;s(0)end;if w==keys.enter then r()end elseif v=="char"then local y=tostring(j)y=y..w;j=tonumber(y)or j;s(0)end end end;function q()local z,A=pcall(function()return b.transfer(i.acc,i.targetAcc,k,i.pin)end)k=0;if not z then local B=A:match(":%d+: (.+)")or A;if B=="Failed to contact the server!"then d(m,n,{"Server not reachable.","Try again later!"})elseif B=="Error: Incorrect PIN entered."then d(m,n,{"Incorrect PIN","Please try again."})else d(m,n,{"An error occurred: ",B})end else f(m,n,{CONFIG.COINNAME.." have been transfered","to Account "..i.targetAcc},i)end end;function r()if j==0 then d(m,n,{"You can't transfer nothing!"})elseif l<0 then d(m,n,{"You don't have enough "..CONFIG.COINNAME.."!"})else k=j;e(m,n,string.format("Transfer %s %ss to %s?",k,CONFIG.COINNAME,i.targetAcc),q)end end;m=c("Transfer\n Account "..i.targetAcc,r,i)n=m:getChild("mainContent")o=m:addThread()local C=n:addFrame():setSize("parent.w","parent.h * 0.7 - 1"):setBackground(colors.lightGray)local D;local z,E=pcall(function()return b.balance(i.acc,i.pin)end)if z then C:addLabel():setText("Your Balance will be"):setPosition("parent.w * 0.5 + 1 - self.w * 0.5",2)D=C:addLabel():setText(E):setPosition("parent.w * 0.5 + 1 - self.w * 0.5",4)else local B=E:match(":%d+: (.+)")or E;d(m,n,{B})end;C:addLabel():setText("How many "..CONFIG.COINNAME.."s do you want to transfer?"):setPosition("parent.w * 0.5 + 1 - self.w * 0.5","parent.h - 1")local F=n:addFrame():setSize("parent.w",3):setPosition(1,"parent.h * 0.7"):setBackground(colors.lightGray)local G={5,3}local H=F:addLabel("amountLabel"):setText(0):setPosition("parent.w * 0.5 + 1 - self.w * 0.5",2)function s(I)j=j+I;if j<0 then j=0 end;H:setText(j)l=E-j;D:setText(l)if l<0 then D:setForeground(colors.red)else D:setForeground(colors.black)end end;F:addButton():setText("-50"):setSize(G[1],G[2]):setPosition(2):onClick(function()s(-50)end)F:addButton():setText("-10"):setSize(G[1],G[2]):setPosition(8):onClick(function()s(-10)end)F:addButton():setText("-1"):setSize(G[1],G[2]):setPosition(14):onClick(function()s(-1)end)F:addButton():setText("+1"):setSize(G[1],G[2]):setPosition("parent.w - 17"):onClick(function()s(1)end)F:addButton():setText("+10"):setSize(G[1],G[2]):setPosition("parent.w - 11"):onClick(function()s(10)end)F:addButton():setText("+50"):setSize(G[1],G[2]):setPosition("parent.w - 5"):onClick(function()s(50)end)t()return m end;return h
